
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://altescy.github.io/formed/reference/integrations/flax/">
      
      
        <link rel="prev" href="../datasets/">
      
      
        <link rel="next" href="../ml/">
      
      
        
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Flax - Formed</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.484c7ddc.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#flax" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Formed" class="md-header__button md-logo" aria-label="Formed" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Formed
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Flax
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/altescy/formed" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    altescy/formed
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../quick_start/" class="md-tabs__link">
        
  
  
    
  
  Quick Start

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../tutorials/" class="md-tabs__link">
          
  
  
  Tutorials

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../guides/" class="md-tabs__link">
          
  
  
  Guides

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
  
  API Reference

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Formed" class="md-nav__button md-logo" aria-label="Formed" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Formed
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/altescy/formed" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    altescy/formed
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../quick_start/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quick Start
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Tutorials
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Tutorials
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorials/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorials/text_classification/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Text Classification
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorials/causal_lm_finetuning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Causal LM Finetuning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Guides
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Guides
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Workflow
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Integrations
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Integrations
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/integrations/ml/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ML
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/integrations/torch/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Torch
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    API Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Workflow
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" checked>
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Integrations
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Integrations
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../datasets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Datasets
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Flax
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Flax
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#formed.integrations.flax.distributors" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;distributors
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" distributors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.distributors.BaseDistributor" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;BaseDistributor
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" BaseDistributor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.distributors.BaseDistributor.shard" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;shard
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.distributors.BaseDistributor.replicate" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;replicate
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.distributors.BaseDistributor.unreplicate" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;unreplicate
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.distributors.BaseDistributor.map" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;map
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.distributors.BaseDistributor.reduce" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;reduce
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.distributors.SingleDeviceDistributor" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;SingleDeviceDistributor
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" SingleDeviceDistributor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.distributors.SingleDeviceDistributor.map" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;map
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.distributors.SingleDeviceDistributor.reduce" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;reduce
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.distributors.SingleDeviceDistributor.shard" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;shard
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.distributors.SingleDeviceDistributor.replicate" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;replicate
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.distributors.SingleDeviceDistributor.unreplicate" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;unreplicate
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.distributors.DataParallelDistributor" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;DataParallelDistributor
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" DataParallelDistributor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.distributors.DataParallelDistributor.shard" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;shard
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.distributors.DataParallelDistributor.replicate" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;replicate
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.distributors.DataParallelDistributor.unreplicate" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;unreplicate
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.distributors.DataParallelDistributor.map" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;map
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.distributors.DataParallelDistributor.reduce" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;reduce
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#formed.integrations.flax.model" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;model
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.model.BaseFlaxModel" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;BaseFlaxModel
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.embedders" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;embedders
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" embedders">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.embedders.EmbedderOutput" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;EmbedderOutput
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" EmbedderOutput">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.embedders.EmbedderOutput.embeddings" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;embeddings
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.embedders.EmbedderOutput.mask" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;mask
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.embedders.BaseEmbedder" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;BaseEmbedder
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" BaseEmbedder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.embedders.BaseEmbedder.get_output_dim" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_output_dim
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.embedders.TokenEmbedder" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TokenEmbedder
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" TokenEmbedder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.embedders.TokenEmbedder.get_output_dim" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_output_dim
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.embedders.AnalyzedTextEmbedder" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;AnalyzedTextEmbedder
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" AnalyzedTextEmbedder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.embedders.AnalyzedTextEmbedder.get_output_dim" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_output_dim
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;encoders
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" encoders">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.BasePositionEncoder" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;BasePositionEncoder
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.SinusoidalPositionEncoder" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;SinusoidalPositionEncoder
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" SinusoidalPositionEncoder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.SinusoidalPositionEncoder.max_length" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;max_length
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.LearnablePositionEncoder" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;LearnablePositionEncoder
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" LearnablePositionEncoder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.LearnablePositionEncoder.embed" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;embed
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.BaseSequenceEncoder" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;BaseSequenceEncoder
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" BaseSequenceEncoder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.BaseSequenceEncoder.get_input_dim" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_input_dim
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.BaseSequenceEncoder.get_output_dim" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_output_dim
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.RNNSequenceEncoder" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;RNNSequenceEncoder
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" RNNSequenceEncoder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.RNNSequenceEncoder.blocks" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;blocks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.RNNSequenceEncoder.num_layers" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;num_layers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.RNNSequenceEncoder.bidirectional" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;bidirectional
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.RNNSequenceEncoder.features" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;features
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.RNNSequenceEncoder.get_input_dim" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_input_dim
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.RNNSequenceEncoder.get_output_dim" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_output_dim
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.LSTMSequenceEncoder" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;LSTMSequenceEncoder
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" LSTMSequenceEncoder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.LSTMSequenceEncoder.blocks" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;blocks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.LSTMSequenceEncoder.num_layers" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;num_layers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.LSTMSequenceEncoder.bidirectional" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;bidirectional
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.LSTMSequenceEncoder.features" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;features
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.LSTMSequenceEncoder.get_input_dim" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_input_dim
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.LSTMSequenceEncoder.get_output_dim" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_output_dim
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.OptimizedLSTMSequenceEncoder" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;OptimizedLSTMSequenceEncoder
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" OptimizedLSTMSequenceEncoder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.OptimizedLSTMSequenceEncoder.blocks" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;blocks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.OptimizedLSTMSequenceEncoder.num_layers" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;num_layers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.OptimizedLSTMSequenceEncoder.bidirectional" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;bidirectional
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.OptimizedLSTMSequenceEncoder.features" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;features
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.OptimizedLSTMSequenceEncoder.get_input_dim" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_input_dim
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.OptimizedLSTMSequenceEncoder.get_output_dim" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_output_dim
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.GRUSequenceEncoder" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;GRUSequenceEncoder
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" GRUSequenceEncoder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.GRUSequenceEncoder.blocks" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;blocks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.GRUSequenceEncoder.num_layers" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;num_layers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.GRUSequenceEncoder.bidirectional" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;bidirectional
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.GRUSequenceEncoder.features" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;features
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.GRUSequenceEncoder.get_input_dim" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_input_dim
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.GRUSequenceEncoder.get_output_dim" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_output_dim
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.TransformerSequenceEncoder" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TransformerSequenceEncoder
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" TransformerSequenceEncoder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.TransformerSequenceEncoder.num_layers" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;num_layers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.TransformerSequenceEncoder.blocks" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;blocks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.TransformerSequenceEncoder.position_encoder" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;position_encoder
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.TransformerSequenceEncoder.features" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;features
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.TransformerSequenceEncoder.get_input_dim" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_input_dim
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.TransformerSequenceEncoder.get_output_dim" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_output_dim
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.feedforward" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;feedforward
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" feedforward">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.feedforward.Block" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;Block
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" Block">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.feedforward.Block.linear" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;linear
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.feedforward.Block.activation" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;activation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.feedforward.Block.dropout" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;dropout
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.feedforward.Block.layer_norm" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;layer_norm
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.feedforward.FeedForward" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;FeedForward
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" FeedForward">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.feedforward.FeedForward.features" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;features
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.feedforward.FeedForward.num_layers" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;num_layers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.feedforward.FeedForward.blocks" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;blocks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.feedforward.FeedForward.residual_connection" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;residual_connection
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.feedforward.FeedForward.get_input_dim" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_input_dim
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.feedforward.FeedForward.get_output_dim" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_output_dim
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.losses" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;losses
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" losses">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.losses.BaseClassificationLoss" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;BaseClassificationLoss
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.losses.CrossEntropyLoss" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;CrossEntropyLoss
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.samplers" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;samplers
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" samplers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.samplers.BaseLabelSampler" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;BaseLabelSampler
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.samplers.ArgmaxLabelSampler" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;ArgmaxLabelSampler
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.samplers.MultinomialLabelSamplerParams" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;MultinomialLabelSamplerParams
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" MultinomialLabelSamplerParams">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.samplers.MultinomialLabelSamplerParams.rngs" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;rngs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.samplers.MultinomialLabelSamplerParams.templerature" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;templerature
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.samplers.MultinomialLabelSampler" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;MultinomialLabelSampler
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" MultinomialLabelSampler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.samplers.MultinomialLabelSampler.Params" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;Params
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.vectorizers" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;vectorizers
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" vectorizers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.vectorizers.BaseSequenceVectorizer" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;BaseSequenceVectorizer
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" BaseSequenceVectorizer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.vectorizers.BaseSequenceVectorizer.get_input_dim" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_input_dim
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.vectorizers.BaseSequenceVectorizer.get_output_dim" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_output_dim
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.vectorizers.BagOfEmbeddingsSequenceVectorizer" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;BagOfEmbeddingsSequenceVectorizer
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" BagOfEmbeddingsSequenceVectorizer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.vectorizers.BagOfEmbeddingsSequenceVectorizer.get_input_dim" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_input_dim
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.vectorizers.BagOfEmbeddingsSequenceVectorizer.get_output_dim" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_output_dim
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.weighters" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;weighters
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" weighters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.weighters.BaseLabelWeighter" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;BaseLabelWeighter
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.weighters.StaticLabelWeighter" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;StaticLabelWeighter
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.weighters.BalancedByDistributionLabelWeighter" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;BalancedByDistributionLabelWeighter
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;callbacks
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" callbacks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.FlaxTrainingCallback" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;FlaxTrainingCallback
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" FlaxTrainingCallback">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.FlaxTrainingCallback.on_training_start" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_training_start
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.FlaxTrainingCallback.on_training_end" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_training_end
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.FlaxTrainingCallback.on_epoch_start" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_epoch_start
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.FlaxTrainingCallback.on_epoch_end" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_epoch_end
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.FlaxTrainingCallback.on_batch_start" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_batch_start
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.FlaxTrainingCallback.on_batch_end" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_batch_end
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.FlaxTrainingCallback.on_eval_start" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_eval_start
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.FlaxTrainingCallback.on_eval_end" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_eval_end
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.FlaxTrainingCallback.on_log" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_log
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.EvaluationCallback" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;EvaluationCallback
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" EvaluationCallback">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.EvaluationCallback.on_eval_start" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_eval_start
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.EvaluationCallback.on_training_start" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_training_start
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.EvaluationCallback.on_training_end" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_training_end
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.EvaluationCallback.on_epoch_start" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_epoch_start
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.EvaluationCallback.on_epoch_end" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_epoch_end
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.EvaluationCallback.on_batch_start" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_batch_start
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.EvaluationCallback.on_batch_end" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_batch_end
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.EvaluationCallback.on_eval_end" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_eval_end
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.EvaluationCallback.on_log" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_log
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.EarlyStoppingCallback" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;EarlyStoppingCallback
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" EarlyStoppingCallback">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.EarlyStoppingCallback.on_training_start" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_training_start
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.EarlyStoppingCallback.on_eval_end" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_eval_end
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.EarlyStoppingCallback.on_training_end" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_training_end
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.EarlyStoppingCallback.on_epoch_start" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_epoch_start
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.EarlyStoppingCallback.on_epoch_end" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_epoch_end
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.EarlyStoppingCallback.on_batch_start" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_batch_start
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.EarlyStoppingCallback.on_batch_end" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_batch_end
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.EarlyStoppingCallback.on_eval_start" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_eval_start
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.EarlyStoppingCallback.on_log" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_log
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.MlflowCallback" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;MlflowCallback
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" MlflowCallback">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.MlflowCallback.on_training_start" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_training_start
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.MlflowCallback.on_log" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_log
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.MlflowCallback.on_epoch_end" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_epoch_end
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.MlflowCallback.on_training_end" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_training_end
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.MlflowCallback.on_epoch_start" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_epoch_start
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.MlflowCallback.on_batch_start" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_batch_start
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.MlflowCallback.on_batch_end" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_batch_end
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.MlflowCallback.on_eval_start" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_eval_start
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.MlflowCallback.on_eval_end" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_eval_end
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.engine" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;engine
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" engine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.engine.FlaxTrainingEngine" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;FlaxTrainingEngine
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" FlaxTrainingEngine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.engine.FlaxTrainingEngine.create_state" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;create_state
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.engine.FlaxTrainingEngine.train_step" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;train_step
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.engine.FlaxTrainingEngine.eval_step" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;eval_step
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.engine.DefaultFlaxTrainingEngine" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;DefaultFlaxTrainingEngine
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" DefaultFlaxTrainingEngine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.engine.DefaultFlaxTrainingEngine.create_state" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;create_state
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.engine.DefaultFlaxTrainingEngine.train_step" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;train_step
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.engine.DefaultFlaxTrainingEngine.eval_step" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;eval_step
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.exceptions" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;exceptions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" exceptions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.exceptions.StopEarly" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;StopEarly
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.state" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;state
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" state">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.state.Node" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;Node
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.state.TrainState" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TrainState
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" TrainState">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.state.TrainState.graphdef" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;graphdef
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.state.TrainState.additional_states" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;additional_states
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.trainer" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;trainer
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" trainer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.trainer.FlaxTrainer" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;FlaxTrainer
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" FlaxTrainer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.trainer.FlaxTrainer.distributor" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;distributor
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.trainer.FlaxTrainer.train" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;train
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#formed.integrations.flax.random" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;random
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" random">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.random.use_rngs" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;use_rngs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.random.require_rngs" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;require_rngs
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#formed.integrations.flax.utils" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;utils
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.utils.PoolingMethod" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;PoolingMethod
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.utils.ensure_jax_array" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;ensure_jax_array
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.utils.masked_pool" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;masked_pool
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.utils.sequence_distribute" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;sequence_distribute
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.utils.sequence_undistribute" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;sequence_undistribute
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.utils.determine_ndim" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;determine_ndim
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#formed.integrations.flax.workflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;workflow
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" workflow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.workflow.FlaxModelFormat" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;FlaxModelFormat
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" FlaxModelFormat">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.workflow.FlaxModelFormat.identifier" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;identifier
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.workflow.FlaxModelFormat.write" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;write
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.workflow.FlaxModelFormat.read" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;read
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.workflow.FlaxModelFormat.is_default_of" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;is_default_of
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.workflow.train_flax_model" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;train_flax_model
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.workflow.evaluate_flax_model" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;evaluate_flax_model
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ml/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ML
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../mlflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MLflow
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sentence_transformers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SentenceTransformers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../torch/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Torch
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../transformers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Transformers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#formed.integrations.flax.distributors" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;distributors
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" distributors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.distributors.BaseDistributor" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;BaseDistributor
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" BaseDistributor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.distributors.BaseDistributor.shard" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;shard
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.distributors.BaseDistributor.replicate" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;replicate
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.distributors.BaseDistributor.unreplicate" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;unreplicate
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.distributors.BaseDistributor.map" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;map
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.distributors.BaseDistributor.reduce" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;reduce
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.distributors.SingleDeviceDistributor" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;SingleDeviceDistributor
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" SingleDeviceDistributor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.distributors.SingleDeviceDistributor.map" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;map
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.distributors.SingleDeviceDistributor.reduce" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;reduce
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.distributors.SingleDeviceDistributor.shard" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;shard
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.distributors.SingleDeviceDistributor.replicate" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;replicate
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.distributors.SingleDeviceDistributor.unreplicate" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;unreplicate
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.distributors.DataParallelDistributor" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;DataParallelDistributor
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" DataParallelDistributor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.distributors.DataParallelDistributor.shard" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;shard
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.distributors.DataParallelDistributor.replicate" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;replicate
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.distributors.DataParallelDistributor.unreplicate" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;unreplicate
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.distributors.DataParallelDistributor.map" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;map
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.distributors.DataParallelDistributor.reduce" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;reduce
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#formed.integrations.flax.model" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;model
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.model.BaseFlaxModel" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;BaseFlaxModel
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.embedders" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;embedders
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" embedders">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.embedders.EmbedderOutput" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;EmbedderOutput
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" EmbedderOutput">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.embedders.EmbedderOutput.embeddings" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;embeddings
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.embedders.EmbedderOutput.mask" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;mask
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.embedders.BaseEmbedder" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;BaseEmbedder
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" BaseEmbedder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.embedders.BaseEmbedder.get_output_dim" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_output_dim
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.embedders.TokenEmbedder" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TokenEmbedder
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" TokenEmbedder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.embedders.TokenEmbedder.get_output_dim" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_output_dim
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.embedders.AnalyzedTextEmbedder" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;AnalyzedTextEmbedder
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" AnalyzedTextEmbedder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.embedders.AnalyzedTextEmbedder.get_output_dim" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_output_dim
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;encoders
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" encoders">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.BasePositionEncoder" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;BasePositionEncoder
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.SinusoidalPositionEncoder" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;SinusoidalPositionEncoder
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" SinusoidalPositionEncoder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.SinusoidalPositionEncoder.max_length" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;max_length
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.LearnablePositionEncoder" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;LearnablePositionEncoder
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" LearnablePositionEncoder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.LearnablePositionEncoder.embed" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;embed
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.BaseSequenceEncoder" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;BaseSequenceEncoder
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" BaseSequenceEncoder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.BaseSequenceEncoder.get_input_dim" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_input_dim
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.BaseSequenceEncoder.get_output_dim" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_output_dim
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.RNNSequenceEncoder" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;RNNSequenceEncoder
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" RNNSequenceEncoder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.RNNSequenceEncoder.blocks" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;blocks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.RNNSequenceEncoder.num_layers" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;num_layers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.RNNSequenceEncoder.bidirectional" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;bidirectional
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.RNNSequenceEncoder.features" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;features
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.RNNSequenceEncoder.get_input_dim" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_input_dim
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.RNNSequenceEncoder.get_output_dim" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_output_dim
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.LSTMSequenceEncoder" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;LSTMSequenceEncoder
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" LSTMSequenceEncoder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.LSTMSequenceEncoder.blocks" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;blocks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.LSTMSequenceEncoder.num_layers" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;num_layers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.LSTMSequenceEncoder.bidirectional" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;bidirectional
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.LSTMSequenceEncoder.features" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;features
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.LSTMSequenceEncoder.get_input_dim" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_input_dim
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.LSTMSequenceEncoder.get_output_dim" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_output_dim
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.OptimizedLSTMSequenceEncoder" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;OptimizedLSTMSequenceEncoder
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" OptimizedLSTMSequenceEncoder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.OptimizedLSTMSequenceEncoder.blocks" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;blocks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.OptimizedLSTMSequenceEncoder.num_layers" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;num_layers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.OptimizedLSTMSequenceEncoder.bidirectional" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;bidirectional
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.OptimizedLSTMSequenceEncoder.features" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;features
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.OptimizedLSTMSequenceEncoder.get_input_dim" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_input_dim
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.OptimizedLSTMSequenceEncoder.get_output_dim" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_output_dim
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.GRUSequenceEncoder" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;GRUSequenceEncoder
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" GRUSequenceEncoder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.GRUSequenceEncoder.blocks" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;blocks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.GRUSequenceEncoder.num_layers" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;num_layers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.GRUSequenceEncoder.bidirectional" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;bidirectional
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.GRUSequenceEncoder.features" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;features
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.GRUSequenceEncoder.get_input_dim" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_input_dim
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.GRUSequenceEncoder.get_output_dim" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_output_dim
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.TransformerSequenceEncoder" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TransformerSequenceEncoder
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" TransformerSequenceEncoder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.TransformerSequenceEncoder.num_layers" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;num_layers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.TransformerSequenceEncoder.blocks" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;blocks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.TransformerSequenceEncoder.position_encoder" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;position_encoder
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.TransformerSequenceEncoder.features" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;features
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.TransformerSequenceEncoder.get_input_dim" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_input_dim
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.encoders.TransformerSequenceEncoder.get_output_dim" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_output_dim
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.feedforward" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;feedforward
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" feedforward">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.feedforward.Block" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;Block
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" Block">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.feedforward.Block.linear" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;linear
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.feedforward.Block.activation" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;activation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.feedforward.Block.dropout" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;dropout
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.feedforward.Block.layer_norm" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;layer_norm
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.feedforward.FeedForward" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;FeedForward
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" FeedForward">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.feedforward.FeedForward.features" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;features
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.feedforward.FeedForward.num_layers" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;num_layers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.feedforward.FeedForward.blocks" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;blocks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.feedforward.FeedForward.residual_connection" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;residual_connection
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.feedforward.FeedForward.get_input_dim" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_input_dim
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.feedforward.FeedForward.get_output_dim" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_output_dim
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.losses" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;losses
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" losses">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.losses.BaseClassificationLoss" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;BaseClassificationLoss
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.losses.CrossEntropyLoss" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;CrossEntropyLoss
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.samplers" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;samplers
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" samplers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.samplers.BaseLabelSampler" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;BaseLabelSampler
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.samplers.ArgmaxLabelSampler" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;ArgmaxLabelSampler
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.samplers.MultinomialLabelSamplerParams" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;MultinomialLabelSamplerParams
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" MultinomialLabelSamplerParams">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.samplers.MultinomialLabelSamplerParams.rngs" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;rngs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.samplers.MultinomialLabelSamplerParams.templerature" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;templerature
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.samplers.MultinomialLabelSampler" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;MultinomialLabelSampler
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" MultinomialLabelSampler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.samplers.MultinomialLabelSampler.Params" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;Params
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.vectorizers" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;vectorizers
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" vectorizers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.vectorizers.BaseSequenceVectorizer" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;BaseSequenceVectorizer
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" BaseSequenceVectorizer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.vectorizers.BaseSequenceVectorizer.get_input_dim" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_input_dim
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.vectorizers.BaseSequenceVectorizer.get_output_dim" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_output_dim
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.vectorizers.BagOfEmbeddingsSequenceVectorizer" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;BagOfEmbeddingsSequenceVectorizer
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" BagOfEmbeddingsSequenceVectorizer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.vectorizers.BagOfEmbeddingsSequenceVectorizer.get_input_dim" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_input_dim
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.vectorizers.BagOfEmbeddingsSequenceVectorizer.get_output_dim" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_output_dim
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.weighters" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;weighters
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" weighters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.weighters.BaseLabelWeighter" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;BaseLabelWeighter
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.weighters.StaticLabelWeighter" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;StaticLabelWeighter
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.modules.weighters.BalancedByDistributionLabelWeighter" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;BalancedByDistributionLabelWeighter
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;callbacks
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" callbacks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.FlaxTrainingCallback" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;FlaxTrainingCallback
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" FlaxTrainingCallback">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.FlaxTrainingCallback.on_training_start" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_training_start
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.FlaxTrainingCallback.on_training_end" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_training_end
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.FlaxTrainingCallback.on_epoch_start" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_epoch_start
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.FlaxTrainingCallback.on_epoch_end" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_epoch_end
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.FlaxTrainingCallback.on_batch_start" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_batch_start
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.FlaxTrainingCallback.on_batch_end" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_batch_end
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.FlaxTrainingCallback.on_eval_start" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_eval_start
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.FlaxTrainingCallback.on_eval_end" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_eval_end
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.FlaxTrainingCallback.on_log" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_log
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.EvaluationCallback" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;EvaluationCallback
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" EvaluationCallback">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.EvaluationCallback.on_eval_start" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_eval_start
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.EvaluationCallback.on_training_start" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_training_start
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.EvaluationCallback.on_training_end" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_training_end
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.EvaluationCallback.on_epoch_start" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_epoch_start
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.EvaluationCallback.on_epoch_end" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_epoch_end
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.EvaluationCallback.on_batch_start" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_batch_start
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.EvaluationCallback.on_batch_end" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_batch_end
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.EvaluationCallback.on_eval_end" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_eval_end
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.EvaluationCallback.on_log" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_log
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.EarlyStoppingCallback" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;EarlyStoppingCallback
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" EarlyStoppingCallback">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.EarlyStoppingCallback.on_training_start" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_training_start
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.EarlyStoppingCallback.on_eval_end" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_eval_end
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.EarlyStoppingCallback.on_training_end" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_training_end
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.EarlyStoppingCallback.on_epoch_start" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_epoch_start
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.EarlyStoppingCallback.on_epoch_end" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_epoch_end
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.EarlyStoppingCallback.on_batch_start" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_batch_start
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.EarlyStoppingCallback.on_batch_end" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_batch_end
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.EarlyStoppingCallback.on_eval_start" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_eval_start
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.EarlyStoppingCallback.on_log" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_log
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.MlflowCallback" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;MlflowCallback
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" MlflowCallback">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.MlflowCallback.on_training_start" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_training_start
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.MlflowCallback.on_log" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_log
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.MlflowCallback.on_epoch_end" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_epoch_end
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.MlflowCallback.on_training_end" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_training_end
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.MlflowCallback.on_epoch_start" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_epoch_start
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.MlflowCallback.on_batch_start" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_batch_start
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.MlflowCallback.on_batch_end" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_batch_end
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.MlflowCallback.on_eval_start" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_eval_start
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.callbacks.MlflowCallback.on_eval_end" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;on_eval_end
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.engine" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;engine
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" engine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.engine.FlaxTrainingEngine" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;FlaxTrainingEngine
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" FlaxTrainingEngine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.engine.FlaxTrainingEngine.create_state" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;create_state
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.engine.FlaxTrainingEngine.train_step" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;train_step
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.engine.FlaxTrainingEngine.eval_step" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;eval_step
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.engine.DefaultFlaxTrainingEngine" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;DefaultFlaxTrainingEngine
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" DefaultFlaxTrainingEngine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.engine.DefaultFlaxTrainingEngine.create_state" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;create_state
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.engine.DefaultFlaxTrainingEngine.train_step" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;train_step
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.engine.DefaultFlaxTrainingEngine.eval_step" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;eval_step
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.exceptions" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;exceptions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" exceptions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.exceptions.StopEarly" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;StopEarly
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.state" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;state
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" state">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.state.Node" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;Node
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.state.TrainState" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TrainState
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" TrainState">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.state.TrainState.graphdef" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;graphdef
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.state.TrainState.additional_states" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;additional_states
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.trainer" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;trainer
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" trainer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.trainer.FlaxTrainer" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;FlaxTrainer
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" FlaxTrainer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.trainer.FlaxTrainer.distributor" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;distributor
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.training.trainer.FlaxTrainer.train" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;train
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#formed.integrations.flax.random" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;random
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" random">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.random.use_rngs" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;use_rngs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.random.require_rngs" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;require_rngs
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#formed.integrations.flax.utils" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;utils
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.utils.PoolingMethod" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;PoolingMethod
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.utils.ensure_jax_array" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;ensure_jax_array
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.utils.masked_pool" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;masked_pool
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.utils.sequence_distribute" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;sequence_distribute
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.utils.sequence_undistribute" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;sequence_undistribute
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.utils.determine_ndim" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;determine_ndim
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#formed.integrations.flax.workflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;workflow
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" workflow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.workflow.FlaxModelFormat" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;FlaxModelFormat
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" FlaxModelFormat">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.workflow.FlaxModelFormat.identifier" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;identifier
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.workflow.FlaxModelFormat.write" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;write
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.workflow.FlaxModelFormat.read" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;read
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.workflow.FlaxModelFormat.is_default_of" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;is_default_of
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.workflow.train_flax_model" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;train_flax_model
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formed.integrations.flax.workflow.evaluate_flax_model" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;evaluate_flax_model
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="flax">Flax<a class="headerlink" data-preview="" href="#flax" title="Permanent link">&para;</a></h1>
<ul>
<li><a data-preview="" href="#formed.integrations.flax.distributors">Distributors</a></li>
<li><a data-preview="" href="#formed.integrations.flax.model">Model</a></li>
<li>Modules<ul>
<li><a data-preview="" href="#formed.integrations.flax.modules.embedders">Embedders</a></li>
<li><a data-preview="" href="#formed.integrations.flax.modules.encoders">Encoders</a></li>
<li><a data-preview="" href="#formed.integrations.flax.modules.feedforward">Feedforward</a></li>
<li><a data-preview="" href="#formed.integrations.flax.modules.losses">Losses</a></li>
<li><a data-preview="" href="#formed.integrations.flax.modules.samplers">Samplers</a></li>
<li><a data-preview="" href="#formed.integrations.flax.modules.vectorizers">Vectorizers</a></li>
<li><a data-preview="" href="#formed.integrations.flax.modules.weighters">Weighters</a></li>
</ul>
</li>
<li>Training<ul>
<li><a data-preview="" href="#formed.integrations.flax.training.callbacks">Callbacks</a></li>
<li><a data-preview="" href="#formed.integrations.flax.training.engine">Engine</a></li>
<li><a data-preview="" href="#formed.integrations.flax.training.exceptions">Exceptions</a></li>
<li><a data-preview="" href="#formed.integrations.flax.training.state">State</a></li>
<li><a data-preview="" href="#formed.integrations.flax.training.trainer">Trainer</a></li>
</ul>
</li>
<li><a data-preview="" href="#formed.integrations.flax.random">Random</a></li>
<li><a data-preview="" href="#formed.integrations.flax.utils">Utils</a></li>
<li><a data-preview="" href="#formed.integrations.flax.workflow">Workflow</a></li>
</ul>


<div class="doc doc-object doc-module">



<h2 id="formed.integrations.flax.distributors" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">formed.integrations.flax.distributors</span>


<a href="#formed.integrations.flax.distributors" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

        <p>Distributed computing abstractions for Flax models.</p>
<p>This module provides abstractions for distributed training across multiple devices,
supporting both single-device and data-parallel training strategies.</p>


<details class="key-components" open>
  <summary>Key Components</summary>
  <ul>
<li><code>BaseDistributor</code>: Abstract interface for device distribution strategies</li>
<li><code>SingleDeviceDistributor</code>: No-op distributor for single-device training</li>
<li><code>DataParallelDistributor</code>: Data-parallel training using JAX pmap</li>
</ul>
</details>

<details class="features" open>
  <summary>Features</summary>
  <ul>
<li>Transparent device sharding and replication</li>
<li>JIT compilation with device-specific optimizations</li>
<li>Reduction operations (mean, sum) across devices</li>
<li>Compatible with FlaxTrainer</li>
</ul>
</details>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span id="__span-0-1"><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">formed.integrations.flax</span><span class="w"> </span><span class="kn">import</span> <span class="n">DataParallelDistributor</span>
</span><span id="__span-0-2"><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">jax</span>
</span><span id="__span-0-3"><span class="gp">&gt;&gt;&gt;</span>
</span><span id="__span-0-4"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Create data-parallel distributor for all available devices</span>
</span><span id="__span-0-5"><span class="gp">&gt;&gt;&gt; </span><span class="n">distributor</span> <span class="o">=</span> <span class="n">DataParallelDistributor</span><span class="p">(</span><span class="n">axis_name</span><span class="o">=</span><span class="s2">&quot;batch&quot;</span><span class="p">)</span>
</span><span id="__span-0-6"><span class="gp">&gt;&gt;&gt;</span>
</span><span id="__span-0-7"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Shard batch across devices</span>
</span><span id="__span-0-8"><span class="gp">&gt;&gt;&gt; </span><span class="n">sharded_batch</span> <span class="o">=</span> <span class="n">distributor</span><span class="o">.</span><span class="n">shard</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
</span><span id="__span-0-9"><span class="gp">&gt;&gt;&gt;</span>
</span><span id="__span-0-10"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Map function across devices</span>
</span><span id="__span-0-11"><span class="gp">&gt;&gt;&gt; </span><span class="n">train_step</span> <span class="o">=</span> <span class="n">distributor</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">training_function</span><span class="p">)</span>
</span><span id="__span-0-12"><span class="gp">&gt;&gt;&gt; </span><span class="n">outputs</span> <span class="o">=</span> <span class="n">train_step</span><span class="p">(</span><span class="n">sharded_batch</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
</span></code></pre></div>










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h3 id="formed.integrations.flax.distributors.BaseDistributor" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">BaseDistributor</span>


<a href="#formed.integrations.flax.distributors.BaseDistributor" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="colt.Registrable">Registrable</span></code>, <code><span title="abc.ABC">ABC</span></code>, <code><span title="typing.Generic">Generic</span>[<span title="formed.integrations.flax.types.ModelInputT">ModelInputT</span>]</code></p>



        <p>Abstract base class for device distribution strategies.</p>
<p>BaseDistributor defines the interface for distributing computations
across devices in a JAX/Flax training pipeline. It handles data
sharding, replication, and reduction operations.</p>


<table>
      <thead>
        <tr>
          <th>
            <span class="doc-section-title">
              CLASS TYPE PARAMETER
            </span>
          </th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ModelInputT</code>
            </td>
            <td class="doc-type_param-details">
              <div class="doc-md-description">
                <p>Type of model input data.</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
      </tbody>
    </table>











<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.distributors.BaseDistributor.shard" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">shard</span>


<a href="#formed.integrations.flax.distributors.BaseDistributor.shard" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">shard</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Shard inputs across devices.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>inputs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Input data to shard.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="formed.integrations.flax.types.ModelInputT">ModelInputT</span></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="formed.integrations.flax.types.ModelInputT">ModelInputT</span></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Sharded input data with an additional device dimension.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/distributors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-62"><span class="k">def</span><span class="w"> </span><span class="nf">shard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">ModelInputT</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ModelInputT</span><span class="p">:</span>
</span><span id="__span-0-63"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Shard inputs across devices.</span>
</span><span id="__span-0-64">
</span><span id="__span-0-65"><span class="sd">    Args:</span>
</span><span id="__span-0-66"><span class="sd">        inputs: Input data to shard.</span>
</span><span id="__span-0-67">
</span><span id="__span-0-68"><span class="sd">    Returns:</span>
</span><span id="__span-0-69"><span class="sd">        Sharded input data with an additional device dimension.</span>
</span><span id="__span-0-70">
</span><span id="__span-0-71"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-72">    <span class="k">return</span> <span class="n">inputs</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.distributors.BaseDistributor.replicate" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">replicate</span>


<a href="#formed.integrations.flax.distributors.BaseDistributor.replicate" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">replicate</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Replicate data across all devices.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>inputs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Data to replicate.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="formed.integrations.flax.distributors._T">_T</span></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="formed.integrations.flax.distributors._T">_T</span></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Replicated data with device dimension.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/distributors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-74"><span class="k">def</span><span class="w"> </span><span class="nf">replicate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">_T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="p">:</span>
</span><span id="__span-0-75"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Replicate data across all devices.</span>
</span><span id="__span-0-76">
</span><span id="__span-0-77"><span class="sd">    Args:</span>
</span><span id="__span-0-78"><span class="sd">        inputs: Data to replicate.</span>
</span><span id="__span-0-79">
</span><span id="__span-0-80"><span class="sd">    Returns:</span>
</span><span id="__span-0-81"><span class="sd">        Replicated data with device dimension.</span>
</span><span id="__span-0-82">
</span><span id="__span-0-83"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-84">    <span class="k">return</span> <span class="n">inputs</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.distributors.BaseDistributor.unreplicate" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">unreplicate</span>


<a href="#formed.integrations.flax.distributors.BaseDistributor.unreplicate" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">unreplicate</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Extract data from the first device, removing device dimension.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>inputs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Replicated data with device dimension.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="formed.integrations.flax.distributors._T">_T</span></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="formed.integrations.flax.distributors._T">_T</span></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Data from first device without device dimension.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/distributors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-86"><span class="k">def</span><span class="w"> </span><span class="nf">unreplicate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">_T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="p">:</span>
</span><span id="__span-0-87"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract data from the first device, removing device dimension.</span>
</span><span id="__span-0-88">
</span><span id="__span-0-89"><span class="sd">    Args:</span>
</span><span id="__span-0-90"><span class="sd">        inputs: Replicated data with device dimension.</span>
</span><span id="__span-0-91">
</span><span id="__span-0-92"><span class="sd">    Returns:</span>
</span><span id="__span-0-93"><span class="sd">        Data from first device without device dimension.</span>
</span><span id="__span-0-94">
</span><span id="__span-0-95"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-96">    <span class="k">return</span> <span class="n">inputs</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.distributors.BaseDistributor.map" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">map</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

<a href="#formed.integrations.flax.distributors.BaseDistributor.map" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">map</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">())</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Map a function across devices with JIT compilation.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>fn</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Function to map across devices.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="formed.integrations.flax.distributors._CallableT">_CallableT</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>static_argnums</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Indices of static arguments.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="collections.abc.Sequence">Sequence</span>[<span title="int">int</span>]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>()</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="formed.integrations.flax.distributors._CallableT">_CallableT</span></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Mapped and compiled function.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/distributors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-98"><span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
</span><span id="__span-0-99"><span class="k">def</span><span class="w"> </span><span class="nf">map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">:</span> <span class="n">_CallableT</span><span class="p">,</span> <span class="n">static_argnums</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">())</span> <span class="o">-&gt;</span> <span class="n">_CallableT</span><span class="p">:</span>
</span><span id="__span-0-100"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Map a function across devices with JIT compilation.</span>
</span><span id="__span-0-101">
</span><span id="__span-0-102"><span class="sd">    Args:</span>
</span><span id="__span-0-103"><span class="sd">        fn: Function to map across devices.</span>
</span><span id="__span-0-104"><span class="sd">        static_argnums: Indices of static arguments.</span>
</span><span id="__span-0-105">
</span><span id="__span-0-106"><span class="sd">    Returns:</span>
</span><span id="__span-0-107"><span class="sd">        Mapped and compiled function.</span>
</span><span id="__span-0-108">
</span><span id="__span-0-109"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-110">    <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.distributors.BaseDistributor.reduce" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">reduce</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

<a href="#formed.integrations.flax.distributors.BaseDistributor.reduce" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">reduce</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">op</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Reduce an array across devices.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>array</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Array to reduce.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="formed.integrations.flax.distributors._ArrayT">_ArrayT</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>op</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Reduction operation (<code>"mean"</code> or <code>"sum"</code>).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="formed.integrations.flax.distributors._ReduceOp">_ReduceOp</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;mean&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="formed.integrations.flax.distributors._ArrayT">_ArrayT</span></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Reduced array.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/distributors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-112"><span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
</span><span id="__span-0-113"><span class="k">def</span><span class="w"> </span><span class="nf">reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">:</span> <span class="n">_ArrayT</span><span class="p">,</span> <span class="n">op</span><span class="p">:</span> <span class="n">_ReduceOp</span> <span class="o">=</span> <span class="s2">&quot;mean&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_ArrayT</span><span class="p">:</span>
</span><span id="__span-0-114"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Reduce an array across devices.</span>
</span><span id="__span-0-115">
</span><span id="__span-0-116"><span class="sd">    Args:</span>
</span><span id="__span-0-117"><span class="sd">        array: Array to reduce.</span>
</span><span id="__span-0-118"><span class="sd">        op: Reduction operation (`&quot;mean&quot;` or `&quot;sum&quot;`).</span>
</span><span id="__span-0-119">
</span><span id="__span-0-120"><span class="sd">    Returns:</span>
</span><span id="__span-0-121"><span class="sd">        Reduced array.</span>
</span><span id="__span-0-122">
</span><span id="__span-0-123"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-124">    <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="formed.integrations.flax.distributors.SingleDeviceDistributor" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">SingleDeviceDistributor</span>


<a href="#formed.integrations.flax.distributors.SingleDeviceDistributor" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;BaseDistributor&lt;/span&gt; (&lt;code&gt;formed.integrations.flax.distributors.BaseDistributor&lt;/code&gt;)" href="#formed.integrations.flax.distributors.BaseDistributor">BaseDistributor</a>[<span title="formed.integrations.flax.types.ModelInputT">ModelInputT</span>]</code></p>



        <p>Distributor for single-device training.</p>
<p>This distributor applies JIT compilation without any device distribution.
All shard, replicate, and unreplicate operations are no-ops.</p>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span id="__span-0-1"><span class="gp">&gt;&gt;&gt; </span><span class="n">distributor</span> <span class="o">=</span> <span class="n">SingleDeviceDistributor</span><span class="p">()</span>
</span><span id="__span-0-2"><span class="gp">&gt;&gt;&gt; </span><span class="n">train_step</span> <span class="o">=</span> <span class="n">distributor</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">my_train_function</span><span class="p">)</span>
</span><span id="__span-0-3"><span class="gp">&gt;&gt;&gt; </span><span class="n">output</span> <span class="o">=</span> <span class="n">train_step</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">trainer</span><span class="p">)</span>
</span></code></pre></div>











<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.distributors.SingleDeviceDistributor.map" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">map</span>


<a href="#formed.integrations.flax.distributors.SingleDeviceDistributor.map" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">map</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">())</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Apply JIT compilation to a function.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>fn</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Function to compile.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="formed.integrations.flax.distributors._CallableT">_CallableT</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>static_argnums</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Indices of static arguments.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="collections.abc.Sequence">Sequence</span>[<span title="int">int</span>]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>()</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="formed.integrations.flax.distributors._CallableT">_CallableT</span></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>JIT-compiled function.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/distributors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-141"><span class="k">def</span><span class="w"> </span><span class="nf">map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">:</span> <span class="n">_CallableT</span><span class="p">,</span> <span class="n">static_argnums</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">())</span> <span class="o">-&gt;</span> <span class="n">_CallableT</span><span class="p">:</span>
</span><span id="__span-0-142"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Apply JIT compilation to a function.</span>
</span><span id="__span-0-143">
</span><span id="__span-0-144"><span class="sd">    Args:</span>
</span><span id="__span-0-145"><span class="sd">        fn: Function to compile.</span>
</span><span id="__span-0-146"><span class="sd">        static_argnums: Indices of static arguments.</span>
</span><span id="__span-0-147">
</span><span id="__span-0-148"><span class="sd">    Returns:</span>
</span><span id="__span-0-149"><span class="sd">        JIT-compiled function.</span>
</span><span id="__span-0-150">
</span><span id="__span-0-151"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-152">    <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">_CallableT</span><span class="p">,</span> <span class="n">nnx</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="n">static_argnums</span><span class="p">))</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.distributors.SingleDeviceDistributor.reduce" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">reduce</span>


<a href="#formed.integrations.flax.distributors.SingleDeviceDistributor.reduce" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">reduce</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">op</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Return array unchanged (no reduction needed for single device).</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>array</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Input array.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="formed.integrations.flax.distributors._ArrayT">_ArrayT</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>op</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Reduction operation (ignored).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="formed.integrations.flax.distributors._ReduceOp">_ReduceOp</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;mean&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="formed.integrations.flax.distributors._ArrayT">_ArrayT</span></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Input array unchanged.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/distributors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-154"><span class="k">def</span><span class="w"> </span><span class="nf">reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">:</span> <span class="n">_ArrayT</span><span class="p">,</span> <span class="n">op</span><span class="p">:</span> <span class="n">_ReduceOp</span> <span class="o">=</span> <span class="s2">&quot;mean&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_ArrayT</span><span class="p">:</span>
</span><span id="__span-0-155"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Return array unchanged (no reduction needed for single device).</span>
</span><span id="__span-0-156">
</span><span id="__span-0-157"><span class="sd">    Args:</span>
</span><span id="__span-0-158"><span class="sd">        array: Input array.</span>
</span><span id="__span-0-159"><span class="sd">        op: Reduction operation (ignored).</span>
</span><span id="__span-0-160">
</span><span id="__span-0-161"><span class="sd">    Returns:</span>
</span><span id="__span-0-162"><span class="sd">        Input array unchanged.</span>
</span><span id="__span-0-163">
</span><span id="__span-0-164"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-165">    <span class="k">return</span> <span class="n">array</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.distributors.SingleDeviceDistributor.shard" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">shard</span>


<a href="#formed.integrations.flax.distributors.SingleDeviceDistributor.shard" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">shard</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Shard inputs across devices.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>inputs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Input data to shard.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="formed.integrations.flax.types.ModelInputT">ModelInputT</span></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="formed.integrations.flax.types.ModelInputT">ModelInputT</span></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Sharded input data with an additional device dimension.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/distributors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-62"><span class="k">def</span><span class="w"> </span><span class="nf">shard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">ModelInputT</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ModelInputT</span><span class="p">:</span>
</span><span id="__span-0-63"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Shard inputs across devices.</span>
</span><span id="__span-0-64">
</span><span id="__span-0-65"><span class="sd">    Args:</span>
</span><span id="__span-0-66"><span class="sd">        inputs: Input data to shard.</span>
</span><span id="__span-0-67">
</span><span id="__span-0-68"><span class="sd">    Returns:</span>
</span><span id="__span-0-69"><span class="sd">        Sharded input data with an additional device dimension.</span>
</span><span id="__span-0-70">
</span><span id="__span-0-71"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-72">    <span class="k">return</span> <span class="n">inputs</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.distributors.SingleDeviceDistributor.replicate" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">replicate</span>


<a href="#formed.integrations.flax.distributors.SingleDeviceDistributor.replicate" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">replicate</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Replicate data across all devices.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>inputs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Data to replicate.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="formed.integrations.flax.distributors._T">_T</span></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="formed.integrations.flax.distributors._T">_T</span></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Replicated data with device dimension.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/distributors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-74"><span class="k">def</span><span class="w"> </span><span class="nf">replicate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">_T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="p">:</span>
</span><span id="__span-0-75"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Replicate data across all devices.</span>
</span><span id="__span-0-76">
</span><span id="__span-0-77"><span class="sd">    Args:</span>
</span><span id="__span-0-78"><span class="sd">        inputs: Data to replicate.</span>
</span><span id="__span-0-79">
</span><span id="__span-0-80"><span class="sd">    Returns:</span>
</span><span id="__span-0-81"><span class="sd">        Replicated data with device dimension.</span>
</span><span id="__span-0-82">
</span><span id="__span-0-83"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-84">    <span class="k">return</span> <span class="n">inputs</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.distributors.SingleDeviceDistributor.unreplicate" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">unreplicate</span>


<a href="#formed.integrations.flax.distributors.SingleDeviceDistributor.unreplicate" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">unreplicate</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Extract data from the first device, removing device dimension.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>inputs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Replicated data with device dimension.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="formed.integrations.flax.distributors._T">_T</span></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="formed.integrations.flax.distributors._T">_T</span></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Data from first device without device dimension.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/distributors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-86"><span class="k">def</span><span class="w"> </span><span class="nf">unreplicate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">_T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="p">:</span>
</span><span id="__span-0-87"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract data from the first device, removing device dimension.</span>
</span><span id="__span-0-88">
</span><span id="__span-0-89"><span class="sd">    Args:</span>
</span><span id="__span-0-90"><span class="sd">        inputs: Replicated data with device dimension.</span>
</span><span id="__span-0-91">
</span><span id="__span-0-92"><span class="sd">    Returns:</span>
</span><span id="__span-0-93"><span class="sd">        Data from first device without device dimension.</span>
</span><span id="__span-0-94">
</span><span id="__span-0-95"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-96">    <span class="k">return</span> <span class="n">inputs</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="formed.integrations.flax.distributors.DataParallelDistributor" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">DataParallelDistributor</span>


<a href="#formed.integrations.flax.distributors.DataParallelDistributor" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">DataParallelDistributor</span><span class="p">(</span>
</span><span id="__span-0-2">    <span class="n">axis_name</span><span class="o">=</span><span class="s2">&quot;batch&quot;</span><span class="p">,</span> <span class="n">num_devices</span><span class="o">=</span><span class="kc">None</span>
</span><span id="__span-0-3"><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;BaseDistributor&lt;/span&gt; (&lt;code&gt;formed.integrations.flax.distributors.BaseDistributor&lt;/code&gt;)" href="#formed.integrations.flax.distributors.BaseDistributor">BaseDistributor</a>[<span title="formed.integrations.flax.types.ModelInputT">ModelInputT</span>]</code></p>



        <p>Distributor for data-parallel training across multiple devices.</p>
<p>This distributor uses JAX's pmap to execute the same computation on
different data shards across multiple devices. Data is automatically
sharded along the batch dimension.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>axis_name</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Name for the device axis (used in reduction operations).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="str">str</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;batch&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_devices</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Number of devices to use. Defaults to all local devices.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="int">int</span> | None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span id="__span-0-1"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Train on 4 GPUs with data parallelism</span>
</span><span id="__span-0-2"><span class="gp">&gt;&gt;&gt; </span><span class="n">distributor</span> <span class="o">=</span> <span class="n">DataParallelDistributor</span><span class="p">(</span>
</span><span id="__span-0-3"><span class="gp">... </span>    <span class="n">axis_name</span><span class="o">=</span><span class="s2">&quot;batch&quot;</span><span class="p">,</span>
</span><span id="__span-0-4"><span class="gp">... </span>    <span class="n">num_devices</span><span class="o">=</span><span class="mi">4</span>
</span><span id="__span-0-5"><span class="gp">... </span><span class="p">)</span>
</span><span id="__span-0-6"><span class="gp">&gt;&gt;&gt;</span>
</span><span id="__span-0-7"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Shard batch of size 32 into 4 shards of size 8</span>
</span><span id="__span-0-8"><span class="gp">&gt;&gt;&gt; </span><span class="n">sharded</span> <span class="o">=</span> <span class="n">distributor</span><span class="o">.</span><span class="n">shard</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
</span><span id="__span-0-9"><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">sharded</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</span><span id="__span-0-10"><span class="gp">&gt;&gt;&gt;</span>
</span><span id="__span-0-11"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Map training step across devices</span>
</span><span id="__span-0-12"><span class="gp">&gt;&gt;&gt; </span><span class="n">train_step</span> <span class="o">=</span> <span class="n">distributor</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">my_train_step</span><span class="p">)</span>
</span></code></pre></div>


<details class="note" open>
  <summary>Note</summary>
  <p>Batch size must be divisible by num_devices for proper sharding.</p>
</details>







                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/formed/integrations/flax/distributors.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-199"><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="__span-0-200">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-201">    <span class="n">axis_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;batch&quot;</span><span class="p">,</span>
</span><span id="__span-0-202">    <span class="n">num_devices</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-203"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-204">    <span class="bp">self</span><span class="o">.</span><span class="n">_axis_name</span> <span class="o">=</span> <span class="n">axis_name</span>
</span><span id="__span-0-205">    <span class="bp">self</span><span class="o">.</span><span class="n">_num_devices</span> <span class="o">=</span> <span class="n">num_devices</span> <span class="ow">or</span> <span class="n">jax</span><span class="o">.</span><span class="n">local_device_count</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.distributors.DataParallelDistributor.shard" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">shard</span>


<a href="#formed.integrations.flax.distributors.DataParallelDistributor.shard" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">shard</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Shard inputs along the batch dimension across devices.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>inputs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Input data with batch dimension.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="formed.integrations.flax.types.ModelInputT">ModelInputT</span></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="formed.integrations.flax.types.ModelInputT">ModelInputT</span></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Sharded inputs with shape (num_devices, batch_per_device, ...).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/distributors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-207"><span class="k">def</span><span class="w"> </span><span class="nf">shard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">ModelInputT</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ModelInputT</span><span class="p">:</span>
</span><span id="__span-0-208"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Shard inputs along the batch dimension across devices.</span>
</span><span id="__span-0-209">
</span><span id="__span-0-210"><span class="sd">    Args:</span>
</span><span id="__span-0-211"><span class="sd">        inputs: Input data with batch dimension.</span>
</span><span id="__span-0-212">
</span><span id="__span-0-213"><span class="sd">    Returns:</span>
</span><span id="__span-0-214"><span class="sd">        Sharded inputs with shape (num_devices, batch_per_device, ...).</span>
</span><span id="__span-0-215">
</span><span id="__span-0-216"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-217">    <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree_util</span><span class="o">.</span><span class="n">tree_map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_devices</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:]),</span> <span class="n">inputs</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.distributors.DataParallelDistributor.replicate" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">replicate</span>


<a href="#formed.integrations.flax.distributors.DataParallelDistributor.replicate" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">replicate</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Replicate data across all devices.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>inputs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Data to replicate.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="formed.integrations.flax.distributors._T">_T</span></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="formed.integrations.flax.distributors._T">_T</span></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Replicated data with device dimension.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/distributors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-219"><span class="k">def</span><span class="w"> </span><span class="nf">replicate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">_T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="p">:</span>
</span><span id="__span-0-220"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Replicate data across all devices.</span>
</span><span id="__span-0-221">
</span><span id="__span-0-222"><span class="sd">    Args:</span>
</span><span id="__span-0-223"><span class="sd">        inputs: Data to replicate.</span>
</span><span id="__span-0-224">
</span><span id="__span-0-225"><span class="sd">    Returns:</span>
</span><span id="__span-0-226"><span class="sd">        Replicated data with device dimension.</span>
</span><span id="__span-0-227">
</span><span id="__span-0-228"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-229">    <span class="k">return</span> <span class="n">flax</span><span class="o">.</span><span class="n">jax_utils</span><span class="o">.</span><span class="n">replicate</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.distributors.DataParallelDistributor.unreplicate" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">unreplicate</span>


<a href="#formed.integrations.flax.distributors.DataParallelDistributor.unreplicate" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">unreplicate</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Extract data from the first device.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>inputs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Replicated data.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="formed.integrations.flax.distributors._T">_T</span></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="formed.integrations.flax.distributors._T">_T</span></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Data from first device.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/distributors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-231"><span class="k">def</span><span class="w"> </span><span class="nf">unreplicate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">_T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="p">:</span>
</span><span id="__span-0-232"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract data from the first device.</span>
</span><span id="__span-0-233">
</span><span id="__span-0-234"><span class="sd">    Args:</span>
</span><span id="__span-0-235"><span class="sd">        inputs: Replicated data.</span>
</span><span id="__span-0-236">
</span><span id="__span-0-237"><span class="sd">    Returns:</span>
</span><span id="__span-0-238"><span class="sd">        Data from first device.</span>
</span><span id="__span-0-239">
</span><span id="__span-0-240"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-241">    <span class="k">return</span> <span class="n">flax</span><span class="o">.</span><span class="n">jax_utils</span><span class="o">.</span><span class="n">unreplicate</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.distributors.DataParallelDistributor.map" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">map</span>


<a href="#formed.integrations.flax.distributors.DataParallelDistributor.map" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">map</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">())</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Map function across devices using pmap.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>fn</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Function to parallelize.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="formed.integrations.flax.distributors._CallableT">_CallableT</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>static_argnums</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Indices of static arguments to broadcast.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="collections.abc.Sequence">Sequence</span>[<span title="int">int</span>]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>()</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="formed.integrations.flax.distributors._CallableT">_CallableT</span></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Parallelized function using pmap.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/distributors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-243"><span class="k">def</span><span class="w"> </span><span class="nf">map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">:</span> <span class="n">_CallableT</span><span class="p">,</span> <span class="n">static_argnums</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">())</span> <span class="o">-&gt;</span> <span class="n">_CallableT</span><span class="p">:</span>
</span><span id="__span-0-244"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Map function across devices using pmap.</span>
</span><span id="__span-0-245">
</span><span id="__span-0-246"><span class="sd">    Args:</span>
</span><span id="__span-0-247"><span class="sd">        fn: Function to parallelize.</span>
</span><span id="__span-0-248"><span class="sd">        static_argnums: Indices of static arguments to broadcast.</span>
</span><span id="__span-0-249">
</span><span id="__span-0-250"><span class="sd">    Returns:</span>
</span><span id="__span-0-251"><span class="sd">        Parallelized function using pmap.</span>
</span><span id="__span-0-252">
</span><span id="__span-0-253"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-254">    <span class="k">return</span> <span class="n">nnx</span><span class="o">.</span><span class="n">pmap</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">axis_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_axis_name</span><span class="p">,</span> <span class="n">static_broadcasted_argnums</span><span class="o">=</span><span class="n">static_argnums</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.distributors.DataParallelDistributor.reduce" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">reduce</span>


<a href="#formed.integrations.flax.distributors.DataParallelDistributor.reduce" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">reduce</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">op</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Reduce array across devices.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>array</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Array to reduce across device dimension.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="formed.integrations.flax.distributors._ArrayT">_ArrayT</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>op</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Reduction operation - <code>"sum"</code> or <code>"mean"</code>.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="formed.integrations.flax.distributors._ReduceOp">_ReduceOp</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;mean&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="formed.integrations.flax.distributors._ArrayT">_ArrayT</span></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Reduced array.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RAISES</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
              <span class="doc-raises-annotation">
                  <code><span title="ValueError">ValueError</span></code>
              </span>
            </td>
            <td class="doc-raises-details">
              <div class="doc-md-description">
                <p>If unsupported reduction operation is specified.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/distributors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-256"><span class="k">def</span><span class="w"> </span><span class="nf">reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">:</span> <span class="n">_ArrayT</span><span class="p">,</span> <span class="n">op</span><span class="p">:</span> <span class="n">_ReduceOp</span> <span class="o">=</span> <span class="s2">&quot;mean&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_ArrayT</span><span class="p">:</span>
</span><span id="__span-0-257"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Reduce array across devices.</span>
</span><span id="__span-0-258">
</span><span id="__span-0-259"><span class="sd">    Args:</span>
</span><span id="__span-0-260"><span class="sd">        array: Array to reduce across device dimension.</span>
</span><span id="__span-0-261"><span class="sd">        op: Reduction operation - `&quot;sum&quot;` or `&quot;mean&quot;`.</span>
</span><span id="__span-0-262">
</span><span id="__span-0-263"><span class="sd">    Returns:</span>
</span><span id="__span-0-264"><span class="sd">        Reduced array.</span>
</span><span id="__span-0-265">
</span><span id="__span-0-266"><span class="sd">    Raises:</span>
</span><span id="__span-0-267"><span class="sd">        ValueError: If unsupported reduction operation is specified.</span>
</span><span id="__span-0-268">
</span><span id="__span-0-269"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-270">    <span class="k">if</span> <span class="n">op</span> <span class="o">==</span> <span class="s2">&quot;sum&quot;</span><span class="p">:</span>
</span><span id="__span-0-271">        <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">psum</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">axis_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_axis_name</span><span class="p">)</span>
</span><span id="__span-0-272">    <span class="k">elif</span> <span class="n">op</span> <span class="o">==</span> <span class="s2">&quot;mean&quot;</span><span class="p">:</span>
</span><span id="__span-0-273">        <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">pmean</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">axis_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_axis_name</span><span class="p">)</span>
</span><span id="__span-0-274">    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported reduce operation: </span><span class="si">{</span><span class="n">op</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="formed.integrations.flax.model" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">formed.integrations.flax.model</span>


<a href="#formed.integrations.flax.model" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

        <p>Base model abstraction for Flax NNX models.</p>
<p>This module provides the base class for all Flax models in the framework,
integrating Flax NNX with the registrable pattern for configuration-based
model instantiation.</p>


<details class="key-features" open>
  <summary>Key Features</summary>
  <ul>
<li>Integration with Flax NNX Module system</li>
<li>Registrable pattern for configuration-based instantiation</li>
<li>Generic type support for inputs, outputs, and parameters</li>
<li>Compatible with FlaxTrainer for end-to-end training</li>
</ul>
</details>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span id="__span-0-1"><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">formed.integrations.flax</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseFlaxModel</span>
</span><span id="__span-0-2"><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">flax</span><span class="w"> </span><span class="kn">import</span> <span class="n">nnx</span>
</span><span id="__span-0-3"><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">jax</span>
</span><span id="__span-0-4"><span class="gp">&gt;&gt;&gt;</span>
</span><span id="__span-0-5"><span class="gp">&gt;&gt;&gt; </span><span class="nd">@BaseFlaxModel</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;my_model&quot;</span><span class="p">)</span>
</span><span id="__span-0-6"><span class="gp">... </span><span class="k">class</span><span class="w"> </span><span class="nc">MyModel</span><span class="p">(</span><span class="n">BaseFlaxModel</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="n">jax</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="kc">None</span><span class="p">]):</span>
</span><span id="__span-0-7"><span class="gp">... </span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rngs</span><span class="p">:</span> <span class="n">nnx</span><span class="o">.</span><span class="n">Rngs</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-8"><span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">linear</span> <span class="o">=</span> <span class="n">nnx</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="p">,</span> <span class="n">rngs</span><span class="o">=</span><span class="n">rngs</span><span class="p">)</span>
</span><span id="__span-0-9"><span class="gp">...</span>
</span><span id="__span-0-10"><span class="gp">... </span>    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">jax</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
</span><span id="__span-0-11"><span class="gp">... </span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear</span><span class="p">(</span><span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">])</span>
</span></code></pre></div>










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h3 id="formed.integrations.flax.model.BaseFlaxModel" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">BaseFlaxModel</span>


<a href="#formed.integrations.flax.model.BaseFlaxModel" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="flax.nnx.Module">Module</span></code>, <code><span title="colt.Registrable">Registrable</span></code>, <code><span title="typing.Generic">Generic</span>[<span title="formed.integrations.flax.types.ModelInputT">ModelInputT</span>, <span title="formed.integrations.flax.types.ModelOutputT">ModelOutputT</span>, <span title="formed.integrations.flax.types.ModelParamsT">ModelParamsT</span>]</code></p>



        <p>Base class for all Flax NNX models in the framework.</p>
<p>This class combines Flax's NNX Module with the registrable pattern,
allowing models to be instantiated from configuration files and
seamlessly integrated with the training infrastructure.</p>


<table>
      <thead>
        <tr>
          <th>
            <span class="doc-section-title">
              CLASS TYPE PARAMETER
            </span>
          </th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ModelInputT</code>
            </td>
            <td class="doc-type_param-details">
              <div class="doc-md-description">
                <p>Type of input data to the model.</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ModelOutputT</code>
            </td>
            <td class="doc-type_param-details">
              <div class="doc-md-description">
                <p>Type of model output.</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ModelParamsT</code>
            </td>
            <td class="doc-type_param-details">
              <div class="doc-md-description">
                <p>Type of additional parameters (typically <code>None</code> or a dataclass).</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>Subclasses should implement <code>__call__</code> to define the forward pass.
Models are automatically compatible with <code>FlaxTrainer</code> when registered.</p>
</details>










<div class="doc doc-children">












  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="formed.integrations.flax.modules.embedders" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">formed.integrations.flax.modules.embedders</span>


<a href="#formed.integrations.flax.modules.embedders" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

        <p>Text embedding modules for Flax models.</p>
<p>This module provides embedders that convert tokenized text into dense vector
representations. Embedders handle various text representations including
surface forms, part-of-speech tags, and character sequences.</p>


<details class="key-components" open>
  <summary>Key Components</summary>
  <ul>
<li>BaseEmbedder: Abstract base class for all embedders</li>
<li>TokenEmbedder: Embeds token ID sequences into dense vectors</li>
<li>AnalyzedTextEmbedder: Combines multiple embedding types (surface, POS, chars)</li>
</ul>
</details>

<details class="features" open>
  <summary>Features</summary>
  <ul>
<li>Support for nested token sequences (e.g., word -&gt; character)</li>
<li>Automatic masking and padding handling</li>
<li>Configurable vectorization for character-level embeddings</li>
<li>Concatenation of multiple embedding types</li>
</ul>
</details>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span id="__span-0-1"><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">formed.integrations.flax.modules</span><span class="w"> </span><span class="kn">import</span> <span class="n">TokenEmbedder</span><span class="p">,</span> <span class="n">AnalyzedTextEmbedder</span>
</span><span id="__span-0-2"><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">flax</span><span class="w"> </span><span class="kn">import</span> <span class="n">nnx</span>
</span><span id="__span-0-3"><span class="gp">&gt;&gt;&gt;</span>
</span><span id="__span-0-4"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Simple token embedder</span>
</span><span id="__span-0-5"><span class="gp">&gt;&gt;&gt; </span><span class="n">embedder</span> <span class="o">=</span> <span class="n">TokenEmbedder</span><span class="p">(</span>
</span><span id="__span-0-6"><span class="gp">... </span>    <span class="n">vocab_size</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
</span><span id="__span-0-7"><span class="gp">... </span>    <span class="n">embedding_dim</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
</span><span id="__span-0-8"><span class="gp">... </span>    <span class="n">rngs</span><span class="o">=</span><span class="n">nnx</span><span class="o">.</span><span class="n">Rngs</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-9"><span class="gp">... </span><span class="p">)</span>
</span><span id="__span-0-10"><span class="gp">&gt;&gt;&gt;</span>
</span><span id="__span-0-11"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Multi-feature embedder</span>
</span><span id="__span-0-12"><span class="gp">&gt;&gt;&gt; </span><span class="n">embedder</span> <span class="o">=</span> <span class="n">AnalyzedTextEmbedder</span><span class="p">(</span>
</span><span id="__span-0-13"><span class="gp">... </span>    <span class="n">surface</span><span class="o">=</span><span class="n">TokenEmbedder</span><span class="p">(</span><span class="n">vocab_size</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">rngs</span><span class="o">=</span><span class="n">rngs</span><span class="p">),</span>
</span><span id="__span-0-14"><span class="gp">... </span>    <span class="n">postag</span><span class="o">=</span><span class="n">TokenEmbedder</span><span class="p">(</span><span class="n">vocab_size</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">rngs</span><span class="o">=</span><span class="n">rngs</span><span class="p">)</span>
</span><span id="__span-0-15"><span class="gp">... </span><span class="p">)</span>
</span></code></pre></div>










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h3 id="formed.integrations.flax.modules.embedders.EmbedderOutput" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">EmbedderOutput</span>


<a href="#formed.integrations.flax.modules.embedders.EmbedderOutput" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.NamedTuple">NamedTuple</span></code></p>



        <p>Output from an embedder.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">ATTRIBUTE</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-attribute&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-attribute-name&quot;&gt;embeddings&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-instance-attribute&quot;&gt;&lt;code&gt;instance-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;formed.integrations.flax.modules.embedders.EmbedderOutput.embeddings&lt;/code&gt;)" href="#formed.integrations.flax.modules.embedders.EmbedderOutput.embeddings">embeddings</a></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                <p>Dense embeddings of shape (batch_size, seq_len, embedding_dim).</p>
              </div>
              <p>
                  <span class="doc-attribute-annotation">
                    <b>TYPE:</b>
                      <code><span title="jax.Array">Array</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-attribute&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-attribute-name&quot;&gt;mask&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-instance-attribute&quot;&gt;&lt;code&gt;instance-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;formed.integrations.flax.modules.embedders.EmbedderOutput.mask&lt;/code&gt;)" href="#formed.integrations.flax.modules.embedders.EmbedderOutput.mask">mask</a></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                <p>Attention mask of shape (batch_size, seq_len).</p>
              </div>
              <p>
                  <span class="doc-attribute-annotation">
                    <b>TYPE:</b>
                      <code><span title="jax.Array">Array</span></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>











<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="formed.integrations.flax.modules.embedders.EmbedderOutput.embeddings" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">embeddings</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#formed.integrations.flax.modules.embedders.EmbedderOutput.embeddings" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">embeddings</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="formed.integrations.flax.modules.embedders.EmbedderOutput.mask" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">mask</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#formed.integrations.flax.modules.embedders.EmbedderOutput.mask" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">mask</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>






  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="formed.integrations.flax.modules.embedders.BaseEmbedder" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">BaseEmbedder</span>


<a href="#formed.integrations.flax.modules.embedders.BaseEmbedder" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="flax.nnx.Module">Module</span></code>, <code><span title="colt.Registrable">Registrable</span></code>, <code><span title="typing.Generic">Generic</span>[<span title="formed.integrations.flax.modules.embedders._TextBatchT">_TextBatchT</span>]</code>, <code><span title="abc.ABC">ABC</span></code></p>



        <p>Abstract base class for text embedders.</p>
<p>Embedders convert tokenized text into dense vector representations.
They output both embeddings and attention masks.</p>


<table>
      <thead>
        <tr>
          <th>
            <span class="doc-section-title">
              CLASS TYPE PARAMETER
            </span>
          </th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>_TextBatchT</code>
            </td>
            <td class="doc-type_param-details">
              <div class="doc-md-description">
                <p>Type of input batch (e.g., IIDSequenceBatch, IAnalyzedTextBatch).</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
      </tbody>
    </table>











<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.modules.embedders.BaseEmbedder.get_output_dim" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_output_dim</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

<a href="#formed.integrations.flax.modules.embedders.BaseEmbedder.get_output_dim" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">get_output_dim</span><span class="p">()</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Get the output embedding dimension.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="int">int</span></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Embedding dimension.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/modules/embedders.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-89"><span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
</span><span id="__span-0-90"><span class="k">def</span><span class="w"> </span><span class="nf">get_output_dim</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="__span-0-91"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the output embedding dimension.</span>
</span><span id="__span-0-92">
</span><span id="__span-0-93"><span class="sd">    Returns:</span>
</span><span id="__span-0-94"><span class="sd">        Embedding dimension.</span>
</span><span id="__span-0-95">
</span><span id="__span-0-96"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-97">    <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="formed.integrations.flax.modules.embedders.TokenEmbedder" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">TokenEmbedder</span>


<a href="#formed.integrations.flax.modules.embedders.TokenEmbedder" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">TokenEmbedder</span><span class="p">(</span>
</span><span id="__span-0-2">    <span class="n">vocab_size</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">vectorizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rngs</span><span class="o">=</span><span class="kc">None</span>
</span><span id="__span-0-3"><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;BaseEmbedder&lt;/span&gt; (&lt;code&gt;formed.integrations.flax.modules.embedders.BaseEmbedder&lt;/code&gt;)" href="#formed.integrations.flax.modules.embedders.BaseEmbedder">BaseEmbedder</a>[<span title="formed.integrations.flax.types.IIDSequenceBatch">IIDSequenceBatch</span>]</code></p>



        <p>Embedder for token ID sequences.</p>
<p>This embedder converts token IDs into dense embeddings using a learned
embedding matrix. It supports both 2D (batch_size, seq_len) and 3D
(batch_size, seq_len, char_len) token ID tensors.</p>
<p>For 3D inputs (e.g., character-level tokens within words), the embedder
can either average the embeddings or apply a custom vectorizer.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>vocab_size</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Size of the vocabulary.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="int">int</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>embedding_dim</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Dimension of the embedding vectors.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="int">int</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>vectorizer</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Optional vectorizer for 3D inputs (character sequences).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;BaseSequenceVectorizer&lt;/span&gt; (&lt;code&gt;formed.integrations.flax.modules.vectorizers.BaseSequenceVectorizer&lt;/code&gt;)" href="#formed.integrations.flax.modules.vectorizers.BaseSequenceVectorizer">BaseSequenceVectorizer</a> | None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rngs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Random number generators.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="flax.nnx.Rngs">Rngs</span> | None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span id="__span-0-1"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Simple word embeddings</span>
</span><span id="__span-0-2"><span class="gp">&gt;&gt;&gt; </span><span class="n">embedder</span> <span class="o">=</span> <span class="n">TokenEmbedder</span><span class="p">(</span><span class="n">vocab_size</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">rngs</span><span class="o">=</span><span class="n">rngs</span><span class="p">)</span>
</span><span id="__span-0-3"><span class="gp">&gt;&gt;&gt; </span><span class="n">output</span> <span class="o">=</span> <span class="n">embedder</span><span class="p">(</span><span class="n">word_ids_batch</span><span class="p">)</span>
</span><span id="__span-0-4"><span class="gp">&gt;&gt;&gt;</span>
</span><span id="__span-0-5"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Character-level embeddings with pooling</span>
</span><span id="__span-0-6"><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">formed.integrations.flax.modules</span><span class="w"> </span><span class="kn">import</span> <span class="n">BagOfEmbeddingsSequenceVectorizer</span>
</span><span id="__span-0-7"><span class="gp">&gt;&gt;&gt; </span><span class="n">embedder</span> <span class="o">=</span> <span class="n">TokenEmbedder</span><span class="p">(</span>
</span><span id="__span-0-8"><span class="gp">... </span>    <span class="n">vocab_size</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span>
</span><span id="__span-0-9"><span class="gp">... </span>    <span class="n">embedding_dim</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>
</span><span id="__span-0-10"><span class="gp">... </span>    <span class="n">vectorizer</span><span class="o">=</span><span class="n">BagOfEmbeddingsSequenceVectorizer</span><span class="p">(</span><span class="n">pooling</span><span class="o">=</span><span class="s2">&quot;max&quot;</span><span class="p">),</span>
</span><span id="__span-0-11"><span class="gp">... </span>    <span class="n">rngs</span><span class="o">=</span><span class="n">rngs</span>
</span><span id="__span-0-12"><span class="gp">... </span><span class="p">)</span>
</span></code></pre></div>








                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/formed/integrations/flax/modules/embedders.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-133"><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="__span-0-134">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-135">    <span class="n">vocab_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="__span-0-136">    <span class="n">embedding_dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="__span-0-137">    <span class="o">*</span><span class="p">,</span>
</span><span id="__span-0-138">    <span class="n">vectorizer</span><span class="p">:</span> <span class="n">BaseSequenceVectorizer</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-139">    <span class="n">rngs</span><span class="p">:</span> <span class="n">nnx</span><span class="o">.</span><span class="n">Rngs</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-140"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-141">    <span class="n">rngs</span> <span class="o">=</span> <span class="n">rngs</span> <span class="ow">or</span> <span class="n">require_rngs</span><span class="p">()</span>
</span><span id="__span-0-142">    <span class="bp">self</span><span class="o">.</span><span class="n">_embedding</span> <span class="o">=</span> <span class="n">nnx</span><span class="o">.</span><span class="n">Embed</span><span class="p">(</span><span class="n">num_embeddings</span><span class="o">=</span><span class="n">vocab_size</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="n">embedding_dim</span><span class="p">,</span> <span class="n">rngs</span><span class="o">=</span><span class="n">rngs</span><span class="p">)</span>
</span><span id="__span-0-143">    <span class="bp">self</span><span class="o">.</span><span class="n">_vectorizer</span> <span class="o">=</span> <span class="n">vectorizer</span>
</span></code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.modules.embedders.TokenEmbedder.get_output_dim" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_output_dim</span>


<a href="#formed.integrations.flax.modules.embedders.TokenEmbedder.get_output_dim" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">get_output_dim</span><span class="p">()</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/modules/embedders.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">175</span>
<span class="normal">176</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-175"><span class="k">def</span><span class="w"> </span><span class="nf">get_output_dim</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="__span-0-176">    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_embedding</span><span class="o">.</span><span class="n">features</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="formed.integrations.flax.modules.embedders.AnalyzedTextEmbedder" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">AnalyzedTextEmbedder</span>


<a href="#formed.integrations.flax.modules.embedders.AnalyzedTextEmbedder" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">AnalyzedTextEmbedder</span><span class="p">(</span>
</span><span id="__span-0-2">    <span class="n">surface</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">postag</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">character</span><span class="o">=</span><span class="kc">None</span>
</span><span id="__span-0-3"><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;BaseEmbedder&lt;/span&gt; (&lt;code&gt;formed.integrations.flax.modules.embedders.BaseEmbedder&lt;/code&gt;)" href="#formed.integrations.flax.modules.embedders.BaseEmbedder">BaseEmbedder</a>[<span title="formed.integrations.flax.types.IAnalyzedTextBatch">IAnalyzedTextBatch</span>]</code></p>



        <p>Embedder for analyzed text with multiple linguistic features.</p>
<p>This embedder combines embeddings from multiple linguistic representations
(surface forms, part-of-speech tags, character sequences) by concatenating
them along the feature dimension.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>surface</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Optional embedder for surface form tokens.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;BaseEmbedder&lt;/span&gt; (&lt;code&gt;formed.integrations.flax.modules.embedders.BaseEmbedder&lt;/code&gt;)" href="#formed.integrations.flax.modules.embedders.BaseEmbedder">BaseEmbedder</a>[<span title="formed.integrations.flax.types.IIDSequenceBatch">IIDSequenceBatch</span>] | None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>postag</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Optional embedder for part-of-speech tags.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;BaseEmbedder&lt;/span&gt; (&lt;code&gt;formed.integrations.flax.modules.embedders.BaseEmbedder&lt;/code&gt;)" href="#formed.integrations.flax.modules.embedders.BaseEmbedder">BaseEmbedder</a>[<span title="formed.integrations.flax.types.IIDSequenceBatch">IIDSequenceBatch</span>] | None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>character</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Optional embedder for character sequences.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;BaseEmbedder&lt;/span&gt; (&lt;code&gt;formed.integrations.flax.modules.embedders.BaseEmbedder&lt;/code&gt;)" href="#formed.integrations.flax.modules.embedders.BaseEmbedder">BaseEmbedder</a>[<span title="formed.integrations.flax.types.IIDSequenceBatch">IIDSequenceBatch</span>] | None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RAISES</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
              <span class="doc-raises-annotation">
                  <code><span title="ValueError">ValueError</span></code>
              </span>
            </td>
            <td class="doc-raises-details">
              <div class="doc-md-description">
                <p>If all embedders are None (at least one is required).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span id="__span-0-1"><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">formed.integrations.flax.modules</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="__span-0-2"><span class="gp">... </span>    <span class="n">AnalyzedTextEmbedder</span><span class="p">,</span>
</span><span id="__span-0-3"><span class="gp">... </span>    <span class="n">TokenEmbedder</span>
</span><span id="__span-0-4"><span class="gp">... </span><span class="p">)</span>
</span><span id="__span-0-5"><span class="gp">&gt;&gt;&gt;</span>
</span><span id="__span-0-6"><span class="gp">&gt;&gt;&gt; </span><span class="n">embedder</span> <span class="o">=</span> <span class="n">AnalyzedTextEmbedder</span><span class="p">(</span>
</span><span id="__span-0-7"><span class="gp">... </span>    <span class="n">surface</span><span class="o">=</span><span class="n">TokenEmbedder</span><span class="p">(</span><span class="n">vocab_size</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">rngs</span><span class="o">=</span><span class="n">rngs</span><span class="p">),</span>
</span><span id="__span-0-8"><span class="gp">... </span>    <span class="n">postag</span><span class="o">=</span><span class="n">TokenEmbedder</span><span class="p">(</span><span class="n">vocab_size</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">rngs</span><span class="o">=</span><span class="n">rngs</span><span class="p">),</span>
</span><span id="__span-0-9"><span class="gp">... </span>    <span class="n">character</span><span class="o">=</span><span class="n">TokenEmbedder</span><span class="p">(</span><span class="n">vocab_size</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">rngs</span><span class="o">=</span><span class="n">rngs</span><span class="p">)</span>
</span><span id="__span-0-10"><span class="gp">... </span><span class="p">)</span>
</span><span id="__span-0-11"><span class="gp">&gt;&gt;&gt;</span>
</span><span id="__span-0-12"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Output dimension is sum of all embedding dimensions (128 + 32 + 32 = 192)</span>
</span><span id="__span-0-13"><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">embedder</span><span class="o">.</span><span class="n">get_output_dim</span><span class="p">()</span> <span class="o">==</span> <span class="mi">192</span>
</span></code></pre></div>


<details class="note" open>
  <summary>Note</summary>
  <p>All provided embedders share the same mask, which is taken from
the last non-None embedder processed.</p>
</details>







                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/formed/integrations/flax/modules/embedders.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-216"><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="__span-0-217">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-218">    <span class="n">surface</span><span class="p">:</span> <span class="n">BaseEmbedder</span><span class="p">[</span><span class="n">IIDSequenceBatch</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-219">    <span class="n">postag</span><span class="p">:</span> <span class="n">BaseEmbedder</span><span class="p">[</span><span class="n">IIDSequenceBatch</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-220">    <span class="n">character</span><span class="p">:</span> <span class="n">BaseEmbedder</span><span class="p">[</span><span class="n">IIDSequenceBatch</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-221"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-222">    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">embedder</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">embedder</span> <span class="ow">in</span> <span class="p">(</span><span class="n">surface</span><span class="p">,</span> <span class="n">postag</span><span class="p">,</span> <span class="n">character</span><span class="p">)):</span>
</span><span id="__span-0-223">        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;At least one embedder must be provided for AnalyzedTextEmbedder.&quot;</span><span class="p">)</span>
</span><span id="__span-0-224">
</span><span id="__span-0-225">    <span class="bp">self</span><span class="o">.</span><span class="n">_surface</span> <span class="o">=</span> <span class="n">surface</span>
</span><span id="__span-0-226">    <span class="bp">self</span><span class="o">.</span><span class="n">_postag</span> <span class="o">=</span> <span class="n">postag</span>
</span><span id="__span-0-227">    <span class="bp">self</span><span class="o">.</span><span class="n">_character</span> <span class="o">=</span> <span class="n">character</span>
</span></code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.modules.embedders.AnalyzedTextEmbedder.get_output_dim" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_output_dim</span>


<a href="#formed.integrations.flax.modules.embedders.AnalyzedTextEmbedder.get_output_dim" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">get_output_dim</span><span class="p">()</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/modules/embedders.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-247"><span class="k">def</span><span class="w"> </span><span class="nf">get_output_dim</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="__span-0-248">    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span>
</span><span id="__span-0-249">        <span class="n">embedder</span><span class="o">.</span><span class="n">get_output_dim</span><span class="p">()</span>
</span><span id="__span-0-250">        <span class="k">for</span> <span class="n">embedder</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_surface</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_postag</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_character</span><span class="p">)</span>
</span><span id="__span-0-251">        <span class="k">if</span> <span class="n">embedder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="__span-0-252">    <span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="formed.integrations.flax.modules.encoders" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">formed.integrations.flax.modules.encoders</span>


<a href="#formed.integrations.flax.modules.encoders" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

        <p>Sequence encoding modules for Flax models.</p>
<p>This module provides encoders that process sequential data, including
position encoders, RNN-based encoders, and transformer encoders.</p>


<details class="key-components" open>
  <summary>Key Components</summary>
  <p>Position Encoders:
- BasePositionEncoder: Abstract base for position encoding
- SinusoidalPositionEncoder: Sinusoidal position embeddings
- LearnablePositionEncoder: Learned position embeddings</p>
<p>Sequence Encoders:
- BaseSequenceEncoder: Abstract base for sequence encoders
- RNNSequenceEncoder: Generic RNN encoder (LSTM, GRU, vanilla RNN)
- LSTMSequenceEncoder: LSTM-specific encoder
- OptimizedLSTMSequenceEncoder: Optimized LSTM encoder
- GRUSequenceEncoder: GRU-specific encoder
- TransformerSequenceEncoder: Transformer encoder with multi-head attention</p>
</details>

<details class="features" open>
  <summary>Features</summary>
  <ul>
<li>Bidirectional RNN support</li>
<li>Stacked layers with dropout</li>
<li>Position encoding for transformers</li>
<li>Efficient implementation using scan and vmap</li>
<li>Masked sequence processing</li>
</ul>
</details>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span id="__span-0-1"><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">formed.integrations.flax.modules</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="__span-0-2"><span class="gp">... </span>    <span class="n">LSTMSequenceEncoder</span><span class="p">,</span>
</span><span id="__span-0-3"><span class="gp">... </span>    <span class="n">TransformerSequenceEncoder</span><span class="p">,</span>
</span><span id="__span-0-4"><span class="gp">... </span>    <span class="n">SinusoidalPositionEncoder</span>
</span><span id="__span-0-5"><span class="gp">... </span><span class="p">)</span>
</span><span id="__span-0-6"><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">flax</span><span class="w"> </span><span class="kn">import</span> <span class="n">nnx</span>
</span><span id="__span-0-7"><span class="gp">&gt;&gt;&gt;</span>
</span><span id="__span-0-8"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Bidirectional LSTM encoder</span>
</span><span id="__span-0-9"><span class="gp">&gt;&gt;&gt; </span><span class="n">encoder</span> <span class="o">=</span> <span class="n">LSTMSequenceEncoder</span><span class="p">(</span>
</span><span id="__span-0-10"><span class="gp">... </span>    <span class="n">features</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
</span><span id="__span-0-11"><span class="gp">... </span>    <span class="n">num_layers</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="__span-0-12"><span class="gp">... </span>    <span class="n">bidirectional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-13"><span class="gp">... </span>    <span class="n">dropout</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
</span><span id="__span-0-14"><span class="gp">... </span>    <span class="n">rngs</span><span class="o">=</span><span class="n">nnx</span><span class="o">.</span><span class="n">Rngs</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-15"><span class="gp">... </span><span class="p">)</span>
</span><span id="__span-0-16"><span class="gp">&gt;&gt;&gt;</span>
</span><span id="__span-0-17"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Transformer encoder with sinusoidal positions</span>
</span><span id="__span-0-18"><span class="gp">&gt;&gt;&gt; </span><span class="n">encoder</span> <span class="o">=</span> <span class="n">TransformerSequenceEncoder</span><span class="p">(</span>
</span><span id="__span-0-19"><span class="gp">... </span>    <span class="n">features</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
</span><span id="__span-0-20"><span class="gp">... </span>    <span class="n">num_heads</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
</span><span id="__span-0-21"><span class="gp">... </span>    <span class="n">num_layers</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
</span><span id="__span-0-22"><span class="gp">... </span>    <span class="n">position_encoder</span><span class="o">=</span><span class="n">SinusoidalPositionEncoder</span><span class="p">(),</span>
</span><span id="__span-0-23"><span class="gp">... </span>    <span class="n">rngs</span><span class="o">=</span><span class="n">rngs</span>
</span><span id="__span-0-24"><span class="gp">... </span><span class="p">)</span>
</span></code></pre></div>










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h3 id="formed.integrations.flax.modules.encoders.BasePositionEncoder" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">BasePositionEncoder</span>


<a href="#formed.integrations.flax.modules.encoders.BasePositionEncoder" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="colt.Registrable">Registrable</span></code>, <code><span title="abc.ABC">ABC</span></code></p>



        <p>Abstract base class for position encoders.</p>
<p>Position encoders add positional information to input embeddings,
allowing models to understand token positions in sequences.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="formed.integrations.flax.modules.encoders.SinusoidalPositionEncoder" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">SinusoidalPositionEncoder</span>


<a href="#formed.integrations.flax.modules.encoders.SinusoidalPositionEncoder" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">SinusoidalPositionEncoder</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">512</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;BasePositionEncoder&lt;/span&gt; (&lt;code&gt;formed.integrations.flax.modules.encoders.BasePositionEncoder&lt;/code&gt;)" href="#formed.integrations.flax.modules.encoders.BasePositionEncoder">BasePositionEncoder</a></code></p>



        <p>Sinusoidal position encoding from "Attention Is All You Need".</p>
<p>This encoder uses sine and cosine functions of different frequencies
to generate position embeddings without learnable parameters.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>max_length</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Maximum sequence length to support.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="int">int</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>512</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span id="__span-0-1"><span class="gp">&gt;&gt;&gt; </span><span class="n">encoder</span> <span class="o">=</span> <span class="n">SinusoidalPositionEncoder</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">512</span><span class="p">)</span>
</span><span id="__span-0-2"><span class="gp">&gt;&gt;&gt; </span><span class="n">encoded</span> <span class="o">=</span> <span class="n">encoder</span><span class="p">(</span><span class="n">embeddings</span><span class="p">)</span>
</span></code></pre></div>


<details class="note" open>
  <summary>Note</summary>
  <p>Encodings are cached for efficiency.</p>
</details>







                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/formed/integrations/flax/modules/encoders.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">110</span>
<span class="normal">111</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-110"><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">512</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-111">    <span class="bp">self</span><span class="o">.</span><span class="n">max_length</span> <span class="o">=</span> <span class="n">max_length</span>
</span></code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="formed.integrations.flax.modules.encoders.SinusoidalPositionEncoder.max_length" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">max_length</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#formed.integrations.flax.modules.encoders.SinusoidalPositionEncoder.max_length" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">max_length</span> <span class="o">=</span> <span class="n"><span title="formed.integrations.flax.modules.encoders.SinusoidalPositionEncoder(max_length)">max_length</span></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>






  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="formed.integrations.flax.modules.encoders.LearnablePositionEncoder" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">LearnablePositionEncoder</span>


<a href="#formed.integrations.flax.modules.encoders.LearnablePositionEncoder" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">LearnablePositionEncoder</span><span class="p">(</span>
</span><span id="__span-0-2">    <span class="n">features</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">rngs</span><span class="o">=</span><span class="kc">None</span>
</span><span id="__span-0-3"><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;BasePositionEncoder&lt;/span&gt; (&lt;code&gt;formed.integrations.flax.modules.encoders.BasePositionEncoder&lt;/code&gt;)" href="#formed.integrations.flax.modules.encoders.BasePositionEncoder">BasePositionEncoder</a></code></p>



        <p>Learnable position embeddings.</p>
<p>This encoder uses a learned embedding matrix for position encoding,
allowing the model to learn task-specific positional patterns.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>features</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Embedding dimension.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="int">int</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rngs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Random number generators.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="flax.nnx.Rngs">Rngs</span> | None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_length</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Maximum sequence length to support.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="int">int</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>512</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span id="__span-0-1"><span class="gp">&gt;&gt;&gt; </span><span class="n">encoder</span> <span class="o">=</span> <span class="n">LearnablePositionEncoder</span><span class="p">(</span>
</span><span id="__span-0-2"><span class="gp">... </span>    <span class="n">features</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
</span><span id="__span-0-3"><span class="gp">... </span>    <span class="n">max_length</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span>
</span><span id="__span-0-4"><span class="gp">... </span>    <span class="n">rngs</span><span class="o">=</span><span class="n">rngs</span>
</span><span id="__span-0-5"><span class="gp">... </span><span class="p">)</span>
</span></code></pre></div>








                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/formed/integrations/flax/modules/encoders.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-147"><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="__span-0-148">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-149">    <span class="n">features</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="__span-0-150">    <span class="o">*</span><span class="p">,</span>
</span><span id="__span-0-151">    <span class="n">max_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">512</span><span class="p">,</span>
</span><span id="__span-0-152">    <span class="n">rngs</span><span class="p">:</span> <span class="n">nnx</span><span class="o">.</span><span class="n">Rngs</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-153"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-154">    <span class="n">rngs</span> <span class="o">=</span> <span class="n">rngs</span> <span class="ow">or</span> <span class="n">require_rngs</span><span class="p">()</span>
</span><span id="__span-0-155">    <span class="bp">self</span><span class="o">.</span><span class="n">embed</span> <span class="o">=</span> <span class="n">nnx</span><span class="o">.</span><span class="n">Embed</span><span class="p">(</span><span class="n">max_length</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">rngs</span><span class="o">=</span><span class="n">rngs</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="formed.integrations.flax.modules.encoders.LearnablePositionEncoder.embed" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">embed</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#formed.integrations.flax.modules.encoders.LearnablePositionEncoder.embed" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">embed</span> <span class="o">=</span> <span class="n"><span title="flax.nnx.Embed">Embed</span></span><span class="p">(</span><span class="n"><span title="formed.integrations.flax.modules.encoders.LearnablePositionEncoder(max_length)">max_length</span></span><span class="p">,</span> <span class="n"><span title="formed.integrations.flax.modules.encoders.LearnablePositionEncoder(features)">features</span></span><span class="p">,</span> <span class="n"><span title="flax.nnx.Embed(rngs)">rngs</span></span><span class="o">=</span><span class="n"><span title="formed.integrations.flax.modules.encoders.LearnablePositionEncoder(rngs)">rngs</span></span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>






  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="formed.integrations.flax.modules.encoders.BaseSequenceEncoder" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">BaseSequenceEncoder</span>


<a href="#formed.integrations.flax.modules.encoders.BaseSequenceEncoder" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="flax.nnx.Module">Module</span></code>, <code><span title="colt.Registrable">Registrable</span></code>, <code><span title="abc.ABC">ABC</span></code></p>



        <p>Abstract base class for sequence encoders.</p>
<p>Sequence encoders process sequential data and output contextual
representations for each position in the sequence.</p>











<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.modules.encoders.BaseSequenceEncoder.get_input_dim" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_input_dim</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

<a href="#formed.integrations.flax.modules.encoders.BaseSequenceEncoder.get_input_dim" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">get_input_dim</span><span class="p">()</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Get the expected input dimension.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="int">int</span> | None</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Input feature dimension or None if dimension-agnostic.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/modules/encoders.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-190"><span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
</span><span id="__span-0-191"><span class="k">def</span><span class="w"> </span><span class="nf">get_input_dim</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-192"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the expected input dimension.</span>
</span><span id="__span-0-193">
</span><span id="__span-0-194"><span class="sd">    Returns:</span>
</span><span id="__span-0-195"><span class="sd">        Input feature dimension or None if dimension-agnostic.</span>
</span><span id="__span-0-196">
</span><span id="__span-0-197"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-198">    <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.modules.encoders.BaseSequenceEncoder.get_output_dim" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_output_dim</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

<a href="#formed.integrations.flax.modules.encoders.BaseSequenceEncoder.get_output_dim" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">get_output_dim</span><span class="p">()</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Get the output dimension.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="int">int</span> | <span title="collections.abc.Callable">Callable</span>[[<span title="int">int</span>], <span title="int">int</span>]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Output feature dimension or a function mapping input dim to output dim.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/modules/encoders.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-200"><span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
</span><span id="__span-0-201"><span class="k">def</span><span class="w"> </span><span class="nf">get_output_dim</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">int</span><span class="p">],</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="__span-0-202"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the output dimension.</span>
</span><span id="__span-0-203">
</span><span id="__span-0-204"><span class="sd">    Returns:</span>
</span><span id="__span-0-205"><span class="sd">        Output feature dimension or a function mapping input dim to output dim.</span>
</span><span id="__span-0-206">
</span><span id="__span-0-207"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-208">    <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="formed.integrations.flax.modules.encoders.RNNSequenceEncoder" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">RNNSequenceEncoder</span>


<a href="#formed.integrations.flax.modules.encoders.RNNSequenceEncoder" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">RNNSequenceEncoder</span><span class="p">(</span>
</span><span id="__span-0-2">    <span class="n">cell_factory</span><span class="p">,</span>
</span><span id="__span-0-3">    <span class="n">features</span><span class="p">,</span>
</span><span id="__span-0-4">    <span class="n">num_layers</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="__span-0-5">    <span class="n">bidirectional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-6">    <span class="n">feedforward_layers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-7">    <span class="n">dropout</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
</span><span id="__span-0-8">    <span class="n">rngs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-9"><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;BaseSequenceEncoder&lt;/span&gt; (&lt;code&gt;formed.integrations.flax.modules.encoders.BaseSequenceEncoder&lt;/code&gt;)" href="#formed.integrations.flax.modules.encoders.BaseSequenceEncoder">BaseSequenceEncoder</a></code></p>



        <p>Generic RNN-based sequence encoder.</p>
<p>This encoder supports various RNN cell types (LSTM, GRU, vanilla RNN)
with optional bidirectionality, multiple layers, and dropout.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>cell_factory</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Function that creates an RNN cell given rngs.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="collections.abc.Callable">Callable</span>[[<span title="flax.nnx.Rngs">Rngs</span>], <span title="flax.nnx.RNNCellBase">RNNCellBase</span>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_layers</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Number of stacked RNN layers.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="int">int</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>1</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bidirectional</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to use bidirectional RNN.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="bool">bool</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dropout</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Dropout rate between layers.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="float">float</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0.0</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rngs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Random number generators (int or nnx.Rngs).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="flax.nnx.Rngs">Rngs</span> | None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>This is a base class. Use LSTMSequenceEncoder, GRUSequenceEncoder,
or OptimizedLSTMSequenceEncoder for specific cell types.</p>
</details>







                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/formed/integrations/flax/modules/encoders.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-281"><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="__span-0-282">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-283">    <span class="n">cell_factory</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">nnx</span><span class="o">.</span><span class="n">Rngs</span><span class="p">],</span> <span class="n">nnx</span><span class="o">.</span><span class="n">RNNCellBase</span><span class="p">],</span>
</span><span id="__span-0-284">    <span class="n">features</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="__span-0-285">    <span class="n">num_layers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="__span-0-286">    <span class="n">bidirectional</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-287">    <span class="n">feedforward_layers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-288">    <span class="n">dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="__span-0-289">    <span class="n">rngs</span><span class="p">:</span> <span class="n">nnx</span><span class="o">.</span><span class="n">Rngs</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-290"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-291">    <span class="n">rngs</span> <span class="o">=</span> <span class="n">rngs</span> <span class="ow">or</span> <span class="n">require_rngs</span><span class="p">()</span>
</span><span id="__span-0-292">
</span><span id="__span-0-293">    <span class="nd">@nnx</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">in_axes</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">out_axes</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-294">    <span class="k">def</span><span class="w"> </span><span class="nf">create_block</span><span class="p">(</span><span class="n">rngs</span><span class="p">:</span> <span class="n">nnx</span><span class="o">.</span><span class="n">Rngs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RNNSequenceEncoder</span><span class="o">.</span><span class="n">_RNNBlock</span><span class="p">:</span>
</span><span id="__span-0-295">        <span class="n">rnn</span><span class="p">:</span> <span class="n">nnx</span><span class="o">.</span><span class="n">RNN</span> <span class="o">|</span> <span class="n">nnx</span><span class="o">.</span><span class="n">Bidirectional</span>
</span><span id="__span-0-296">        <span class="k">if</span> <span class="n">bidirectional</span><span class="p">:</span>
</span><span id="__span-0-297">            <span class="n">forward_cell</span> <span class="o">=</span> <span class="n">cell_factory</span><span class="p">(</span><span class="n">rngs</span><span class="p">)</span>
</span><span id="__span-0-298">            <span class="n">backward_cell</span> <span class="o">=</span> <span class="n">cell_factory</span><span class="p">(</span><span class="n">rngs</span><span class="p">)</span>
</span><span id="__span-0-299">            <span class="n">rnn</span> <span class="o">=</span> <span class="n">nnx</span><span class="o">.</span><span class="n">Bidirectional</span><span class="p">(</span>
</span><span id="__span-0-300">                <span class="n">forward_rnn</span><span class="o">=</span><span class="n">nnx</span><span class="o">.</span><span class="n">RNN</span><span class="p">(</span><span class="n">forward_cell</span><span class="p">,</span> <span class="n">rngs</span><span class="o">=</span><span class="n">rngs</span><span class="p">),</span>
</span><span id="__span-0-301">                <span class="n">backward_rnn</span><span class="o">=</span><span class="n">nnx</span><span class="o">.</span><span class="n">RNN</span><span class="p">(</span><span class="n">backward_cell</span><span class="p">,</span> <span class="n">rngs</span><span class="o">=</span><span class="n">rngs</span><span class="p">),</span>
</span><span id="__span-0-302">                <span class="n">rngs</span><span class="o">=</span><span class="n">rngs</span><span class="p">,</span>
</span><span id="__span-0-303">            <span class="p">)</span>
</span><span id="__span-0-304">        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-305">            <span class="n">rnn</span> <span class="o">=</span> <span class="n">nnx</span><span class="o">.</span><span class="n">RNN</span><span class="p">(</span><span class="n">cell_factory</span><span class="p">(</span><span class="n">rngs</span><span class="p">),</span> <span class="n">rngs</span><span class="o">=</span><span class="n">rngs</span><span class="p">)</span>
</span><span id="__span-0-306">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_RNNBlock</span><span class="p">(</span>
</span><span id="__span-0-307">            <span class="n">rnn</span><span class="p">,</span>
</span><span id="__span-0-308">            <span class="n">feedforward_layers</span><span class="o">=</span><span class="n">feedforward_layers</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-0-309">            <span class="n">dropout</span><span class="o">=</span><span class="n">dropout</span><span class="p">,</span>
</span><span id="__span-0-310">            <span class="n">rngs</span><span class="o">=</span><span class="n">rngs</span><span class="p">,</span>
</span><span id="__span-0-311">        <span class="p">)</span>
</span><span id="__span-0-312">
</span><span id="__span-0-313">    <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span> <span class="o">=</span> <span class="n">create_block</span><span class="p">(</span><span class="n">rngs</span><span class="o">.</span><span class="n">fork</span><span class="p">(</span><span class="n">split</span><span class="o">=</span><span class="n">num_layers</span><span class="p">))</span>
</span><span id="__span-0-314">    <span class="bp">self</span><span class="o">.</span><span class="n">num_layers</span> <span class="o">=</span> <span class="n">num_layers</span>
</span><span id="__span-0-315">    <span class="bp">self</span><span class="o">.</span><span class="n">bidirectional</span> <span class="o">=</span> <span class="n">bidirectional</span>
</span><span id="__span-0-316">    <span class="bp">self</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="n">features</span>
</span></code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="formed.integrations.flax.modules.encoders.RNNSequenceEncoder.blocks" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">blocks</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#formed.integrations.flax.modules.encoders.RNNSequenceEncoder.blocks" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">blocks</span> <span class="o">=</span> <span class="n"><span title="formed.integrations.flax.modules.encoders.RNNSequenceEncoder.__init__.create_block">create_block</span></span><span class="p">(</span><span class="n"><span title="formed.integrations.flax.modules.encoders.RNNSequenceEncoder(rngs).fork">fork</span></span><span class="p">(</span><span class="n"><span title="formed.integrations.flax.modules.encoders.RNNSequenceEncoder(rngs).fork(split)">split</span></span><span class="o">=</span><span class="n"><span title="formed.integrations.flax.modules.encoders.RNNSequenceEncoder(num_layers)">num_layers</span></span><span class="p">))</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="formed.integrations.flax.modules.encoders.RNNSequenceEncoder.num_layers" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">num_layers</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#formed.integrations.flax.modules.encoders.RNNSequenceEncoder.num_layers" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">num_layers</span> <span class="o">=</span> <span class="n"><span title="formed.integrations.flax.modules.encoders.RNNSequenceEncoder(num_layers)">num_layers</span></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="formed.integrations.flax.modules.encoders.RNNSequenceEncoder.bidirectional" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">bidirectional</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#formed.integrations.flax.modules.encoders.RNNSequenceEncoder.bidirectional" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">bidirectional</span> <span class="o">=</span> <span class="n"><span title="formed.integrations.flax.modules.encoders.RNNSequenceEncoder(bidirectional)">bidirectional</span></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="formed.integrations.flax.modules.encoders.RNNSequenceEncoder.features" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">features</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#formed.integrations.flax.modules.encoders.RNNSequenceEncoder.features" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">features</span> <span class="o">=</span> <span class="n"><span title="formed.integrations.flax.modules.encoders.RNNSequenceEncoder(features)">features</span></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>




<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.modules.encoders.RNNSequenceEncoder.get_input_dim" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_input_dim</span>


<a href="#formed.integrations.flax.modules.encoders.RNNSequenceEncoder.get_input_dim" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">get_input_dim</span><span class="p">()</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/modules/encoders.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">338</span>
<span class="normal">339</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-338"><span class="k">def</span><span class="w"> </span><span class="nf">get_input_dim</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="__span-0-339">    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.modules.encoders.RNNSequenceEncoder.get_output_dim" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_output_dim</span>


<a href="#formed.integrations.flax.modules.encoders.RNNSequenceEncoder.get_output_dim" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">get_output_dim</span><span class="p">()</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/modules/encoders.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">341</span>
<span class="normal">342</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-341"><span class="k">def</span><span class="w"> </span><span class="nf">get_output_dim</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="__span-0-342">    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="formed.integrations.flax.modules.encoders.LSTMSequenceEncoder" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">LSTMSequenceEncoder</span>


<a href="#formed.integrations.flax.modules.encoders.LSTMSequenceEncoder" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">LSTMSequenceEncoder</span><span class="p">(</span>
</span><span id="__span-0-2">    <span class="n">features</span><span class="p">,</span>
</span><span id="__span-0-3">    <span class="n">num_layers</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="__span-0-4">    <span class="n">bidirectional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-5">    <span class="n">feedforward_layers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-6">    <span class="n">dropout</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
</span><span id="__span-0-7">    <span class="n">rngs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-8"><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;RNNSequenceEncoder&lt;/span&gt; (&lt;code&gt;formed.integrations.flax.modules.encoders.RNNSequenceEncoder&lt;/code&gt;)" href="#formed.integrations.flax.modules.encoders.RNNSequenceEncoder">RNNSequenceEncoder</a></code></p>



        <p>LSTM-based sequence encoder.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>features</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Hidden dimension.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="int">int</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_layers</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Number of LSTM layers.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="int">int</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>1</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bidirectional</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to use bidirectional LSTM.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="bool">bool</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dropout</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Dropout rate between layers.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="float">float</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0.0</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rngs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Random number generators.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="flax.nnx.Rngs">Rngs</span> | None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span id="__span-0-1"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Bidirectional 2-layer LSTM</span>
</span><span id="__span-0-2"><span class="gp">&gt;&gt;&gt; </span><span class="n">encoder</span> <span class="o">=</span> <span class="n">LSTMSequenceEncoder</span><span class="p">(</span>
</span><span id="__span-0-3"><span class="gp">... </span>    <span class="n">features</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
</span><span id="__span-0-4"><span class="gp">... </span>    <span class="n">num_layers</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="__span-0-5"><span class="gp">... </span>    <span class="n">bidirectional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-6"><span class="gp">... </span>    <span class="n">dropout</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
</span><span id="__span-0-7"><span class="gp">... </span>    <span class="n">rngs</span><span class="o">=</span><span class="mi">0</span>
</span><span id="__span-0-8"><span class="gp">... </span><span class="p">)</span>
</span></code></pre></div>








                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/formed/integrations/flax/modules/encoders.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-368"><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="__span-0-369">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-370">    <span class="n">features</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="__span-0-371">    <span class="n">num_layers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="__span-0-372">    <span class="n">bidirectional</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-373">    <span class="n">feedforward_layers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-374">    <span class="n">dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="__span-0-375">    <span class="n">rngs</span><span class="p">:</span> <span class="n">nnx</span><span class="o">.</span><span class="n">Rngs</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-376"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-377">    <span class="n">rngs</span> <span class="o">=</span> <span class="n">rngs</span> <span class="ow">or</span> <span class="n">require_rngs</span><span class="p">()</span>
</span><span id="__span-0-378">    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="__span-0-379">        <span class="n">cell_factory</span><span class="o">=</span><span class="k">lambda</span> <span class="n">rngs</span><span class="p">:</span> <span class="n">nnx</span><span class="o">.</span><span class="n">LSTMCell</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">rngs</span><span class="o">=</span><span class="n">rngs</span><span class="p">),</span>
</span><span id="__span-0-380">        <span class="n">features</span><span class="o">=</span><span class="n">features</span><span class="p">,</span>
</span><span id="__span-0-381">        <span class="n">num_layers</span><span class="o">=</span><span class="n">num_layers</span><span class="p">,</span>
</span><span id="__span-0-382">        <span class="n">bidirectional</span><span class="o">=</span><span class="n">bidirectional</span><span class="p">,</span>
</span><span id="__span-0-383">        <span class="n">feedforward_layers</span><span class="o">=</span><span class="n">feedforward_layers</span><span class="p">,</span>
</span><span id="__span-0-384">        <span class="n">dropout</span><span class="o">=</span><span class="n">dropout</span><span class="p">,</span>
</span><span id="__span-0-385">        <span class="n">rngs</span><span class="o">=</span><span class="n">rngs</span><span class="p">,</span>
</span><span id="__span-0-386">    <span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="formed.integrations.flax.modules.encoders.LSTMSequenceEncoder.blocks" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">blocks</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#formed.integrations.flax.modules.encoders.LSTMSequenceEncoder.blocks" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">blocks</span> <span class="o">=</span> <span class="n"><span title="formed.integrations.flax.modules.encoders.RNNSequenceEncoder.__init__.create_block">create_block</span></span><span class="p">(</span><span class="n"><span title="formed.integrations.flax.modules.encoders.RNNSequenceEncoder(rngs).fork">fork</span></span><span class="p">(</span><span class="n"><span title="formed.integrations.flax.modules.encoders.RNNSequenceEncoder(rngs).fork(split)">split</span></span><span class="o">=</span><span class="n"><span title="formed.integrations.flax.modules.encoders.RNNSequenceEncoder(num_layers)">num_layers</span></span><span class="p">))</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="formed.integrations.flax.modules.encoders.LSTMSequenceEncoder.num_layers" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">num_layers</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#formed.integrations.flax.modules.encoders.LSTMSequenceEncoder.num_layers" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">num_layers</span> <span class="o">=</span> <span class="n"><span title="formed.integrations.flax.modules.encoders.RNNSequenceEncoder(num_layers)">num_layers</span></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="formed.integrations.flax.modules.encoders.LSTMSequenceEncoder.bidirectional" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">bidirectional</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#formed.integrations.flax.modules.encoders.LSTMSequenceEncoder.bidirectional" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">bidirectional</span> <span class="o">=</span> <span class="n"><span title="formed.integrations.flax.modules.encoders.RNNSequenceEncoder(bidirectional)">bidirectional</span></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="formed.integrations.flax.modules.encoders.LSTMSequenceEncoder.features" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">features</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#formed.integrations.flax.modules.encoders.LSTMSequenceEncoder.features" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">features</span> <span class="o">=</span> <span class="n"><span title="formed.integrations.flax.modules.encoders.RNNSequenceEncoder(features)">features</span></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>




<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.modules.encoders.LSTMSequenceEncoder.get_input_dim" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_input_dim</span>


<a href="#formed.integrations.flax.modules.encoders.LSTMSequenceEncoder.get_input_dim" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">get_input_dim</span><span class="p">()</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/modules/encoders.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">338</span>
<span class="normal">339</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-338"><span class="k">def</span><span class="w"> </span><span class="nf">get_input_dim</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="__span-0-339">    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.modules.encoders.LSTMSequenceEncoder.get_output_dim" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_output_dim</span>


<a href="#formed.integrations.flax.modules.encoders.LSTMSequenceEncoder.get_output_dim" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">get_output_dim</span><span class="p">()</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/modules/encoders.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">341</span>
<span class="normal">342</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-341"><span class="k">def</span><span class="w"> </span><span class="nf">get_output_dim</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="__span-0-342">    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="formed.integrations.flax.modules.encoders.OptimizedLSTMSequenceEncoder" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">OptimizedLSTMSequenceEncoder</span>


<a href="#formed.integrations.flax.modules.encoders.OptimizedLSTMSequenceEncoder" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">OptimizedLSTMSequenceEncoder</span><span class="p">(</span>
</span><span id="__span-0-2">    <span class="n">features</span><span class="p">,</span>
</span><span id="__span-0-3">    <span class="n">num_layers</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="__span-0-4">    <span class="n">bidirectional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-5">    <span class="n">feedforward_layers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-6">    <span class="n">dropout</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
</span><span id="__span-0-7">    <span class="n">rngs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-8"><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;RNNSequenceEncoder&lt;/span&gt; (&lt;code&gt;formed.integrations.flax.modules.encoders.RNNSequenceEncoder&lt;/code&gt;)" href="#formed.integrations.flax.modules.encoders.RNNSequenceEncoder">RNNSequenceEncoder</a></code></p>



        <p>Optimized LSTM sequence encoder.</p>
<p>Uses Flax's optimized LSTM implementation for better performance.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>features</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Hidden dimension.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="int">int</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_layers</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Number of LSTM layers.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="int">int</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>1</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bidirectional</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to use bidirectional LSTM.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="bool">bool</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dropout</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Dropout rate between layers.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="float">float</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0.0</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rngs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Random number generators.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="flax.nnx.Rngs">Rngs</span> | None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>








                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/formed/integrations/flax/modules/encoders.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-404"><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="__span-0-405">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-406">    <span class="n">features</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="__span-0-407">    <span class="n">num_layers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="__span-0-408">    <span class="n">bidirectional</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-409">    <span class="n">feedforward_layers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-410">    <span class="n">dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="__span-0-411">    <span class="n">rngs</span><span class="p">:</span> <span class="n">nnx</span><span class="o">.</span><span class="n">Rngs</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-412"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-413">    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="__span-0-414">        <span class="n">cell_factory</span><span class="o">=</span><span class="k">lambda</span> <span class="n">rngs</span><span class="p">:</span> <span class="n">nnx</span><span class="o">.</span><span class="n">OptimizedLSTMCell</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">rngs</span><span class="o">=</span><span class="n">rngs</span><span class="p">),</span>
</span><span id="__span-0-415">        <span class="n">features</span><span class="o">=</span><span class="n">features</span><span class="p">,</span>
</span><span id="__span-0-416">        <span class="n">num_layers</span><span class="o">=</span><span class="n">num_layers</span><span class="p">,</span>
</span><span id="__span-0-417">        <span class="n">bidirectional</span><span class="o">=</span><span class="n">bidirectional</span><span class="p">,</span>
</span><span id="__span-0-418">        <span class="n">feedforward_layers</span><span class="o">=</span><span class="n">feedforward_layers</span><span class="p">,</span>
</span><span id="__span-0-419">        <span class="n">dropout</span><span class="o">=</span><span class="n">dropout</span><span class="p">,</span>
</span><span id="__span-0-420">        <span class="n">rngs</span><span class="o">=</span><span class="n">rngs</span><span class="p">,</span>
</span><span id="__span-0-421">    <span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="formed.integrations.flax.modules.encoders.OptimizedLSTMSequenceEncoder.blocks" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">blocks</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#formed.integrations.flax.modules.encoders.OptimizedLSTMSequenceEncoder.blocks" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">blocks</span> <span class="o">=</span> <span class="n"><span title="formed.integrations.flax.modules.encoders.RNNSequenceEncoder.__init__.create_block">create_block</span></span><span class="p">(</span><span class="n"><span title="formed.integrations.flax.modules.encoders.RNNSequenceEncoder(rngs).fork">fork</span></span><span class="p">(</span><span class="n"><span title="formed.integrations.flax.modules.encoders.RNNSequenceEncoder(rngs).fork(split)">split</span></span><span class="o">=</span><span class="n"><span title="formed.integrations.flax.modules.encoders.RNNSequenceEncoder(num_layers)">num_layers</span></span><span class="p">))</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="formed.integrations.flax.modules.encoders.OptimizedLSTMSequenceEncoder.num_layers" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">num_layers</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#formed.integrations.flax.modules.encoders.OptimizedLSTMSequenceEncoder.num_layers" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">num_layers</span> <span class="o">=</span> <span class="n"><span title="formed.integrations.flax.modules.encoders.RNNSequenceEncoder(num_layers)">num_layers</span></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="formed.integrations.flax.modules.encoders.OptimizedLSTMSequenceEncoder.bidirectional" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">bidirectional</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#formed.integrations.flax.modules.encoders.OptimizedLSTMSequenceEncoder.bidirectional" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">bidirectional</span> <span class="o">=</span> <span class="n"><span title="formed.integrations.flax.modules.encoders.RNNSequenceEncoder(bidirectional)">bidirectional</span></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="formed.integrations.flax.modules.encoders.OptimizedLSTMSequenceEncoder.features" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">features</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#formed.integrations.flax.modules.encoders.OptimizedLSTMSequenceEncoder.features" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">features</span> <span class="o">=</span> <span class="n"><span title="formed.integrations.flax.modules.encoders.RNNSequenceEncoder(features)">features</span></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>




<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.modules.encoders.OptimizedLSTMSequenceEncoder.get_input_dim" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_input_dim</span>


<a href="#formed.integrations.flax.modules.encoders.OptimizedLSTMSequenceEncoder.get_input_dim" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">get_input_dim</span><span class="p">()</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/modules/encoders.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">338</span>
<span class="normal">339</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-338"><span class="k">def</span><span class="w"> </span><span class="nf">get_input_dim</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="__span-0-339">    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.modules.encoders.OptimizedLSTMSequenceEncoder.get_output_dim" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_output_dim</span>


<a href="#formed.integrations.flax.modules.encoders.OptimizedLSTMSequenceEncoder.get_output_dim" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">get_output_dim</span><span class="p">()</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/modules/encoders.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">341</span>
<span class="normal">342</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-341"><span class="k">def</span><span class="w"> </span><span class="nf">get_output_dim</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="__span-0-342">    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="formed.integrations.flax.modules.encoders.GRUSequenceEncoder" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">GRUSequenceEncoder</span>


<a href="#formed.integrations.flax.modules.encoders.GRUSequenceEncoder" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">GRUSequenceEncoder</span><span class="p">(</span>
</span><span id="__span-0-2">    <span class="n">features</span><span class="p">,</span>
</span><span id="__span-0-3">    <span class="n">num_layers</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="__span-0-4">    <span class="n">bidirectional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-5">    <span class="n">feedforward_layers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-6">    <span class="n">dropout</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
</span><span id="__span-0-7">    <span class="n">rngs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-8"><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;RNNSequenceEncoder&lt;/span&gt; (&lt;code&gt;formed.integrations.flax.modules.encoders.RNNSequenceEncoder&lt;/code&gt;)" href="#formed.integrations.flax.modules.encoders.RNNSequenceEncoder">RNNSequenceEncoder</a></code></p>



        <p>GRU-based sequence encoder.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>features</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Hidden dimension.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="int">int</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_layers</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Number of GRU layers.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="int">int</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>1</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bidirectional</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to use bidirectional GRU.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="bool">bool</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dropout</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Dropout rate between layers.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="float">float</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0.0</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rngs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Random number generators.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="flax.nnx.Rngs">Rngs</span> | None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span id="__span-0-1"><span class="gp">&gt;&gt;&gt; </span><span class="n">encoder</span> <span class="o">=</span> <span class="n">GRUSequenceEncoder</span><span class="p">(</span>
</span><span id="__span-0-2"><span class="gp">... </span>    <span class="n">features</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span>
</span><span id="__span-0-3"><span class="gp">... </span>    <span class="n">num_layers</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
</span><span id="__span-0-4"><span class="gp">... </span>    <span class="n">bidirectional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-5"><span class="gp">... </span>    <span class="n">rngs</span><span class="o">=</span><span class="mi">0</span>
</span><span id="__span-0-6"><span class="gp">... </span><span class="p">)</span>
</span></code></pre></div>








                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/formed/integrations/flax/modules/encoders.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-445"><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="__span-0-446">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-447">    <span class="n">features</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="__span-0-448">    <span class="n">num_layers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="__span-0-449">    <span class="n">bidirectional</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-450">    <span class="n">feedforward_layers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-451">    <span class="n">dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="__span-0-452">    <span class="n">rngs</span><span class="p">:</span> <span class="n">nnx</span><span class="o">.</span><span class="n">Rngs</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-453"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-454">    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="__span-0-455">        <span class="n">cell_factory</span><span class="o">=</span><span class="k">lambda</span> <span class="n">rngs</span><span class="p">:</span> <span class="n">nnx</span><span class="o">.</span><span class="n">GRUCell</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">rngs</span><span class="o">=</span><span class="n">rngs</span><span class="p">),</span>
</span><span id="__span-0-456">        <span class="n">features</span><span class="o">=</span><span class="n">features</span><span class="p">,</span>
</span><span id="__span-0-457">        <span class="n">num_layers</span><span class="o">=</span><span class="n">num_layers</span><span class="p">,</span>
</span><span id="__span-0-458">        <span class="n">bidirectional</span><span class="o">=</span><span class="n">bidirectional</span><span class="p">,</span>
</span><span id="__span-0-459">        <span class="n">feedforward_layers</span><span class="o">=</span><span class="n">feedforward_layers</span><span class="p">,</span>
</span><span id="__span-0-460">        <span class="n">dropout</span><span class="o">=</span><span class="n">dropout</span><span class="p">,</span>
</span><span id="__span-0-461">        <span class="n">rngs</span><span class="o">=</span><span class="n">rngs</span><span class="p">,</span>
</span><span id="__span-0-462">    <span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="formed.integrations.flax.modules.encoders.GRUSequenceEncoder.blocks" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">blocks</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#formed.integrations.flax.modules.encoders.GRUSequenceEncoder.blocks" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">blocks</span> <span class="o">=</span> <span class="n"><span title="formed.integrations.flax.modules.encoders.RNNSequenceEncoder.__init__.create_block">create_block</span></span><span class="p">(</span><span class="n"><span title="formed.integrations.flax.modules.encoders.RNNSequenceEncoder(rngs).fork">fork</span></span><span class="p">(</span><span class="n"><span title="formed.integrations.flax.modules.encoders.RNNSequenceEncoder(rngs).fork(split)">split</span></span><span class="o">=</span><span class="n"><span title="formed.integrations.flax.modules.encoders.RNNSequenceEncoder(num_layers)">num_layers</span></span><span class="p">))</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="formed.integrations.flax.modules.encoders.GRUSequenceEncoder.num_layers" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">num_layers</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#formed.integrations.flax.modules.encoders.GRUSequenceEncoder.num_layers" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">num_layers</span> <span class="o">=</span> <span class="n"><span title="formed.integrations.flax.modules.encoders.RNNSequenceEncoder(num_layers)">num_layers</span></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="formed.integrations.flax.modules.encoders.GRUSequenceEncoder.bidirectional" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">bidirectional</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#formed.integrations.flax.modules.encoders.GRUSequenceEncoder.bidirectional" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">bidirectional</span> <span class="o">=</span> <span class="n"><span title="formed.integrations.flax.modules.encoders.RNNSequenceEncoder(bidirectional)">bidirectional</span></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="formed.integrations.flax.modules.encoders.GRUSequenceEncoder.features" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">features</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#formed.integrations.flax.modules.encoders.GRUSequenceEncoder.features" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">features</span> <span class="o">=</span> <span class="n"><span title="formed.integrations.flax.modules.encoders.RNNSequenceEncoder(features)">features</span></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>




<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.modules.encoders.GRUSequenceEncoder.get_input_dim" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_input_dim</span>


<a href="#formed.integrations.flax.modules.encoders.GRUSequenceEncoder.get_input_dim" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">get_input_dim</span><span class="p">()</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/modules/encoders.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">338</span>
<span class="normal">339</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-338"><span class="k">def</span><span class="w"> </span><span class="nf">get_input_dim</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="__span-0-339">    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.modules.encoders.GRUSequenceEncoder.get_output_dim" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_output_dim</span>


<a href="#formed.integrations.flax.modules.encoders.GRUSequenceEncoder.get_output_dim" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">get_output_dim</span><span class="p">()</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/modules/encoders.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">341</span>
<span class="normal">342</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-341"><span class="k">def</span><span class="w"> </span><span class="nf">get_output_dim</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="__span-0-342">    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="formed.integrations.flax.modules.encoders.TransformerSequenceEncoder" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">TransformerSequenceEncoder</span>


<a href="#formed.integrations.flax.modules.encoders.TransformerSequenceEncoder" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">TransformerSequenceEncoder</span><span class="p">(</span>
</span><span id="__span-0-2">    <span class="n">features</span><span class="p">,</span>
</span><span id="__span-0-3">    <span class="n">num_heads</span><span class="p">,</span>
</span><span id="__span-0-4">    <span class="o">*</span><span class="p">,</span>
</span><span id="__span-0-5">    <span class="n">num_layers</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="__span-0-6">    <span class="n">dropout</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
</span><span id="__span-0-7">    <span class="n">epsilon</span><span class="o">=</span><span class="mf">1e-06</span><span class="p">,</span>
</span><span id="__span-0-8">    <span class="n">feedworward_features</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-9">    <span class="n">activation</span><span class="o">=</span><span class="n"><span title="jax.nn.gelu">gelu</span></span><span class="p">,</span>
</span><span id="__span-0-10">    <span class="n">position_encoder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-11">    <span class="n">rngs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-12"><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;BaseSequenceEncoder&lt;/span&gt; (&lt;code&gt;formed.integrations.flax.modules.encoders.BaseSequenceEncoder&lt;/code&gt;)" href="#formed.integrations.flax.modules.encoders.BaseSequenceEncoder">BaseSequenceEncoder</a></code></p>



        <p>Transformer-based sequence encoder.</p>
<p>This encoder uses multi-head self-attention and feed-forward layers
to process sequences, following the Transformer architecture.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>features</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Model dimension.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="int">int</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_heads</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Number of attention heads.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="int">int</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_layers</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Number of transformer layers.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="int">int</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>1</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dropout</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Dropout rate.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="float">float</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0.0</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>epsilon</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Layer normalization epsilon.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="float">float</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>1e-06</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>feedworward_features</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Feed-forward hidden dimension (defaults to 4*features).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="int">int</span> | None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>activation</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Activation function for feed-forward layers.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="collections.abc.Callable">Callable</span>[[<span title="jax.Array">Array</span>], <span title="jax.Array">Array</span>]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><span title="jax.nn.gelu">gelu</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>position_encoder</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Optional position encoder.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;BasePositionEncoder&lt;/span&gt; (&lt;code&gt;formed.integrations.flax.modules.encoders.BasePositionEncoder&lt;/code&gt;)" href="#formed.integrations.flax.modules.encoders.BasePositionEncoder">BasePositionEncoder</a> | None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rngs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Random number generators.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="flax.nnx.Rngs">Rngs</span> | None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span id="__span-0-1"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Transformer with sinusoidal positions</span>
</span><span id="__span-0-2"><span class="gp">&gt;&gt;&gt; </span><span class="n">encoder</span> <span class="o">=</span> <span class="n">TransformerSequenceEncoder</span><span class="p">(</span>
</span><span id="__span-0-3"><span class="gp">... </span>    <span class="n">features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span>
</span><span id="__span-0-4"><span class="gp">... </span>    <span class="n">num_heads</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
</span><span id="__span-0-5"><span class="gp">... </span>    <span class="n">num_layers</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
</span><span id="__span-0-6"><span class="gp">... </span>    <span class="n">dropout</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
</span><span id="__span-0-7"><span class="gp">... </span>    <span class="n">position_encoder</span><span class="o">=</span><span class="n">SinusoidalPositionEncoder</span><span class="p">(),</span>
</span><span id="__span-0-8"><span class="gp">... </span>    <span class="n">rngs</span><span class="o">=</span><span class="n">rngs</span>
</span><span id="__span-0-9"><span class="gp">... </span><span class="p">)</span>
</span><span id="__span-0-10"><span class="gp">&gt;&gt;&gt;</span>
</span><span id="__span-0-11"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Transformer with learnable positions</span>
</span><span id="__span-0-12"><span class="gp">&gt;&gt;&gt; </span><span class="n">encoder</span> <span class="o">=</span> <span class="n">TransformerSequenceEncoder</span><span class="p">(</span>
</span><span id="__span-0-13"><span class="gp">... </span>    <span class="n">features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span>
</span><span id="__span-0-14"><span class="gp">... </span>    <span class="n">num_heads</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
</span><span id="__span-0-15"><span class="gp">... </span>    <span class="n">num_layers</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
</span><span id="__span-0-16"><span class="gp">... </span>    <span class="n">position_encoder</span><span class="o">=</span><span class="n">LearnablePositionEncoder</span><span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="n">rngs</span><span class="o">=</span><span class="n">rngs</span><span class="p">),</span>
</span><span id="__span-0-17"><span class="gp">... </span>    <span class="n">rngs</span><span class="o">=</span><span class="n">rngs</span>
</span><span id="__span-0-18"><span class="gp">... </span><span class="p">)</span>
</span></code></pre></div>








                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/formed/integrations/flax/modules/encoders.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-541"><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="__span-0-542">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-543">    <span class="n">features</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="__span-0-544">    <span class="n">num_heads</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="__span-0-545">    <span class="o">*</span><span class="p">,</span>
</span><span id="__span-0-546">    <span class="n">num_layers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="__span-0-547">    <span class="n">dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="__span-0-548">    <span class="n">epsilon</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-6</span><span class="p">,</span>
</span><span id="__span-0-549">    <span class="n">feedworward_features</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-550">    <span class="n">activation</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">jax</span><span class="o">.</span><span class="n">Array</span><span class="p">],</span> <span class="n">jax</span><span class="o">.</span><span class="n">Array</span><span class="p">]</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">gelu</span><span class="p">,</span>
</span><span id="__span-0-551">    <span class="n">position_encoder</span><span class="p">:</span> <span class="n">BasePositionEncoder</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-552">    <span class="n">rngs</span><span class="p">:</span> <span class="n">nnx</span><span class="o">.</span><span class="n">Rngs</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-553"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-554">    <span class="n">rngs</span> <span class="o">=</span> <span class="n">rngs</span> <span class="ow">or</span> <span class="n">require_rngs</span><span class="p">()</span>
</span><span id="__span-0-555">
</span><span id="__span-0-556">    <span class="nd">@nnx</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">in_axes</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">out_axes</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-557">    <span class="k">def</span><span class="w"> </span><span class="nf">create_block</span><span class="p">(</span><span class="n">rngs</span><span class="p">:</span> <span class="n">nnx</span><span class="o">.</span><span class="n">Rngs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TransformerSequenceEncoder</span><span class="o">.</span><span class="n">_TransformerBlock</span><span class="p">:</span>
</span><span id="__span-0-558">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_TransformerBlock</span><span class="p">(</span>
</span><span id="__span-0-559">            <span class="n">features</span><span class="o">=</span><span class="n">features</span><span class="p">,</span>
</span><span id="__span-0-560">            <span class="n">num_heads</span><span class="o">=</span><span class="n">num_heads</span><span class="p">,</span>
</span><span id="__span-0-561">            <span class="n">dropout</span><span class="o">=</span><span class="n">dropout</span><span class="p">,</span>
</span><span id="__span-0-562">            <span class="n">epsilon</span><span class="o">=</span><span class="n">epsilon</span><span class="p">,</span>
</span><span id="__span-0-563">            <span class="n">feedworward_features</span><span class="o">=</span><span class="n">feedworward_features</span> <span class="ow">or</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">features</span><span class="p">,</span>
</span><span id="__span-0-564">            <span class="n">activation</span><span class="o">=</span><span class="n">activation</span><span class="p">,</span>
</span><span id="__span-0-565">            <span class="n">rngs</span><span class="o">=</span><span class="n">rngs</span><span class="p">,</span>
</span><span id="__span-0-566">        <span class="p">)</span>
</span><span id="__span-0-567">
</span><span id="__span-0-568">    <span class="bp">self</span><span class="o">.</span><span class="n">num_layers</span> <span class="o">=</span> <span class="n">num_layers</span>
</span><span id="__span-0-569">    <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span> <span class="o">=</span> <span class="n">create_block</span><span class="p">(</span><span class="n">rngs</span><span class="o">.</span><span class="n">fork</span><span class="p">(</span><span class="n">split</span><span class="o">=</span><span class="n">num_layers</span><span class="p">))</span>
</span><span id="__span-0-570">    <span class="bp">self</span><span class="o">.</span><span class="n">position_encoder</span> <span class="o">=</span> <span class="n">position_encoder</span>
</span><span id="__span-0-571">    <span class="bp">self</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="n">features</span>
</span></code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="formed.integrations.flax.modules.encoders.TransformerSequenceEncoder.num_layers" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">num_layers</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#formed.integrations.flax.modules.encoders.TransformerSequenceEncoder.num_layers" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">num_layers</span> <span class="o">=</span> <span class="n"><span title="formed.integrations.flax.modules.encoders.TransformerSequenceEncoder(num_layers)">num_layers</span></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="formed.integrations.flax.modules.encoders.TransformerSequenceEncoder.blocks" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">blocks</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#formed.integrations.flax.modules.encoders.TransformerSequenceEncoder.blocks" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">blocks</span> <span class="o">=</span> <span class="n"><span title="formed.integrations.flax.modules.encoders.TransformerSequenceEncoder.__init__.create_block">create_block</span></span><span class="p">(</span><span class="n"><span title="formed.integrations.flax.modules.encoders.TransformerSequenceEncoder(rngs).fork">fork</span></span><span class="p">(</span><span class="n"><span title="formed.integrations.flax.modules.encoders.TransformerSequenceEncoder(rngs).fork(split)">split</span></span><span class="o">=</span><span class="n"><span title="formed.integrations.flax.modules.encoders.TransformerSequenceEncoder(num_layers)">num_layers</span></span><span class="p">))</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="formed.integrations.flax.modules.encoders.TransformerSequenceEncoder.position_encoder" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">position_encoder</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#formed.integrations.flax.modules.encoders.TransformerSequenceEncoder.position_encoder" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">position_encoder</span> <span class="o">=</span> <span class="n"><span title="formed.integrations.flax.modules.encoders.TransformerSequenceEncoder(position_encoder)">position_encoder</span></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="formed.integrations.flax.modules.encoders.TransformerSequenceEncoder.features" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">features</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#formed.integrations.flax.modules.encoders.TransformerSequenceEncoder.features" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">features</span> <span class="o">=</span> <span class="n"><span title="formed.integrations.flax.modules.encoders.TransformerSequenceEncoder(features)">features</span></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>




<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.modules.encoders.TransformerSequenceEncoder.get_input_dim" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_input_dim</span>


<a href="#formed.integrations.flax.modules.encoders.TransformerSequenceEncoder.get_input_dim" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">get_input_dim</span><span class="p">()</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/modules/encoders.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">601</span>
<span class="normal">602</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-601"><span class="k">def</span><span class="w"> </span><span class="nf">get_input_dim</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="__span-0-602">    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.modules.encoders.TransformerSequenceEncoder.get_output_dim" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_output_dim</span>


<a href="#formed.integrations.flax.modules.encoders.TransformerSequenceEncoder.get_output_dim" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">get_output_dim</span><span class="p">()</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/modules/encoders.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">604</span>
<span class="normal">605</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-604"><span class="k">def</span><span class="w"> </span><span class="nf">get_output_dim</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="__span-0-605">    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="formed.integrations.flax.modules.feedforward" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">formed.integrations.flax.modules.feedforward</span>


<a href="#formed.integrations.flax.modules.feedforward" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

        <p>Feed-forward neural network modules for Flax models.</p>
<p>This module provides feed-forward network layers with support for
multiple layers, dropout, layer normalization, and residual connections.</p>


<details class="key-components" open>
  <summary>Key Components</summary>
  <ul>
<li>Block: Single feed-forward block with optional normalization and dropout</li>
<li>FeedForward: Stacked feed-forward blocks with configurable connections</li>
</ul>
</details>

<details class="features" open>
  <summary>Features</summary>
  <ul>
<li>Configurable activation functions</li>
<li>Layer normalization with custom epsilon</li>
<li>Dropout for regularization</li>
<li>Dense residual connections</li>
<li>Efficient implementation using scan</li>
</ul>
</details>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span id="__span-0-1"><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">formed.integrations.flax.modules</span><span class="w"> </span><span class="kn">import</span> <span class="n">FeedForward</span>
</span><span id="__span-0-2"><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">flax</span><span class="w"> </span><span class="kn">import</span> <span class="n">nnx</span>
</span><span id="__span-0-3"><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">jax.nn</span>
</span><span id="__span-0-4"><span class="gp">&gt;&gt;&gt;</span>
</span><span id="__span-0-5"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Simple 3-layer feed-forward network</span>
</span><span id="__span-0-6"><span class="gp">&gt;&gt;&gt; </span><span class="n">ffn</span> <span class="o">=</span> <span class="n">FeedForward</span><span class="p">(</span>
</span><span id="__span-0-7"><span class="gp">... </span>    <span class="n">features</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
</span><span id="__span-0-8"><span class="gp">... </span>    <span class="n">num_layers</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
</span><span id="__span-0-9"><span class="gp">... </span>    <span class="n">dropout</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
</span><span id="__span-0-10"><span class="gp">... </span>    <span class="n">activation</span><span class="o">=</span><span class="n">jax</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">gelu</span><span class="p">,</span>
</span><span id="__span-0-11"><span class="gp">... </span>    <span class="n">rngs</span><span class="o">=</span><span class="n">nnx</span><span class="o">.</span><span class="n">Rngs</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-12"><span class="gp">... </span><span class="p">)</span>
</span><span id="__span-0-13"><span class="gp">&gt;&gt;&gt;</span>
</span><span id="__span-0-14"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># With dense residual connections</span>
</span><span id="__span-0-15"><span class="gp">&gt;&gt;&gt; </span><span class="n">ffn</span> <span class="o">=</span> <span class="n">FeedForward</span><span class="p">(</span>
</span><span id="__span-0-16"><span class="gp">... </span>    <span class="n">features</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
</span><span id="__span-0-17"><span class="gp">... </span>    <span class="n">num_layers</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
</span><span id="__span-0-18"><span class="gp">... </span>    <span class="n">residual_connection</span><span class="o">=</span><span class="s2">&quot;dense&quot;</span><span class="p">,</span>
</span><span id="__span-0-19"><span class="gp">... </span>    <span class="n">rngs</span><span class="o">=</span><span class="n">rngs</span>
</span><span id="__span-0-20"><span class="gp">... </span><span class="p">)</span>
</span></code></pre></div>










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h3 id="formed.integrations.flax.modules.feedforward.Block" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">Block</span>


<a href="#formed.integrations.flax.modules.feedforward.Block" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">Block</span><span class="p">(</span>
</span><span id="__span-0-2">    <span class="n">input_dim</span><span class="p">,</span>
</span><span id="__span-0-3">    <span class="n">output_dim</span><span class="p">,</span>
</span><span id="__span-0-4">    <span class="n">dropout</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
</span><span id="__span-0-5">    <span class="n">layer_norm_eps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-6">    <span class="n">activation</span><span class="o">=</span><span class="n"><span title="jax.nn.relu">relu</span></span><span class="p">,</span>
</span><span id="__span-0-7">    <span class="n">rngs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-8"><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="flax.nnx.Module">Module</span></code></p>



        <p>Single feed-forward block with optional normalization and dropout.</p>
<p>A block consists of a linear transformation, activation, optional dropout,
and optional layer normalization. It can also accept a residual input.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>rngs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Random number generators.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="flax.nnx.Rngs">Rngs</span> | None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>input_dim</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Input dimension.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="int">int</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>output_dim</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Output dimension.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="int">int</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dropout</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Dropout rate (0 means no dropout).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="float">float</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0.0</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>layer_norm_eps</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Layer normalization epsilon (None means no layer norm).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="float">float</span> | None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>activation</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Activation function (default: ReLU).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="collections.abc.Callable">Callable</span>[[<span title="jax.Array">Array</span>], <span title="jax.Array">Array</span>]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><span title="jax.nn.relu">relu</span></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>








                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/formed/integrations/flax/modules/feedforward.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-66"><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="__span-0-67">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-68">    <span class="n">input_dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="__span-0-69">    <span class="n">output_dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="__span-0-70">    <span class="n">dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="__span-0-71">    <span class="n">layer_norm_eps</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-72">    <span class="n">activation</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">jax</span><span class="o">.</span><span class="n">Array</span><span class="p">],</span> <span class="n">jax</span><span class="o">.</span><span class="n">Array</span><span class="p">]</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">,</span>
</span><span id="__span-0-73">    <span class="n">rngs</span><span class="p">:</span> <span class="n">nnx</span><span class="o">.</span><span class="n">Rngs</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-74"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-75">    <span class="n">rngs</span> <span class="o">=</span> <span class="n">rngs</span> <span class="ow">or</span> <span class="n">require_rngs</span><span class="p">()</span>
</span><span id="__span-0-76">    <span class="bp">self</span><span class="o">.</span><span class="n">linear</span> <span class="o">=</span> <span class="n">nnx</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">input_dim</span><span class="p">,</span> <span class="n">output_dim</span><span class="p">,</span> <span class="n">rngs</span><span class="o">=</span><span class="n">rngs</span><span class="p">)</span>
</span><span id="__span-0-77">    <span class="bp">self</span><span class="o">.</span><span class="n">activation</span> <span class="o">=</span> <span class="n">activation</span>
</span><span id="__span-0-78">    <span class="bp">self</span><span class="o">.</span><span class="n">dropout</span> <span class="o">=</span> <span class="n">nnx</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="n">dropout</span><span class="p">,</span> <span class="n">rngs</span><span class="o">=</span><span class="n">rngs</span><span class="p">)</span> <span class="k">if</span> <span class="n">dropout</span> <span class="o">&gt;</span> <span class="mf">0.0</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="__span-0-79">    <span class="bp">self</span><span class="o">.</span><span class="n">layer_norm</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-0-80">        <span class="n">nnx</span><span class="o">.</span><span class="n">LayerNorm</span><span class="p">(</span><span class="n">output_dim</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="n">layer_norm_eps</span><span class="p">,</span> <span class="n">rngs</span><span class="o">=</span><span class="n">rngs</span><span class="p">)</span> <span class="k">if</span> <span class="n">layer_norm_eps</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="__span-0-81">    <span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="formed.integrations.flax.modules.feedforward.Block.linear" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">linear</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#formed.integrations.flax.modules.feedforward.Block.linear" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">linear</span> <span class="o">=</span> <span class="n"><span title="flax.nnx.Linear">Linear</span></span><span class="p">(</span><span class="n"><span title="formed.integrations.flax.modules.feedforward.Block(input_dim)">input_dim</span></span><span class="p">,</span> <span class="n"><span title="formed.integrations.flax.modules.feedforward.Block(output_dim)">output_dim</span></span><span class="p">,</span> <span class="n"><span title="flax.nnx.Linear(rngs)">rngs</span></span><span class="o">=</span><span class="n"><span title="formed.integrations.flax.modules.feedforward.Block(rngs)">rngs</span></span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="formed.integrations.flax.modules.feedforward.Block.activation" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">activation</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#formed.integrations.flax.modules.feedforward.Block.activation" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">activation</span> <span class="o">=</span> <span class="n"><span title="formed.integrations.flax.modules.feedforward.Block(activation)">activation</span></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="formed.integrations.flax.modules.feedforward.Block.dropout" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">dropout</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#formed.integrations.flax.modules.feedforward.Block.dropout" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">dropout</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-0-2">    <span class="n"><span title="flax.nnx.Dropout">Dropout</span></span><span class="p">(</span><span class="n"><span title="formed.integrations.flax.modules.feedforward.Block(dropout)">dropout</span></span><span class="p">,</span> <span class="n"><span title="flax.nnx.Dropout(rngs)">rngs</span></span><span class="o">=</span><span class="n"><span title="formed.integrations.flax.modules.feedforward.Block(rngs)">rngs</span></span><span class="p">)</span> <span class="k">if</span> <span class="n"><span title="formed.integrations.flax.modules.feedforward.Block(dropout)">dropout</span></span> <span class="o">&gt;</span> <span class="mf">0.0</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="__span-0-3"><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="formed.integrations.flax.modules.feedforward.Block.layer_norm" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">layer_norm</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#formed.integrations.flax.modules.feedforward.Block.layer_norm" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">layer_norm</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-0-2">    <span class="n"><span title="flax.nnx.LayerNorm">LayerNorm</span></span><span class="p">(</span><span class="n"><span title="formed.integrations.flax.modules.feedforward.Block(output_dim)">output_dim</span></span><span class="p">,</span> <span class="n"><span title="flax.nnx.LayerNorm(epsilon)">epsilon</span></span><span class="o">=</span><span class="n"><span title="formed.integrations.flax.modules.feedforward.Block(layer_norm_eps)">layer_norm_eps</span></span><span class="p">,</span> <span class="n"><span title="flax.nnx.LayerNorm(rngs)">rngs</span></span><span class="o">=</span><span class="n"><span title="formed.integrations.flax.modules.feedforward.Block(rngs)">rngs</span></span><span class="p">)</span>
</span><span id="__span-0-3">    <span class="k">if</span> <span class="n"><span title="formed.integrations.flax.modules.feedforward.Block(layer_norm_eps)">layer_norm_eps</span></span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="__span-0-4">    <span class="k">else</span> <span class="kc">None</span>
</span><span id="__span-0-5"><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>






  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="formed.integrations.flax.modules.feedforward.FeedForward" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">FeedForward</span>


<a href="#formed.integrations.flax.modules.feedforward.FeedForward" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">FeedForward</span><span class="p">(</span>
</span><span id="__span-0-2">    <span class="n">features</span><span class="p">,</span>
</span><span id="__span-0-3">    <span class="n">num_layers</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="__span-0-4">    <span class="n">dropout</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
</span><span id="__span-0-5">    <span class="n">layer_norm_eps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-6">    <span class="n">activation</span><span class="o">=</span><span class="n"><span title="jax.nn.relu">relu</span></span><span class="p">,</span>
</span><span id="__span-0-7">    <span class="n">residual_connection</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
</span><span id="__span-0-8">    <span class="n">rngs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-9"><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="flax.nnx.Module">Module</span></code></p>



        <p>Multi-layer feed-forward neural network.</p>
<p>This module stacks multiple feed-forward blocks with configurable
activation, dropout, normalization, and residual connections.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>features</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Hidden dimension for all layers.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="int">int</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_layers</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Number of layers.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="int">int</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>1</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dropout</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Dropout rate applied after each activation.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="float">float</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0.0</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>layer_norm_eps</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Epsilon for layer normalization (None disables layer norm).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="float">float</span> | None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>activation</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Activation function (default: ReLU).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="collections.abc.Callable">Callable</span>[[<span title="jax.Array">Array</span>], <span title="jax.Array">Array</span>]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><span title="jax.nn.relu">relu</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>residual_connection</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Type of residual connection:
- "none": No residual connections (default)
- "dense": Dense connections (each layer receives sum of all previous)</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Literal">Literal</span>[&#39;none&#39;, &#39;dense&#39;]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;none&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rngs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Random number generators (can be int seed or nnx.Rngs).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="flax.nnx.Rngs">Rngs</span> | None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span id="__span-0-1"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Simple 3-layer network</span>
</span><span id="__span-0-2"><span class="gp">&gt;&gt;&gt; </span><span class="n">ffn</span> <span class="o">=</span> <span class="n">FeedForward</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">num_layers</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">rngs</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-3"><span class="gp">&gt;&gt;&gt; </span><span class="n">output</span> <span class="o">=</span> <span class="n">ffn</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="__span-0-4"><span class="gp">&gt;&gt;&gt;</span>
</span><span id="__span-0-5"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># With dropout and layer norm</span>
</span><span id="__span-0-6"><span class="gp">&gt;&gt;&gt; </span><span class="n">ffn</span> <span class="o">=</span> <span class="n">FeedForward</span><span class="p">(</span>
</span><span id="__span-0-7"><span class="gp">... </span>    <span class="n">features</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span>
</span><span id="__span-0-8"><span class="gp">... </span>    <span class="n">num_layers</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
</span><span id="__span-0-9"><span class="gp">... </span>    <span class="n">dropout</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
</span><span id="__span-0-10"><span class="gp">... </span>    <span class="n">layer_norm_eps</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">,</span>
</span><span id="__span-0-11"><span class="gp">... </span>    <span class="n">rngs</span><span class="o">=</span><span class="mi">0</span>
</span><span id="__span-0-12"><span class="gp">... </span><span class="p">)</span>
</span><span id="__span-0-13"><span class="gp">&gt;&gt;&gt;</span>
</span><span id="__span-0-14"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># With dense residual connections</span>
</span><span id="__span-0-15"><span class="gp">&gt;&gt;&gt; </span><span class="n">ffn</span> <span class="o">=</span> <span class="n">FeedForward</span><span class="p">(</span>
</span><span id="__span-0-16"><span class="gp">... </span>    <span class="n">features</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span>
</span><span id="__span-0-17"><span class="gp">... </span>    <span class="n">num_layers</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
</span><span id="__span-0-18"><span class="gp">... </span>    <span class="n">residual_connection</span><span class="o">=</span><span class="s2">&quot;dense&quot;</span><span class="p">,</span>
</span><span id="__span-0-19"><span class="gp">... </span>    <span class="n">rngs</span><span class="o">=</span><span class="mi">0</span>
</span><span id="__span-0-20"><span class="gp">... </span><span class="p">)</span>
</span></code></pre></div>


<details class="note" open>
  <summary>Note</summary>
  <p>When using residual_connection="dense", each layer receives the
sum of outputs from all previous layers, similar to DenseNet.</p>
</details>







                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/formed/integrations/flax/modules/feedforward.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-146"><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="__span-0-147">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-148">    <span class="n">features</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="__span-0-149">    <span class="n">num_layers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="__span-0-150">    <span class="n">dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="__span-0-151">    <span class="n">layer_norm_eps</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-152">    <span class="n">activation</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">jax</span><span class="o">.</span><span class="n">Array</span><span class="p">],</span> <span class="n">jax</span><span class="o">.</span><span class="n">Array</span><span class="p">]</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">,</span>
</span><span id="__span-0-153">    <span class="n">residual_connection</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="s2">&quot;dense&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span>
</span><span id="__span-0-154">    <span class="n">rngs</span><span class="p">:</span> <span class="n">nnx</span><span class="o">.</span><span class="n">Rngs</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-155"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-156">    <span class="n">rngs</span> <span class="o">=</span> <span class="n">rngs</span> <span class="ow">or</span> <span class="n">require_rngs</span><span class="p">()</span>
</span><span id="__span-0-157">
</span><span id="__span-0-158">    <span class="nd">@nnx</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">in_axes</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">out_axes</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-159">    <span class="k">def</span><span class="w"> </span><span class="nf">create_block</span><span class="p">(</span><span class="n">rngs</span><span class="p">:</span> <span class="n">nnx</span><span class="o">.</span><span class="n">Rngs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Block</span><span class="p">:</span>
</span><span id="__span-0-160">        <span class="k">return</span> <span class="n">Block</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">dropout</span><span class="p">,</span> <span class="n">layer_norm_eps</span><span class="p">,</span> <span class="n">activation</span><span class="p">,</span> <span class="n">rngs</span><span class="o">=</span><span class="n">rngs</span><span class="p">)</span>
</span><span id="__span-0-161">
</span><span id="__span-0-162">    <span class="bp">self</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="n">features</span>
</span><span id="__span-0-163">    <span class="bp">self</span><span class="o">.</span><span class="n">num_layers</span> <span class="o">=</span> <span class="n">num_layers</span>
</span><span id="__span-0-164">    <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span> <span class="o">=</span> <span class="n">create_block</span><span class="p">(</span><span class="n">rngs</span><span class="o">.</span><span class="n">fork</span><span class="p">(</span><span class="n">split</span><span class="o">=</span><span class="n">num_layers</span><span class="p">))</span>
</span><span id="__span-0-165">    <span class="bp">self</span><span class="o">.</span><span class="n">residual_connection</span> <span class="o">=</span> <span class="n">residual_connection</span>
</span></code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="formed.integrations.flax.modules.feedforward.FeedForward.features" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">features</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#formed.integrations.flax.modules.feedforward.FeedForward.features" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">features</span> <span class="o">=</span> <span class="n"><span title="formed.integrations.flax.modules.feedforward.FeedForward(features)">features</span></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="formed.integrations.flax.modules.feedforward.FeedForward.num_layers" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">num_layers</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#formed.integrations.flax.modules.feedforward.FeedForward.num_layers" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">num_layers</span> <span class="o">=</span> <span class="n"><span title="formed.integrations.flax.modules.feedforward.FeedForward(num_layers)">num_layers</span></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="formed.integrations.flax.modules.feedforward.FeedForward.blocks" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">blocks</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#formed.integrations.flax.modules.feedforward.FeedForward.blocks" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">blocks</span> <span class="o">=</span> <span class="n"><span title="formed.integrations.flax.modules.feedforward.FeedForward.__init__.create_block">create_block</span></span><span class="p">(</span><span class="n"><span title="formed.integrations.flax.modules.feedforward.FeedForward(rngs).fork">fork</span></span><span class="p">(</span><span class="n"><span title="formed.integrations.flax.modules.feedforward.FeedForward(rngs).fork(split)">split</span></span><span class="o">=</span><span class="n"><span title="formed.integrations.flax.modules.feedforward.FeedForward(num_layers)">num_layers</span></span><span class="p">))</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="formed.integrations.flax.modules.feedforward.FeedForward.residual_connection" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">residual_connection</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#formed.integrations.flax.modules.feedforward.FeedForward.residual_connection" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">residual_connection</span> <span class="o">=</span> <span class="n"><span title="formed.integrations.flax.modules.feedforward.FeedForward(residual_connection)">residual_connection</span></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>




<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.modules.feedforward.FeedForward.get_input_dim" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_input_dim</span>


<a href="#formed.integrations.flax.modules.feedforward.FeedForward.get_input_dim" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">get_input_dim</span><span class="p">()</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/modules/feedforward.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">167</span>
<span class="normal">168</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-167"><span class="k">def</span><span class="w"> </span><span class="nf">get_input_dim</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="__span-0-168">    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.modules.feedforward.FeedForward.get_output_dim" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_output_dim</span>


<a href="#formed.integrations.flax.modules.feedforward.FeedForward.get_output_dim" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">get_output_dim</span><span class="p">()</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/modules/feedforward.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">170</span>
<span class="normal">171</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-170"><span class="k">def</span><span class="w"> </span><span class="nf">get_output_dim</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="__span-0-171">    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="formed.integrations.flax.modules.losses" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">formed.integrations.flax.modules.losses</span>


<a href="#formed.integrations.flax.modules.losses" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h3 id="formed.integrations.flax.modules.losses.BaseClassificationLoss" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">BaseClassificationLoss</span>


<a href="#formed.integrations.flax.modules.losses.BaseClassificationLoss" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="flax.nnx.Module">Module</span></code>, <code><span title="colt.Registrable">Registrable</span></code>, <code><span title="typing.Generic">Generic</span>[<span title="formed.integrations.flax.modules.losses._ParamsT">_ParamsT</span>]</code>, <code><span title="abc.ABC">ABC</span></code></p>



        <p>Abstract base class for classification loss functions.</p>
<p>A ClassificationLoss defines a strategy for computing loss based on model logits and true labels.</p>


<table>
      <thead>
        <tr>
          <th>
            <span class="doc-section-title">
              CLASS TYPE PARAMETER
            </span>
          </th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>_ParamsT</code>
            </td>
            <td class="doc-type_param-details">
              <div class="doc-md-description">
                <p>Type of additional parameters used during loss computation.</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
      </tbody>
    </table>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="formed.integrations.flax.modules.losses.CrossEntropyLoss" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">CrossEntropyLoss</span>


<a href="#formed.integrations.flax.modules.losses.CrossEntropyLoss" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">CrossEntropyLoss</span><span class="p">(</span><span class="n">weighter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reduce</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;BaseClassificationLoss&lt;/span&gt; (&lt;code&gt;formed.integrations.flax.modules.losses.BaseClassificationLoss&lt;/code&gt;)" href="#formed.integrations.flax.modules.losses.BaseClassificationLoss">BaseClassificationLoss</a>[<span title="formed.integrations.flax.modules.losses._ParamsT">_ParamsT</span>]</code></p>



        <p>Cross-entropy loss for classification tasks.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>weighter</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>An optional label weighter to assign weights to each class.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;BaseLabelWeighter&lt;/span&gt; (&lt;code&gt;formed.integrations.flax.modules.weighters.BaseLabelWeighter&lt;/code&gt;)" href="#formed.integrations.flax.modules.weighters.BaseLabelWeighter">BaseLabelWeighter</a>[<span title="formed.integrations.flax.modules.losses._ParamsT">_ParamsT</span>] | None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>reduce</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Reduction method for loss computation ("mean" or "sum").</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Literal">Literal</span>[&#39;mean&#39;, &#39;sum&#39;]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;mean&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>








                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/formed/integrations/flax/modules/losses.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-50"><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="__span-0-51">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-52">    <span class="n">weighter</span><span class="p">:</span> <span class="n">BaseLabelWeighter</span><span class="p">[</span><span class="n">_ParamsT</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-53">    <span class="n">reduce</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;sum&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span>
</span><span id="__span-0-54"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-55">    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="__span-0-56">    <span class="bp">self</span><span class="o">.</span><span class="n">_weighter</span> <span class="o">=</span> <span class="n">weighter</span>
</span><span id="__span-0-57">    <span class="bp">self</span><span class="o">.</span><span class="n">_reduce</span> <span class="o">=</span> <span class="n">reduce</span>
</span></code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">












  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="formed.integrations.flax.modules.samplers" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">formed.integrations.flax.modules.samplers</span>


<a href="#formed.integrations.flax.modules.samplers" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h3 id="formed.integrations.flax.modules.samplers.BaseLabelSampler" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">BaseLabelSampler</span>


<a href="#formed.integrations.flax.modules.samplers.BaseLabelSampler" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="flax.nnx.Module">Module</span></code>, <code><span title="colt.Registrable">Registrable</span></code>, <code><span title="typing.Generic">Generic</span>[<span title="formed.integrations.flax.modules.samplers._ParamsT">_ParamsT</span>]</code>, <code><span title="abc.ABC">ABC</span></code></p>



        <p>Abstract base class for label samplers.</p>
<p>A LabelSampler defines a strategy for sampling labels based on model logits.</p>


<table>
      <thead>
        <tr>
          <th>
            <span class="doc-section-title">
              CLASS TYPE PARAMETER
            </span>
          </th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>_ParamsT</code>
            </td>
            <td class="doc-type_param-details">
              <div class="doc-md-description">
                <p>Type of additional parameters used during sampling.</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
      </tbody>
    </table>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="formed.integrations.flax.modules.samplers.ArgmaxLabelSampler" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">ArgmaxLabelSampler</span>


<a href="#formed.integrations.flax.modules.samplers.ArgmaxLabelSampler" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;BaseLabelSampler&lt;/span&gt; (&lt;code&gt;formed.integrations.flax.modules.samplers.BaseLabelSampler&lt;/code&gt;)" href="#formed.integrations.flax.modules.samplers.BaseLabelSampler">BaseLabelSampler</a>[None]</code></p>



        <p>Label sampler that selects the label with the highest logit.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="formed.integrations.flax.modules.samplers.MultinomialLabelSamplerParams" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">MultinomialLabelSamplerParams</span>


<a href="#formed.integrations.flax.modules.samplers.MultinomialLabelSamplerParams" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.NamedTuple">NamedTuple</span></code></p>



        <p>Parameters for the MultinomialLabelSampler.</p>
<p>This class can be extended in the future to include additional parameters
for sampling if needed.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">ATTRIBUTE</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-attribute&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-attribute-name&quot;&gt;rngs&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-class-attribute&quot;&gt;&lt;code&gt;class-attribute&lt;/code&gt;&lt;/small&gt;
      &lt;small class=&quot;doc doc-label doc-label-instance-attribute&quot;&gt;&lt;code&gt;instance-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;formed.integrations.flax.modules.samplers.MultinomialLabelSamplerParams.rngs&lt;/code&gt;)" href="#formed.integrations.flax.modules.samplers.MultinomialLabelSamplerParams.rngs">rngs</a></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                <p>Random number generators.</p>
              </div>
              <p>
                  <span class="doc-attribute-annotation">
                    <b>TYPE:</b>
                      <code><span title="flax.nnx.Rngs">Rngs</span> | None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-attribute&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-attribute-name&quot;&gt;templerature&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-class-attribute&quot;&gt;&lt;code&gt;class-attribute&lt;/code&gt;&lt;/small&gt;
      &lt;small class=&quot;doc doc-label doc-label-instance-attribute&quot;&gt;&lt;code&gt;instance-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;formed.integrations.flax.modules.samplers.MultinomialLabelSamplerParams.templerature&lt;/code&gt;)" href="#formed.integrations.flax.modules.samplers.MultinomialLabelSamplerParams.templerature">templerature</a></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                <p>Sampling temperature to control randomness.</p>
              </div>
              <p>
                  <span class="doc-attribute-annotation">
                    <b>TYPE:</b>
                      <code><span title="float">float</span></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>











<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="formed.integrations.flax.modules.samplers.MultinomialLabelSamplerParams.rngs" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">rngs</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#formed.integrations.flax.modules.samplers.MultinomialLabelSamplerParams.rngs" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">rngs</span> <span class="o">=</span> <span class="kc">None</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="formed.integrations.flax.modules.samplers.MultinomialLabelSamplerParams.templerature" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">templerature</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#formed.integrations.flax.modules.samplers.MultinomialLabelSamplerParams.templerature" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">templerature</span> <span class="o">=</span> <span class="mf">1.0</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>






  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="formed.integrations.flax.modules.samplers.MultinomialLabelSampler" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">MultinomialLabelSampler</span>


<a href="#formed.integrations.flax.modules.samplers.MultinomialLabelSampler" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;BaseLabelSampler&lt;/span&gt; (&lt;code&gt;formed.integrations.flax.modules.samplers.BaseLabelSampler&lt;/code&gt;)" href="#formed.integrations.flax.modules.samplers.BaseLabelSampler">BaseLabelSampler</a>[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;MultinomialLabelSamplerParams&lt;/span&gt; (&lt;code&gt;formed.integrations.flax.modules.samplers.MultinomialLabelSamplerParams&lt;/code&gt;)" href="#formed.integrations.flax.modules.samplers.MultinomialLabelSamplerParams">MultinomialLabelSamplerParams</a>]</code></p>



        <p>Label sampler that samples labels from a multinomial distribution defined by the logits.</p>











<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="formed.integrations.flax.modules.samplers.MultinomialLabelSampler.Params" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">Params</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#formed.integrations.flax.modules.samplers.MultinomialLabelSampler.Params" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">Params</span> <span class="o">=</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;MultinomialLabelSamplerParams&lt;/span&gt; (&lt;code&gt;formed.integrations.flax.modules.samplers.MultinomialLabelSamplerParams&lt;/code&gt;)" href="#formed.integrations.flax.modules.samplers.MultinomialLabelSamplerParams">MultinomialLabelSamplerParams</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>






  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="formed.integrations.flax.modules.vectorizers" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">formed.integrations.flax.modules.vectorizers</span>


<a href="#formed.integrations.flax.modules.vectorizers" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

        <p>Sequence vectorization modules for Flax models.</p>
<p>This module provides vectorizers that convert variable-length sequences
into fixed-size vectors. Vectorizers apply pooling operations over the
sequence dimension to produce single vectors per sequence.</p>


<details class="key-components" open>
  <summary>Key Components</summary>
  <ul>
<li>BaseSequenceVectorizer: Abstract base class for vectorizers</li>
<li>BagOfEmbeddingsSequenceVectorizer: Pools sequence embeddings</li>
</ul>
</details>

<details class="features" open>
  <summary>Features</summary>
  <ul>
<li>Multiple pooling strategies (mean, max, min, sum, first, last, hier)</li>
<li>Masked pooling to ignore padding tokens</li>
<li>Optional normalization before pooling</li>
<li>Hierarchical pooling with sliding windows</li>
</ul>
</details>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span id="__span-0-1"><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">formed.integrations.flax.modules</span><span class="w"> </span><span class="kn">import</span> <span class="n">BagOfEmbeddingsSequenceVectorizer</span>
</span><span id="__span-0-2"><span class="gp">&gt;&gt;&gt;</span>
</span><span id="__span-0-3"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Mean pooling over sequence</span>
</span><span id="__span-0-4"><span class="gp">&gt;&gt;&gt; </span><span class="n">vectorizer</span> <span class="o">=</span> <span class="n">BagOfEmbeddingsSequenceVectorizer</span><span class="p">(</span><span class="n">pooling</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">)</span>
</span><span id="__span-0-5"><span class="gp">&gt;&gt;&gt; </span><span class="n">vector</span> <span class="o">=</span> <span class="n">vectorizer</span><span class="p">(</span><span class="n">embeddings</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
</span><span id="__span-0-6"><span class="gp">&gt;&gt;&gt;</span>
</span><span id="__span-0-7"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Max pooling with normalization</span>
</span><span id="__span-0-8"><span class="gp">&gt;&gt;&gt; </span><span class="n">vectorizer</span> <span class="o">=</span> <span class="n">BagOfEmbeddingsSequenceVectorizer</span><span class="p">(</span>
</span><span id="__span-0-9"><span class="gp">... </span>    <span class="n">pooling</span><span class="o">=</span><span class="s2">&quot;max&quot;</span><span class="p">,</span>
</span><span id="__span-0-10"><span class="gp">... </span>    <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span>
</span><span id="__span-0-11"><span class="gp">... </span><span class="p">)</span>
</span></code></pre></div>










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h3 id="formed.integrations.flax.modules.vectorizers.BaseSequenceVectorizer" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">BaseSequenceVectorizer</span>


<a href="#formed.integrations.flax.modules.vectorizers.BaseSequenceVectorizer" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="flax.nnx.Module">Module</span></code>, <code><span title="colt.Registrable">Registrable</span></code>, <code><span title="abc.ABC">ABC</span></code></p>



        <p>Abstract base class for sequence vectorizers.</p>
<p>Vectorizers convert variable-length sequences into fixed-size vectors
by applying pooling operations over the sequence dimension.</p>











<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.modules.vectorizers.BaseSequenceVectorizer.get_input_dim" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_input_dim</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

<a href="#formed.integrations.flax.modules.vectorizers.BaseSequenceVectorizer.get_input_dim" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">get_input_dim</span><span class="p">()</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Get the expected input dimension.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="int">int</span> | None</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Input dimension or None if dimension-agnostic.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/modules/vectorizers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-69"><span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
</span><span id="__span-0-70"><span class="k">def</span><span class="w"> </span><span class="nf">get_input_dim</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-71"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the expected input dimension.</span>
</span><span id="__span-0-72">
</span><span id="__span-0-73"><span class="sd">    Returns:</span>
</span><span id="__span-0-74"><span class="sd">        Input dimension or None if dimension-agnostic.</span>
</span><span id="__span-0-75">
</span><span id="__span-0-76"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-77">    <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.modules.vectorizers.BaseSequenceVectorizer.get_output_dim" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_output_dim</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

<a href="#formed.integrations.flax.modules.vectorizers.BaseSequenceVectorizer.get_output_dim" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">get_output_dim</span><span class="p">()</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Get the output dimension.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="int">int</span> | <span title="collections.abc.Callable">Callable</span>[[<span title="int">int</span>], <span title="int">int</span>]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Output feature dimension or a function mapping input dim to output dim.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/modules/vectorizers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-79"><span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
</span><span id="__span-0-80"><span class="k">def</span><span class="w"> </span><span class="nf">get_output_dim</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">int</span><span class="p">],</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="__span-0-81"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the output dimension.</span>
</span><span id="__span-0-82">
</span><span id="__span-0-83"><span class="sd">    Returns:</span>
</span><span id="__span-0-84"><span class="sd">        Output feature dimension or a function mapping input dim to output dim.</span>
</span><span id="__span-0-85">
</span><span id="__span-0-86"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-87">    <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="formed.integrations.flax.modules.vectorizers.BagOfEmbeddingsSequenceVectorizer" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">BagOfEmbeddingsSequenceVectorizer</span>


<a href="#formed.integrations.flax.modules.vectorizers.BagOfEmbeddingsSequenceVectorizer" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">BagOfEmbeddingsSequenceVectorizer</span><span class="p">(</span>
</span><span id="__span-0-2">    <span class="n">pooling</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">window_size</span><span class="o">=</span><span class="kc">None</span>
</span><span id="__span-0-3"><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;BaseSequenceVectorizer&lt;/span&gt; (&lt;code&gt;formed.integrations.flax.modules.vectorizers.BaseSequenceVectorizer&lt;/code&gt;)" href="#formed.integrations.flax.modules.vectorizers.BaseSequenceVectorizer">BaseSequenceVectorizer</a></code></p>



        <p>Bag-of-embeddings vectorizer using pooling operations.</p>
<p>This vectorizer applies pooling over the sequence dimension to create
fixed-size vectors. Multiple pooling strategies are supported, and
padding tokens are properly masked during pooling.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pooling</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Pooling strategy to use:
- "mean": Average pooling (default)
- "max": Max pooling
- "min": Min pooling
- "sum": Sum pooling
- "first": Take first token
- "last": Take last non-padding token
- "hier": Hierarchical pooling with sliding window</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-attribute&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-attribute-name&quot;&gt;PoolingMethod&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;formed.integrations.flax.utils.PoolingMethod&lt;/code&gt;)" href="#formed.integrations.flax.utils.PoolingMethod">PoolingMethod</a> | <span title="collections.abc.Sequence">Sequence</span>[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-attribute&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-attribute-name&quot;&gt;PoolingMethod&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;formed.integrations.flax.utils.PoolingMethod&lt;/code&gt;)" href="#formed.integrations.flax.utils.PoolingMethod">PoolingMethod</a>]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;mean&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>normalize</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to L2-normalize embeddings before pooling.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="bool">bool</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>window_size</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Window size for hierarchical pooling (required if pooling="hier").</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="int">int</span> | None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span id="__span-0-1"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Mean pooling</span>
</span><span id="__span-0-2"><span class="gp">&gt;&gt;&gt; </span><span class="n">vectorizer</span> <span class="o">=</span> <span class="n">BagOfEmbeddingsSequenceVectorizer</span><span class="p">(</span><span class="n">pooling</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">)</span>
</span><span id="__span-0-3"><span class="gp">&gt;&gt;&gt; </span><span class="n">vector</span> <span class="o">=</span> <span class="n">vectorizer</span><span class="p">(</span><span class="n">embeddings</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
</span><span id="__span-0-4"><span class="gp">&gt;&gt;&gt;</span>
</span><span id="__span-0-5"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Max pooling with normalization</span>
</span><span id="__span-0-6"><span class="gp">&gt;&gt;&gt; </span><span class="n">vectorizer</span> <span class="o">=</span> <span class="n">BagOfEmbeddingsSequenceVectorizer</span><span class="p">(</span>
</span><span id="__span-0-7"><span class="gp">... </span>    <span class="n">pooling</span><span class="o">=</span><span class="s2">&quot;max&quot;</span><span class="p">,</span>
</span><span id="__span-0-8"><span class="gp">... </span>    <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span>
</span><span id="__span-0-9"><span class="gp">... </span><span class="p">)</span>
</span><span id="__span-0-10"><span class="gp">&gt;&gt;&gt;</span>
</span><span id="__span-0-11"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Hierarchical pooling</span>
</span><span id="__span-0-12"><span class="gp">&gt;&gt;&gt; </span><span class="n">vectorizer</span> <span class="o">=</span> <span class="n">BagOfEmbeddingsSequenceVectorizer</span><span class="p">(</span>
</span><span id="__span-0-13"><span class="gp">... </span>    <span class="n">pooling</span><span class="o">=</span><span class="s2">&quot;hier&quot;</span><span class="p">,</span>
</span><span id="__span-0-14"><span class="gp">... </span>    <span class="n">window_size</span><span class="o">=</span><span class="mi">3</span>
</span><span id="__span-0-15"><span class="gp">... </span><span class="p">)</span>
</span></code></pre></div>


<details class="note" open>
  <summary>Note</summary>
  <p>This vectorizer is dimension-agnostic - it preserves the embedding
dimension from input to output.</p>
</details>







                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/formed/integrations/flax/modules/vectorizers.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-134"><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="__span-0-135">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-136">    <span class="n">pooling</span><span class="p">:</span> <span class="n">PoolingMethod</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">PoolingMethod</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span>
</span><span id="__span-0-137">    <span class="n">normalize</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-138">    <span class="n">window_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-139"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-140">    <span class="bp">self</span><span class="o">.</span><span class="n">_pooling</span><span class="p">:</span> <span class="n">PoolingMethod</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">PoolingMethod</span><span class="p">]</span> <span class="o">=</span> <span class="n">pooling</span>
</span><span id="__span-0-141">    <span class="bp">self</span><span class="o">.</span><span class="n">_normalize</span> <span class="o">=</span> <span class="n">normalize</span>
</span><span id="__span-0-142">    <span class="bp">self</span><span class="o">.</span><span class="n">_window_size</span> <span class="o">=</span> <span class="n">window_size</span>
</span></code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.modules.vectorizers.BagOfEmbeddingsSequenceVectorizer.get_input_dim" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_input_dim</span>


<a href="#formed.integrations.flax.modules.vectorizers.BagOfEmbeddingsSequenceVectorizer.get_input_dim" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">get_input_dim</span><span class="p">()</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/modules/vectorizers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">158</span>
<span class="normal">159</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-158"><span class="k">def</span><span class="w"> </span><span class="nf">get_input_dim</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-159">    <span class="k">return</span> <span class="kc">None</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.modules.vectorizers.BagOfEmbeddingsSequenceVectorizer.get_output_dim" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_output_dim</span>


<a href="#formed.integrations.flax.modules.vectorizers.BagOfEmbeddingsSequenceVectorizer.get_output_dim" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">get_output_dim</span><span class="p">()</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/modules/vectorizers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-161"><span class="k">def</span><span class="w"> </span><span class="nf">get_output_dim</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">int</span><span class="p">],</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="__span-0-162">    <span class="n">num_pooling</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pooling</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pooling</span><span class="p">)</span>
</span><span id="__span-0-163">    <span class="k">return</span> <span class="k">lambda</span> <span class="n">input_dim</span><span class="p">:</span> <span class="n">input_dim</span> <span class="o">*</span> <span class="n">num_pooling</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="formed.integrations.flax.modules.weighters" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">formed.integrations.flax.modules.weighters</span>


<a href="#formed.integrations.flax.modules.weighters" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h3 id="formed.integrations.flax.modules.weighters.BaseLabelWeighter" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">BaseLabelWeighter</span>


<a href="#formed.integrations.flax.modules.weighters.BaseLabelWeighter" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="flax.nnx.Module">Module</span></code>, <code><span title="colt.Registrable">Registrable</span></code>, <code><span title="typing.Generic">Generic</span>[<span title="formed.integrations.flax.modules.weighters._ParamsT">_ParamsT</span>]</code>, <code><span title="abc.ABC">ABC</span></code></p>



        <p>Abstract base class for label weighters.</p>
<p>A LabelWeighter defines a strategy for assigning weights to each label
based on model logits and true targets.</p>


<table>
      <thead>
        <tr>
          <th>
            <span class="doc-section-title">
              CLASS TYPE PARAMETER
            </span>
          </th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>_ParamsT</code>
            </td>
            <td class="doc-type_param-details">
              <div class="doc-md-description">
                <p>Type of additional parameters used during weighting.</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
      </tbody>
    </table>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="formed.integrations.flax.modules.weighters.StaticLabelWeighter" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">StaticLabelWeighter</span>


<a href="#formed.integrations.flax.modules.weighters.StaticLabelWeighter" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">StaticLabelWeighter</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;BaseLabelWeighter&lt;/span&gt; (&lt;code&gt;formed.integrations.flax.modules.weighters.BaseLabelWeighter&lt;/code&gt;)" href="#formed.integrations.flax.modules.weighters.BaseLabelWeighter">BaseLabelWeighter</a></code></p>



        <p>Label weighter that assigns static weights to each class.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>weights</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>An array of shape (num_classes,) containing the weight for each class.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="formed.integrations.flax.types.ArrayCompatible">ArrayCompatible</span></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>








                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/formed/integrations/flax/modules/weighters.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-53"><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weights</span><span class="p">:</span> <span class="n">ArrayCompatible</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-54">    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="__span-0-55">    <span class="bp">self</span><span class="o">.</span><span class="n">_weights</span> <span class="o">=</span> <span class="n">nnx</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">ensure_jax_array</span><span class="p">(</span><span class="n">weights</span><span class="p">),</span> <span class="n">mutable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="formed.integrations.flax.modules.weighters.BalancedByDistributionLabelWeighter" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">BalancedByDistributionLabelWeighter</span>


<a href="#formed.integrations.flax.modules.weighters.BalancedByDistributionLabelWeighter" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">BalancedByDistributionLabelWeighter</span><span class="p">(</span>
</span><span id="__span-0-2">    <span class="n">distribution</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-08</span>
</span><span id="__span-0-3"><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;BaseLabelWeighter&lt;/span&gt; (&lt;code&gt;formed.integrations.flax.modules.weighters.BaseLabelWeighter&lt;/code&gt;)" href="#formed.integrations.flax.modules.weighters.BaseLabelWeighter">BaseLabelWeighter</a></code></p>



        <p>Label weighter that balances classes based on their distribution.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>distribution</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>An array of shape (num_classes,) representing the class distribution.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="formed.integrations.flax.types.ArrayCompatible">ArrayCompatible</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>eps</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>A small epsilon value to avoid division by zero.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="float">float</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>1e-08</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>








                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/formed/integrations/flax/modules/weighters.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-76"><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">distribution</span><span class="p">:</span> <span class="n">ArrayCompatible</span><span class="p">,</span> <span class="n">eps</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-8</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-77">    <span class="bp">self</span><span class="o">.</span><span class="n">_distribution</span> <span class="o">=</span> <span class="n">nnx</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">ensure_jax_array</span><span class="p">(</span><span class="n">distribution</span><span class="p">),</span> <span class="n">mutable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-0-78">    <span class="bp">self</span><span class="o">.</span><span class="n">_eps</span> <span class="o">=</span> <span class="n">eps</span>
</span></code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">












  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="formed.integrations.flax.training.callbacks" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">formed.integrations.flax.training.callbacks</span>


<a href="#formed.integrations.flax.training.callbacks" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

        <p>Training callbacks for monitoring and controlling Flax model training.</p>
<p>This module provides a callback system for Flax training, allowing custom
logic to be executed at various points in the training loop. Callbacks can
monitor metrics, save checkpoints, implement early stopping, and integrate
with experiment tracking systems.</p>


<details class="key-components" open>
  <summary>Key Components</summary>
  <ul>
<li>FlaxTrainingCallback: Base class for all callbacks</li>
<li>EvaluationCallback: Computes metrics using custom evaluators</li>
<li>EarlyStoppingCallback: Stops training based on metric improvements</li>
<li>MlflowCallback: Logs metrics to MLflow</li>
</ul>
</details>

<details class="features" open>
  <summary>Features</summary>
  <ul>
<li>Hook points at training/epoch/batch start and end</li>
<li>Metric computation and logging</li>
<li>Model checkpointing</li>
<li>Early stopping with patience</li>
<li>MLflow integration</li>
<li>Extensible for custom callbacks</li>
</ul>
</details>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span id="__span-0-1"><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">formed.integrations.flax</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="__span-0-2"><span class="gp">... </span>    <span class="n">FlaxTrainer</span><span class="p">,</span>
</span><span id="__span-0-3"><span class="gp">... </span>    <span class="n">EarlyStoppingCallback</span><span class="p">,</span>
</span><span id="__span-0-4"><span class="gp">... </span>    <span class="n">EvaluationCallback</span><span class="p">,</span>
</span><span id="__span-0-5"><span class="gp">... </span>    <span class="n">MlflowCallback</span>
</span><span id="__span-0-6"><span class="gp">... </span><span class="p">)</span>
</span><span id="__span-0-7"><span class="gp">&gt;&gt;&gt;</span>
</span><span id="__span-0-8"><span class="gp">&gt;&gt;&gt; </span><span class="n">trainer</span> <span class="o">=</span> <span class="n">FlaxTrainer</span><span class="p">(</span>
</span><span id="__span-0-9"><span class="gp">... </span>    <span class="n">train_dataloader</span><span class="o">=</span><span class="n">train_loader</span><span class="p">,</span>
</span><span id="__span-0-10"><span class="gp">... </span>    <span class="n">val_dataloader</span><span class="o">=</span><span class="n">val_loader</span><span class="p">,</span>
</span><span id="__span-0-11"><span class="gp">... </span>    <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span>
</span><span id="__span-0-12"><span class="gp">... </span>        <span class="n">EvaluationCallback</span><span class="p">(</span><span class="n">my_evaluator</span><span class="p">),</span>
</span><span id="__span-0-13"><span class="gp">... </span>        <span class="n">EarlyStoppingCallback</span><span class="p">(</span><span class="n">patience</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;-loss&quot;</span><span class="p">),</span>
</span><span id="__span-0-14"><span class="gp">... </span>        <span class="n">MlflowCallback</span><span class="p">()</span>
</span><span id="__span-0-15"><span class="gp">... </span>    <span class="p">]</span>
</span><span id="__span-0-16"><span class="gp">... </span><span class="p">)</span>
</span></code></pre></div>










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h3 id="formed.integrations.flax.training.callbacks.FlaxTrainingCallback" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">FlaxTrainingCallback</span>


<a href="#formed.integrations.flax.training.callbacks.FlaxTrainingCallback" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="colt.Registrable">Registrable</span></code></p>



        <p>Base class for training callbacks.</p>
<p>Callbacks provide hooks to execute custom logic at various points
during training. Subclasses can override any hook method to implement
custom behavior such as logging, checkpointing, or early stopping.</p>


<details class="hook-execution-order" open>
  <summary>Hook execution order</summary>
  <ol>
<li>on_training_start - once at the beginning</li>
<li>on_epoch_start - at the start of each epoch</li>
<li>on_batch_start - before each training batch</li>
<li>on_batch_end - after each training batch</li>
<li>on_eval_start - before evaluation (returns evaluator)</li>
<li>on_eval_end - after evaluation with computed metrics</li>
<li>on_log - when metrics are logged</li>
<li>on_epoch_end - at the end of each epoch</li>
<li>on_training_end - once at the end (can modify final state)</li>
</ol>
</details>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span id="__span-0-1"><span class="gp">&gt;&gt;&gt; </span><span class="nd">@FlaxTrainingCallback</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;my_callback&quot;</span><span class="p">)</span>
</span><span id="__span-0-2"><span class="gp">... </span><span class="k">class</span><span class="w"> </span><span class="nc">MyCallback</span><span class="p">(</span><span class="n">FlaxTrainingCallback</span><span class="p">):</span>
</span><span id="__span-0-3"><span class="gp">... </span>    <span class="k">def</span><span class="w"> </span><span class="nf">on_epoch_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trainer</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">epoch</span><span class="p">):</span>
</span><span id="__span-0-4"><span class="gp">... </span>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Completed epoch </span><span class="si">{</span><span class="n">epoch</span><span class="si">}</span><span class="s2"> at step </span><span class="si">{</span><span class="n">state</span><span class="o">.</span><span class="n">step</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></code></pre></div>











<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.training.callbacks.FlaxTrainingCallback.on_training_start" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">on_training_start</span>


<a href="#formed.integrations.flax.training.callbacks.FlaxTrainingCallback.on_training_start" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">on_training_start</span><span class="p">(</span><span class="n">trainer</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/training/callbacks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-87"><span class="k">def</span><span class="w"> </span><span class="nf">on_training_start</span><span class="p">(</span>
</span><span id="__span-0-88">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-89">    <span class="n">trainer</span><span class="p">:</span> <span class="s2">&quot;FlaxTrainer[ItemT, ModelInputT, ModelOutputT, ModelParamsT]&quot;</span><span class="p">,</span>
</span><span id="__span-0-90">    <span class="n">model</span><span class="p">:</span> <span class="n">BaseFlaxModel</span><span class="p">[</span><span class="n">ModelInputT</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">,</span> <span class="n">ModelParamsT</span><span class="p">],</span>
</span><span id="__span-0-91">    <span class="n">state</span><span class="p">:</span> <span class="n">TrainState</span><span class="p">,</span>
</span><span id="__span-0-92"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-93">    <span class="k">pass</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.training.callbacks.FlaxTrainingCallback.on_training_end" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">on_training_end</span>


<a href="#formed.integrations.flax.training.callbacks.FlaxTrainingCallback.on_training_end" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">on_training_end</span><span class="p">(</span><span class="n">trainer</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/training/callbacks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-95"><span class="k">def</span><span class="w"> </span><span class="nf">on_training_end</span><span class="p">(</span>
</span><span id="__span-0-96">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-97">    <span class="n">trainer</span><span class="p">:</span> <span class="s2">&quot;FlaxTrainer[ItemT, ModelInputT, ModelOutputT, ModelParamsT]&quot;</span><span class="p">,</span>
</span><span id="__span-0-98">    <span class="n">model</span><span class="p">:</span> <span class="n">BaseFlaxModel</span><span class="p">[</span><span class="n">ModelInputT</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">,</span> <span class="n">ModelParamsT</span><span class="p">],</span>
</span><span id="__span-0-99">    <span class="n">state</span><span class="p">:</span> <span class="n">TrainState</span><span class="p">,</span>
</span><span id="__span-0-100"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TrainState</span><span class="p">:</span>
</span><span id="__span-0-101">    <span class="k">return</span> <span class="n">state</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.training.callbacks.FlaxTrainingCallback.on_epoch_start" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">on_epoch_start</span>


<a href="#formed.integrations.flax.training.callbacks.FlaxTrainingCallback.on_epoch_start" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">on_epoch_start</span><span class="p">(</span><span class="n">trainer</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">epoch</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/training/callbacks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-103"><span class="k">def</span><span class="w"> </span><span class="nf">on_epoch_start</span><span class="p">(</span>
</span><span id="__span-0-104">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-105">    <span class="n">trainer</span><span class="p">:</span> <span class="s2">&quot;FlaxTrainer[ItemT, ModelInputT, ModelOutputT, ModelParamsT]&quot;</span><span class="p">,</span>
</span><span id="__span-0-106">    <span class="n">model</span><span class="p">:</span> <span class="n">BaseFlaxModel</span><span class="p">[</span><span class="n">ModelInputT</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">,</span> <span class="n">ModelParamsT</span><span class="p">],</span>
</span><span id="__span-0-107">    <span class="n">state</span><span class="p">:</span> <span class="n">TrainState</span><span class="p">,</span>
</span><span id="__span-0-108">    <span class="n">epoch</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="__span-0-109"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-110">    <span class="k">pass</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.training.callbacks.FlaxTrainingCallback.on_epoch_end" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">on_epoch_end</span>


<a href="#formed.integrations.flax.training.callbacks.FlaxTrainingCallback.on_epoch_end" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">on_epoch_end</span><span class="p">(</span><span class="n">trainer</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">epoch</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/training/callbacks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-112"><span class="k">def</span><span class="w"> </span><span class="nf">on_epoch_end</span><span class="p">(</span>
</span><span id="__span-0-113">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-114">    <span class="n">trainer</span><span class="p">:</span> <span class="s2">&quot;FlaxTrainer[ItemT, ModelInputT, ModelOutputT, ModelParamsT]&quot;</span><span class="p">,</span>
</span><span id="__span-0-115">    <span class="n">model</span><span class="p">:</span> <span class="n">BaseFlaxModel</span><span class="p">[</span><span class="n">ModelInputT</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">,</span> <span class="n">ModelParamsT</span><span class="p">],</span>
</span><span id="__span-0-116">    <span class="n">state</span><span class="p">:</span> <span class="n">TrainState</span><span class="p">,</span>
</span><span id="__span-0-117">    <span class="n">epoch</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="__span-0-118"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-119">    <span class="k">pass</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.training.callbacks.FlaxTrainingCallback.on_batch_start" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">on_batch_start</span>


<a href="#formed.integrations.flax.training.callbacks.FlaxTrainingCallback.on_batch_start" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">on_batch_start</span><span class="p">(</span><span class="n">trainer</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">epoch</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/training/callbacks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-121"><span class="k">def</span><span class="w"> </span><span class="nf">on_batch_start</span><span class="p">(</span>
</span><span id="__span-0-122">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-123">    <span class="n">trainer</span><span class="p">:</span> <span class="s2">&quot;FlaxTrainer[ItemT, ModelInputT, ModelOutputT, ModelParamsT]&quot;</span><span class="p">,</span>
</span><span id="__span-0-124">    <span class="n">model</span><span class="p">:</span> <span class="n">BaseFlaxModel</span><span class="p">[</span><span class="n">ModelInputT</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">,</span> <span class="n">ModelParamsT</span><span class="p">],</span>
</span><span id="__span-0-125">    <span class="n">state</span><span class="p">:</span> <span class="n">TrainState</span><span class="p">,</span>
</span><span id="__span-0-126">    <span class="n">epoch</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="__span-0-127"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-128">    <span class="k">pass</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.training.callbacks.FlaxTrainingCallback.on_batch_end" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">on_batch_end</span>


<a href="#formed.integrations.flax.training.callbacks.FlaxTrainingCallback.on_batch_end" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">on_batch_end</span><span class="p">(</span><span class="n">trainer</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">epoch</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/training/callbacks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-130"><span class="k">def</span><span class="w"> </span><span class="nf">on_batch_end</span><span class="p">(</span>
</span><span id="__span-0-131">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-132">    <span class="n">trainer</span><span class="p">:</span> <span class="s2">&quot;FlaxTrainer[ItemT, ModelInputT, ModelOutputT, ModelParamsT]&quot;</span><span class="p">,</span>
</span><span id="__span-0-133">    <span class="n">model</span><span class="p">:</span> <span class="n">BaseFlaxModel</span><span class="p">[</span><span class="n">ModelInputT</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">,</span> <span class="n">ModelParamsT</span><span class="p">],</span>
</span><span id="__span-0-134">    <span class="n">state</span><span class="p">:</span> <span class="n">TrainState</span><span class="p">,</span>
</span><span id="__span-0-135">    <span class="n">epoch</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="__span-0-136">    <span class="n">output</span><span class="p">:</span> <span class="n">ModelOutputT</span><span class="p">,</span>
</span><span id="__span-0-137"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-138">    <span class="k">pass</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.training.callbacks.FlaxTrainingCallback.on_eval_start" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">on_eval_start</span>


<a href="#formed.integrations.flax.training.callbacks.FlaxTrainingCallback.on_eval_start" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">on_eval_start</span><span class="p">(</span><span class="n">trainer</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/training/callbacks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-140"><span class="k">def</span><span class="w"> </span><span class="nf">on_eval_start</span><span class="p">(</span>
</span><span id="__span-0-141">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-142">    <span class="n">trainer</span><span class="p">:</span> <span class="s2">&quot;FlaxTrainer[ItemT, ModelInputT, ModelOutputT, ModelParamsT]&quot;</span><span class="p">,</span>
</span><span id="__span-0-143">    <span class="n">model</span><span class="p">:</span> <span class="n">BaseFlaxModel</span><span class="p">[</span><span class="n">ModelInputT</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">,</span> <span class="n">ModelParamsT</span><span class="p">],</span>
</span><span id="__span-0-144">    <span class="n">state</span><span class="p">:</span> <span class="n">TrainState</span><span class="p">,</span>
</span><span id="__span-0-145"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IEvaluator</span><span class="p">[</span><span class="n">ModelInputT</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">]:</span>
</span><span id="__span-0-146">    <span class="k">class</span><span class="w"> </span><span class="nc">DummyMetric</span><span class="p">(</span><span class="n">IEvaluator</span><span class="p">):</span>
</span><span id="__span-0-147">        <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-148">            <span class="k">pass</span>
</span><span id="__span-0-149">
</span><span id="__span-0-150">        <span class="k">def</span><span class="w"> </span><span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
</span><span id="__span-0-151">            <span class="k">return</span> <span class="p">{}</span>
</span><span id="__span-0-152">
</span><span id="__span-0-153">        <span class="k">def</span><span class="w"> </span><span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-154">            <span class="k">pass</span>
</span><span id="__span-0-155">
</span><span id="__span-0-156">    <span class="k">return</span> <span class="n">DummyMetric</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.training.callbacks.FlaxTrainingCallback.on_eval_end" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">on_eval_end</span>


<a href="#formed.integrations.flax.training.callbacks.FlaxTrainingCallback.on_eval_end" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">on_eval_end</span><span class="p">(</span><span class="n">trainer</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">metrics</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/training/callbacks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-158"><span class="k">def</span><span class="w"> </span><span class="nf">on_eval_end</span><span class="p">(</span>
</span><span id="__span-0-159">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-160">    <span class="n">trainer</span><span class="p">:</span> <span class="s2">&quot;FlaxTrainer[ItemT, ModelInputT, ModelOutputT, ModelParamsT]&quot;</span><span class="p">,</span>
</span><span id="__span-0-161">    <span class="n">model</span><span class="p">:</span> <span class="n">BaseFlaxModel</span><span class="p">[</span><span class="n">ModelInputT</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">,</span> <span class="n">ModelParamsT</span><span class="p">],</span>
</span><span id="__span-0-162">    <span class="n">state</span><span class="p">:</span> <span class="n">TrainState</span><span class="p">,</span>
</span><span id="__span-0-163">    <span class="n">metrics</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
</span><span id="__span-0-164">    <span class="n">prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="__span-0-165"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-166">    <span class="k">pass</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.training.callbacks.FlaxTrainingCallback.on_log" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">on_log</span>


<a href="#formed.integrations.flax.training.callbacks.FlaxTrainingCallback.on_log" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">on_log</span><span class="p">(</span><span class="n">trainer</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">metrics</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/training/callbacks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-168"><span class="k">def</span><span class="w"> </span><span class="nf">on_log</span><span class="p">(</span>
</span><span id="__span-0-169">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-170">    <span class="n">trainer</span><span class="p">:</span> <span class="s2">&quot;FlaxTrainer[ItemT, ModelInputT, ModelOutputT, ModelParamsT]&quot;</span><span class="p">,</span>
</span><span id="__span-0-171">    <span class="n">model</span><span class="p">:</span> <span class="n">BaseFlaxModel</span><span class="p">[</span><span class="n">ModelInputT</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">,</span> <span class="n">ModelParamsT</span><span class="p">],</span>
</span><span id="__span-0-172">    <span class="n">state</span><span class="p">:</span> <span class="n">TrainState</span><span class="p">,</span>
</span><span id="__span-0-173">    <span class="n">metrics</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
</span><span id="__span-0-174">    <span class="n">prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="__span-0-175"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-176">    <span class="k">pass</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="formed.integrations.flax.training.callbacks.EvaluationCallback" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">EvaluationCallback</span>


<a href="#formed.integrations.flax.training.callbacks.EvaluationCallback" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">EvaluationCallback</span><span class="p">(</span><span class="n">evaluator</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;FlaxTrainingCallback&lt;/span&gt; (&lt;code&gt;formed.integrations.flax.training.callbacks.FlaxTrainingCallback&lt;/code&gt;)" href="#formed.integrations.flax.training.callbacks.FlaxTrainingCallback">FlaxTrainingCallback</a></code>, <code><span title="typing.Generic">Generic</span>[<span title="formed.integrations.flax.types.ModelInputT">ModelInputT</span>, <span title="formed.integrations.flax.types.ModelOutputT">ModelOutputT</span>]</code></p>



        <p>Callback for computing metrics using a custom evaluator.</p>
<p>This callback integrates a custom evaluator into the training loop,
resetting it before each evaluation phase and returning it for
metric accumulation.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>evaluator</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Evaluator implementing the IEvaluator protocol.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="formed.integrations.flax.types.IEvaluator">IEvaluator</span>[<span title="formed.integrations.flax.types.ModelInputT">ModelInputT</span>, <span title="formed.integrations.flax.types.ModelOutputT">ModelOutputT</span>]</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span id="__span-0-1"><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">formed.integrations.ml.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">MulticlassAccuracy</span>
</span><span id="__span-0-2"><span class="gp">&gt;&gt;&gt;</span>
</span><span id="__span-0-3"><span class="gp">&gt;&gt;&gt; </span><span class="n">evaluator</span> <span class="o">=</span> <span class="n">MulticlassAccuracy</span><span class="p">()</span>
</span><span id="__span-0-4"><span class="gp">&gt;&gt;&gt; </span><span class="n">callback</span> <span class="o">=</span> <span class="n">EvaluationCallback</span><span class="p">(</span><span class="n">evaluator</span><span class="p">)</span>
</span></code></pre></div>








                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/formed/integrations/flax/training/callbacks.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">198</span>
<span class="normal">199</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-198"><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evaluator</span><span class="p">:</span> <span class="n">IEvaluator</span><span class="p">[</span><span class="n">ModelInputT</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-199">    <span class="bp">self</span><span class="o">.</span><span class="n">_evaluator</span> <span class="o">=</span> <span class="n">evaluator</span>
</span></code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.training.callbacks.EvaluationCallback.on_eval_start" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">on_eval_start</span>


<a href="#formed.integrations.flax.training.callbacks.EvaluationCallback.on_eval_start" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">on_eval_start</span><span class="p">(</span><span class="n">trainer</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/training/callbacks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-201"><span class="k">def</span><span class="w"> </span><span class="nf">on_eval_start</span><span class="p">(</span>  <span class="c1"># pyright: ignore[reportIncompatibleMethodOverride]</span>
</span><span id="__span-0-202">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-203">    <span class="n">trainer</span><span class="p">:</span> <span class="s2">&quot;FlaxTrainer[ItemT, ModelInputT, ModelOutputT, ModelParamsT]&quot;</span><span class="p">,</span>
</span><span id="__span-0-204">    <span class="n">model</span><span class="p">:</span> <span class="n">BaseFlaxModel</span><span class="p">[</span><span class="n">ModelInputT</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">,</span> <span class="n">ModelParamsT</span><span class="p">],</span>
</span><span id="__span-0-205">    <span class="n">state</span><span class="p">:</span> <span class="n">TrainState</span><span class="p">,</span>
</span><span id="__span-0-206"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IEvaluator</span><span class="p">[</span><span class="n">ModelInputT</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">]:</span>
</span><span id="__span-0-207">    <span class="bp">self</span><span class="o">.</span><span class="n">_evaluator</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</span><span id="__span-0-208">    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluator</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.training.callbacks.EvaluationCallback.on_training_start" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">on_training_start</span>


<a href="#formed.integrations.flax.training.callbacks.EvaluationCallback.on_training_start" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">on_training_start</span><span class="p">(</span><span class="n">trainer</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/training/callbacks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-87"><span class="k">def</span><span class="w"> </span><span class="nf">on_training_start</span><span class="p">(</span>
</span><span id="__span-0-88">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-89">    <span class="n">trainer</span><span class="p">:</span> <span class="s2">&quot;FlaxTrainer[ItemT, ModelInputT, ModelOutputT, ModelParamsT]&quot;</span><span class="p">,</span>
</span><span id="__span-0-90">    <span class="n">model</span><span class="p">:</span> <span class="n">BaseFlaxModel</span><span class="p">[</span><span class="n">ModelInputT</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">,</span> <span class="n">ModelParamsT</span><span class="p">],</span>
</span><span id="__span-0-91">    <span class="n">state</span><span class="p">:</span> <span class="n">TrainState</span><span class="p">,</span>
</span><span id="__span-0-92"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-93">    <span class="k">pass</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.training.callbacks.EvaluationCallback.on_training_end" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">on_training_end</span>


<a href="#formed.integrations.flax.training.callbacks.EvaluationCallback.on_training_end" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">on_training_end</span><span class="p">(</span><span class="n">trainer</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/training/callbacks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-95"><span class="k">def</span><span class="w"> </span><span class="nf">on_training_end</span><span class="p">(</span>
</span><span id="__span-0-96">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-97">    <span class="n">trainer</span><span class="p">:</span> <span class="s2">&quot;FlaxTrainer[ItemT, ModelInputT, ModelOutputT, ModelParamsT]&quot;</span><span class="p">,</span>
</span><span id="__span-0-98">    <span class="n">model</span><span class="p">:</span> <span class="n">BaseFlaxModel</span><span class="p">[</span><span class="n">ModelInputT</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">,</span> <span class="n">ModelParamsT</span><span class="p">],</span>
</span><span id="__span-0-99">    <span class="n">state</span><span class="p">:</span> <span class="n">TrainState</span><span class="p">,</span>
</span><span id="__span-0-100"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TrainState</span><span class="p">:</span>
</span><span id="__span-0-101">    <span class="k">return</span> <span class="n">state</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.training.callbacks.EvaluationCallback.on_epoch_start" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">on_epoch_start</span>


<a href="#formed.integrations.flax.training.callbacks.EvaluationCallback.on_epoch_start" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">on_epoch_start</span><span class="p">(</span><span class="n">trainer</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">epoch</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/training/callbacks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-103"><span class="k">def</span><span class="w"> </span><span class="nf">on_epoch_start</span><span class="p">(</span>
</span><span id="__span-0-104">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-105">    <span class="n">trainer</span><span class="p">:</span> <span class="s2">&quot;FlaxTrainer[ItemT, ModelInputT, ModelOutputT, ModelParamsT]&quot;</span><span class="p">,</span>
</span><span id="__span-0-106">    <span class="n">model</span><span class="p">:</span> <span class="n">BaseFlaxModel</span><span class="p">[</span><span class="n">ModelInputT</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">,</span> <span class="n">ModelParamsT</span><span class="p">],</span>
</span><span id="__span-0-107">    <span class="n">state</span><span class="p">:</span> <span class="n">TrainState</span><span class="p">,</span>
</span><span id="__span-0-108">    <span class="n">epoch</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="__span-0-109"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-110">    <span class="k">pass</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.training.callbacks.EvaluationCallback.on_epoch_end" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">on_epoch_end</span>


<a href="#formed.integrations.flax.training.callbacks.EvaluationCallback.on_epoch_end" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">on_epoch_end</span><span class="p">(</span><span class="n">trainer</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">epoch</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/training/callbacks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-112"><span class="k">def</span><span class="w"> </span><span class="nf">on_epoch_end</span><span class="p">(</span>
</span><span id="__span-0-113">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-114">    <span class="n">trainer</span><span class="p">:</span> <span class="s2">&quot;FlaxTrainer[ItemT, ModelInputT, ModelOutputT, ModelParamsT]&quot;</span><span class="p">,</span>
</span><span id="__span-0-115">    <span class="n">model</span><span class="p">:</span> <span class="n">BaseFlaxModel</span><span class="p">[</span><span class="n">ModelInputT</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">,</span> <span class="n">ModelParamsT</span><span class="p">],</span>
</span><span id="__span-0-116">    <span class="n">state</span><span class="p">:</span> <span class="n">TrainState</span><span class="p">,</span>
</span><span id="__span-0-117">    <span class="n">epoch</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="__span-0-118"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-119">    <span class="k">pass</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.training.callbacks.EvaluationCallback.on_batch_start" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">on_batch_start</span>


<a href="#formed.integrations.flax.training.callbacks.EvaluationCallback.on_batch_start" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">on_batch_start</span><span class="p">(</span><span class="n">trainer</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">epoch</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/training/callbacks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-121"><span class="k">def</span><span class="w"> </span><span class="nf">on_batch_start</span><span class="p">(</span>
</span><span id="__span-0-122">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-123">    <span class="n">trainer</span><span class="p">:</span> <span class="s2">&quot;FlaxTrainer[ItemT, ModelInputT, ModelOutputT, ModelParamsT]&quot;</span><span class="p">,</span>
</span><span id="__span-0-124">    <span class="n">model</span><span class="p">:</span> <span class="n">BaseFlaxModel</span><span class="p">[</span><span class="n">ModelInputT</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">,</span> <span class="n">ModelParamsT</span><span class="p">],</span>
</span><span id="__span-0-125">    <span class="n">state</span><span class="p">:</span> <span class="n">TrainState</span><span class="p">,</span>
</span><span id="__span-0-126">    <span class="n">epoch</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="__span-0-127"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-128">    <span class="k">pass</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.training.callbacks.EvaluationCallback.on_batch_end" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">on_batch_end</span>


<a href="#formed.integrations.flax.training.callbacks.EvaluationCallback.on_batch_end" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">on_batch_end</span><span class="p">(</span><span class="n">trainer</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">epoch</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/training/callbacks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-130"><span class="k">def</span><span class="w"> </span><span class="nf">on_batch_end</span><span class="p">(</span>
</span><span id="__span-0-131">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-132">    <span class="n">trainer</span><span class="p">:</span> <span class="s2">&quot;FlaxTrainer[ItemT, ModelInputT, ModelOutputT, ModelParamsT]&quot;</span><span class="p">,</span>
</span><span id="__span-0-133">    <span class="n">model</span><span class="p">:</span> <span class="n">BaseFlaxModel</span><span class="p">[</span><span class="n">ModelInputT</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">,</span> <span class="n">ModelParamsT</span><span class="p">],</span>
</span><span id="__span-0-134">    <span class="n">state</span><span class="p">:</span> <span class="n">TrainState</span><span class="p">,</span>
</span><span id="__span-0-135">    <span class="n">epoch</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="__span-0-136">    <span class="n">output</span><span class="p">:</span> <span class="n">ModelOutputT</span><span class="p">,</span>
</span><span id="__span-0-137"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-138">    <span class="k">pass</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.training.callbacks.EvaluationCallback.on_eval_end" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">on_eval_end</span>


<a href="#formed.integrations.flax.training.callbacks.EvaluationCallback.on_eval_end" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">on_eval_end</span><span class="p">(</span><span class="n">trainer</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">metrics</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/training/callbacks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-158"><span class="k">def</span><span class="w"> </span><span class="nf">on_eval_end</span><span class="p">(</span>
</span><span id="__span-0-159">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-160">    <span class="n">trainer</span><span class="p">:</span> <span class="s2">&quot;FlaxTrainer[ItemT, ModelInputT, ModelOutputT, ModelParamsT]&quot;</span><span class="p">,</span>
</span><span id="__span-0-161">    <span class="n">model</span><span class="p">:</span> <span class="n">BaseFlaxModel</span><span class="p">[</span><span class="n">ModelInputT</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">,</span> <span class="n">ModelParamsT</span><span class="p">],</span>
</span><span id="__span-0-162">    <span class="n">state</span><span class="p">:</span> <span class="n">TrainState</span><span class="p">,</span>
</span><span id="__span-0-163">    <span class="n">metrics</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
</span><span id="__span-0-164">    <span class="n">prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="__span-0-165"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-166">    <span class="k">pass</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.training.callbacks.EvaluationCallback.on_log" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">on_log</span>


<a href="#formed.integrations.flax.training.callbacks.EvaluationCallback.on_log" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">on_log</span><span class="p">(</span><span class="n">trainer</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">metrics</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/training/callbacks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-168"><span class="k">def</span><span class="w"> </span><span class="nf">on_log</span><span class="p">(</span>
</span><span id="__span-0-169">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-170">    <span class="n">trainer</span><span class="p">:</span> <span class="s2">&quot;FlaxTrainer[ItemT, ModelInputT, ModelOutputT, ModelParamsT]&quot;</span><span class="p">,</span>
</span><span id="__span-0-171">    <span class="n">model</span><span class="p">:</span> <span class="n">BaseFlaxModel</span><span class="p">[</span><span class="n">ModelInputT</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">,</span> <span class="n">ModelParamsT</span><span class="p">],</span>
</span><span id="__span-0-172">    <span class="n">state</span><span class="p">:</span> <span class="n">TrainState</span><span class="p">,</span>
</span><span id="__span-0-173">    <span class="n">metrics</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
</span><span id="__span-0-174">    <span class="n">prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="__span-0-175"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-176">    <span class="k">pass</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="formed.integrations.flax.training.callbacks.EarlyStoppingCallback" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">EarlyStoppingCallback</span>


<a href="#formed.integrations.flax.training.callbacks.EarlyStoppingCallback" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">EarlyStoppingCallback</span><span class="p">(</span><span class="n">patience</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;-loss&#39;</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;FlaxTrainingCallback&lt;/span&gt; (&lt;code&gt;formed.integrations.flax.training.callbacks.FlaxTrainingCallback&lt;/code&gt;)" href="#formed.integrations.flax.training.callbacks.FlaxTrainingCallback">FlaxTrainingCallback</a></code></p>



        <p>Callback for early stopping based on metric improvements.</p>
<p>This callback monitors a specified metric and stops training if it
doesn't improve for a given number of evaluations (patience). The
best model is automatically saved and restored at the end of training.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>patience</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Number of evaluations without improvement before stopping.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="int">int</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>5</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>metric</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Metric to monitor. Prefix with "-" to maximize (e.g., "-loss"),
or "+" to minimize (e.g., "+error"). Default is "-loss".</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="str">str</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;-loss&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span id="__span-0-1"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Stop if validation loss doesn&#39;t improve for 5 evaluations</span>
</span><span id="__span-0-2"><span class="gp">&gt;&gt;&gt; </span><span class="n">callback</span> <span class="o">=</span> <span class="n">EarlyStoppingCallback</span><span class="p">(</span><span class="n">patience</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;-val/loss&quot;</span><span class="p">)</span>
</span><span id="__span-0-3"><span class="gp">&gt;&gt;&gt;</span>
</span><span id="__span-0-4"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Stop if accuracy doesn&#39;t improve for 3 evaluations</span>
</span><span id="__span-0-5"><span class="gp">&gt;&gt;&gt; </span><span class="n">callback</span> <span class="o">=</span> <span class="n">EarlyStoppingCallback</span><span class="p">(</span><span class="n">patience</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;+accuracy&quot;</span><span class="p">)</span>
</span></code></pre></div>


<details class="note" open>
  <summary>Note</summary>
  <p>The best model is saved to the step working directory and
automatically restored when training ends early or completes.</p>
</details>







                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/formed/integrations/flax/training/callbacks.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-237"><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="__span-0-238">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-239">    <span class="n">patience</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
</span><span id="__span-0-240">    <span class="n">metric</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;-loss&quot;</span><span class="p">,</span>
</span><span id="__span-0-241"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-242">    <span class="bp">self</span><span class="o">.</span><span class="n">_patience</span> <span class="o">=</span> <span class="n">patience</span>
</span><span id="__span-0-243">    <span class="bp">self</span><span class="o">.</span><span class="n">_metric</span> <span class="o">=</span> <span class="n">metric</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;-+&quot;</span><span class="p">)</span>
</span><span id="__span-0-244">    <span class="bp">self</span><span class="o">.</span><span class="n">_direction</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">metric</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="mi">1</span>
</span><span id="__span-0-245">    <span class="bp">self</span><span class="o">.</span><span class="n">_best_metric</span> <span class="o">=</span> <span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>
</span><span id="__span-0-246">    <span class="bp">self</span><span class="o">.</span><span class="n">_best_step</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-247">    <span class="bp">self</span><span class="o">.</span><span class="n">_counter</span> <span class="o">=</span> <span class="mi">0</span>
</span></code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.training.callbacks.EarlyStoppingCallback.on_training_start" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">on_training_start</span>


<a href="#formed.integrations.flax.training.callbacks.EarlyStoppingCallback.on_training_start" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">on_training_start</span><span class="p">(</span><span class="n">trainer</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/training/callbacks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-262"><span class="k">def</span><span class="w"> </span><span class="nf">on_training_start</span><span class="p">(</span>
</span><span id="__span-0-263">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-264">    <span class="n">trainer</span><span class="p">:</span> <span class="s2">&quot;FlaxTrainer[ItemT, ModelInputT, ModelOutputT, ModelParamsT]&quot;</span><span class="p">,</span>
</span><span id="__span-0-265">    <span class="n">model</span><span class="p">:</span> <span class="n">BaseFlaxModel</span><span class="p">[</span><span class="n">ModelInputT</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">,</span> <span class="n">ModelParamsT</span><span class="p">],</span>
</span><span id="__span-0-266">    <span class="n">state</span><span class="p">:</span> <span class="n">TrainState</span><span class="p">,</span>
</span><span id="__span-0-267"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-268">    <span class="bp">self</span><span class="o">.</span><span class="n">_best_metric</span> <span class="o">=</span> <span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>
</span><span id="__span-0-269">    <span class="bp">self</span><span class="o">.</span><span class="n">_counter</span> <span class="o">=</span> <span class="mi">0</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.training.callbacks.EarlyStoppingCallback.on_eval_end" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">on_eval_end</span>


<a href="#formed.integrations.flax.training.callbacks.EarlyStoppingCallback.on_eval_end" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">on_eval_end</span><span class="p">(</span><span class="n">trainer</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">metrics</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/training/callbacks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-271"><span class="k">def</span><span class="w"> </span><span class="nf">on_eval_end</span><span class="p">(</span>
</span><span id="__span-0-272">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-273">    <span class="n">trainer</span><span class="p">:</span> <span class="s2">&quot;FlaxTrainer[ItemT, ModelInputT, ModelOutputT, ModelParamsT]&quot;</span><span class="p">,</span>
</span><span id="__span-0-274">    <span class="n">model</span><span class="p">:</span> <span class="n">BaseFlaxModel</span><span class="p">[</span><span class="n">ModelInputT</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">,</span> <span class="n">ModelParamsT</span><span class="p">],</span>
</span><span id="__span-0-275">    <span class="n">state</span><span class="p">:</span> <span class="n">TrainState</span><span class="p">,</span>
</span><span id="__span-0-276">    <span class="n">metrics</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
</span><span id="__span-0-277">    <span class="n">prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="__span-0-278"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-279">    <span class="n">logger</span> <span class="o">=</span> <span class="n">use_step_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="__span-0-280">    <span class="k">if</span> <span class="n">prefix</span><span class="p">:</span>
</span><span id="__span-0-281">        <span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">value</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">metrics</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="__span-0-282">    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-283">        <span class="n">metric</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_direction</span> <span class="o">*</span> <span class="n">metrics</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_metric</span><span class="p">]</span>
</span><span id="__span-0-284">    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="__span-0-285">        <span class="k">return</span>
</span><span id="__span-0-286">
</span><span id="__span-0-287">    <span class="k">if</span> <span class="n">metric</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_best_metric</span><span class="p">:</span>
</span><span id="__span-0-288">        <span class="bp">self</span><span class="o">.</span><span class="n">_best_metric</span> <span class="o">=</span> <span class="n">metric</span>
</span><span id="__span-0-289">        <span class="bp">self</span><span class="o">.</span><span class="n">_best_step</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">step</span><span class="p">)</span>
</span><span id="__span-0-290">        <span class="bp">self</span><span class="o">.</span><span class="n">_counter</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-0-291">        <span class="bp">self</span><span class="o">.</span><span class="n">_checkpointer</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">step</span><span class="p">),</span> <span class="n">state</span><span class="p">)</span>
</span><span id="__span-0-292">        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;New best model saved with </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_metric</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_best_metric</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-0-293">    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-294">        <span class="bp">self</span><span class="o">.</span><span class="n">_counter</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-0-295">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_counter</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_patience</span><span class="p">:</span>
</span><span id="__span-0-296">            <span class="k">raise</span> <span class="n">StopEarly</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.training.callbacks.EarlyStoppingCallback.on_training_end" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">on_training_end</span>


<a href="#formed.integrations.flax.training.callbacks.EarlyStoppingCallback.on_training_end" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">on_training_end</span><span class="p">(</span><span class="n">trainer</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/training/callbacks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-298"><span class="k">def</span><span class="w"> </span><span class="nf">on_training_end</span><span class="p">(</span>
</span><span id="__span-0-299">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-300">    <span class="n">trainer</span><span class="p">:</span> <span class="s2">&quot;FlaxTrainer[ItemT, ModelInputT, ModelOutputT, ModelParamsT]&quot;</span><span class="p">,</span>
</span><span id="__span-0-301">    <span class="n">model</span><span class="p">:</span> <span class="n">BaseFlaxModel</span><span class="p">[</span><span class="n">ModelInputT</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">,</span> <span class="n">ModelParamsT</span><span class="p">],</span>
</span><span id="__span-0-302">    <span class="n">state</span><span class="p">:</span> <span class="n">TrainState</span><span class="p">,</span>
</span><span id="__span-0-303"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TrainState</span><span class="p">:</span>
</span><span id="__span-0-304">    <span class="n">logger</span> <span class="o">=</span> <span class="n">use_step_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="__span-0-305">    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_best_step</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-306">        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Restoring best state from early stopping checkpoint.&quot;</span><span class="p">)</span>
</span><span id="__span-0-307">        <span class="n">state</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">TrainState</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkpointer</span><span class="o">.</span><span class="n">restore</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_best_step</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="n">state</span><span class="p">))</span>
</span><span id="__span-0-308">    <span class="k">return</span> <span class="n">state</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.training.callbacks.EarlyStoppingCallback.on_epoch_start" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">on_epoch_start</span>


<a href="#formed.integrations.flax.training.callbacks.EarlyStoppingCallback.on_epoch_start" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">on_epoch_start</span><span class="p">(</span><span class="n">trainer</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">epoch</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/training/callbacks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-103"><span class="k">def</span><span class="w"> </span><span class="nf">on_epoch_start</span><span class="p">(</span>
</span><span id="__span-0-104">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-105">    <span class="n">trainer</span><span class="p">:</span> <span class="s2">&quot;FlaxTrainer[ItemT, ModelInputT, ModelOutputT, ModelParamsT]&quot;</span><span class="p">,</span>
</span><span id="__span-0-106">    <span class="n">model</span><span class="p">:</span> <span class="n">BaseFlaxModel</span><span class="p">[</span><span class="n">ModelInputT</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">,</span> <span class="n">ModelParamsT</span><span class="p">],</span>
</span><span id="__span-0-107">    <span class="n">state</span><span class="p">:</span> <span class="n">TrainState</span><span class="p">,</span>
</span><span id="__span-0-108">    <span class="n">epoch</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="__span-0-109"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-110">    <span class="k">pass</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.training.callbacks.EarlyStoppingCallback.on_epoch_end" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">on_epoch_end</span>


<a href="#formed.integrations.flax.training.callbacks.EarlyStoppingCallback.on_epoch_end" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">on_epoch_end</span><span class="p">(</span><span class="n">trainer</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">epoch</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/training/callbacks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-112"><span class="k">def</span><span class="w"> </span><span class="nf">on_epoch_end</span><span class="p">(</span>
</span><span id="__span-0-113">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-114">    <span class="n">trainer</span><span class="p">:</span> <span class="s2">&quot;FlaxTrainer[ItemT, ModelInputT, ModelOutputT, ModelParamsT]&quot;</span><span class="p">,</span>
</span><span id="__span-0-115">    <span class="n">model</span><span class="p">:</span> <span class="n">BaseFlaxModel</span><span class="p">[</span><span class="n">ModelInputT</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">,</span> <span class="n">ModelParamsT</span><span class="p">],</span>
</span><span id="__span-0-116">    <span class="n">state</span><span class="p">:</span> <span class="n">TrainState</span><span class="p">,</span>
</span><span id="__span-0-117">    <span class="n">epoch</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="__span-0-118"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-119">    <span class="k">pass</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.training.callbacks.EarlyStoppingCallback.on_batch_start" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">on_batch_start</span>


<a href="#formed.integrations.flax.training.callbacks.EarlyStoppingCallback.on_batch_start" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">on_batch_start</span><span class="p">(</span><span class="n">trainer</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">epoch</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/training/callbacks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-121"><span class="k">def</span><span class="w"> </span><span class="nf">on_batch_start</span><span class="p">(</span>
</span><span id="__span-0-122">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-123">    <span class="n">trainer</span><span class="p">:</span> <span class="s2">&quot;FlaxTrainer[ItemT, ModelInputT, ModelOutputT, ModelParamsT]&quot;</span><span class="p">,</span>
</span><span id="__span-0-124">    <span class="n">model</span><span class="p">:</span> <span class="n">BaseFlaxModel</span><span class="p">[</span><span class="n">ModelInputT</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">,</span> <span class="n">ModelParamsT</span><span class="p">],</span>
</span><span id="__span-0-125">    <span class="n">state</span><span class="p">:</span> <span class="n">TrainState</span><span class="p">,</span>
</span><span id="__span-0-126">    <span class="n">epoch</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="__span-0-127"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-128">    <span class="k">pass</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.training.callbacks.EarlyStoppingCallback.on_batch_end" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">on_batch_end</span>


<a href="#formed.integrations.flax.training.callbacks.EarlyStoppingCallback.on_batch_end" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">on_batch_end</span><span class="p">(</span><span class="n">trainer</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">epoch</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/training/callbacks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-130"><span class="k">def</span><span class="w"> </span><span class="nf">on_batch_end</span><span class="p">(</span>
</span><span id="__span-0-131">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-132">    <span class="n">trainer</span><span class="p">:</span> <span class="s2">&quot;FlaxTrainer[ItemT, ModelInputT, ModelOutputT, ModelParamsT]&quot;</span><span class="p">,</span>
</span><span id="__span-0-133">    <span class="n">model</span><span class="p">:</span> <span class="n">BaseFlaxModel</span><span class="p">[</span><span class="n">ModelInputT</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">,</span> <span class="n">ModelParamsT</span><span class="p">],</span>
</span><span id="__span-0-134">    <span class="n">state</span><span class="p">:</span> <span class="n">TrainState</span><span class="p">,</span>
</span><span id="__span-0-135">    <span class="n">epoch</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="__span-0-136">    <span class="n">output</span><span class="p">:</span> <span class="n">ModelOutputT</span><span class="p">,</span>
</span><span id="__span-0-137"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-138">    <span class="k">pass</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.training.callbacks.EarlyStoppingCallback.on_eval_start" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">on_eval_start</span>


<a href="#formed.integrations.flax.training.callbacks.EarlyStoppingCallback.on_eval_start" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">on_eval_start</span><span class="p">(</span><span class="n">trainer</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/training/callbacks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-140"><span class="k">def</span><span class="w"> </span><span class="nf">on_eval_start</span><span class="p">(</span>
</span><span id="__span-0-141">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-142">    <span class="n">trainer</span><span class="p">:</span> <span class="s2">&quot;FlaxTrainer[ItemT, ModelInputT, ModelOutputT, ModelParamsT]&quot;</span><span class="p">,</span>
</span><span id="__span-0-143">    <span class="n">model</span><span class="p">:</span> <span class="n">BaseFlaxModel</span><span class="p">[</span><span class="n">ModelInputT</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">,</span> <span class="n">ModelParamsT</span><span class="p">],</span>
</span><span id="__span-0-144">    <span class="n">state</span><span class="p">:</span> <span class="n">TrainState</span><span class="p">,</span>
</span><span id="__span-0-145"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IEvaluator</span><span class="p">[</span><span class="n">ModelInputT</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">]:</span>
</span><span id="__span-0-146">    <span class="k">class</span><span class="w"> </span><span class="nc">DummyMetric</span><span class="p">(</span><span class="n">IEvaluator</span><span class="p">):</span>
</span><span id="__span-0-147">        <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-148">            <span class="k">pass</span>
</span><span id="__span-0-149">
</span><span id="__span-0-150">        <span class="k">def</span><span class="w"> </span><span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
</span><span id="__span-0-151">            <span class="k">return</span> <span class="p">{}</span>
</span><span id="__span-0-152">
</span><span id="__span-0-153">        <span class="k">def</span><span class="w"> </span><span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-154">            <span class="k">pass</span>
</span><span id="__span-0-155">
</span><span id="__span-0-156">    <span class="k">return</span> <span class="n">DummyMetric</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.training.callbacks.EarlyStoppingCallback.on_log" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">on_log</span>


<a href="#formed.integrations.flax.training.callbacks.EarlyStoppingCallback.on_log" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">on_log</span><span class="p">(</span><span class="n">trainer</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">metrics</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/training/callbacks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-168"><span class="k">def</span><span class="w"> </span><span class="nf">on_log</span><span class="p">(</span>
</span><span id="__span-0-169">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-170">    <span class="n">trainer</span><span class="p">:</span> <span class="s2">&quot;FlaxTrainer[ItemT, ModelInputT, ModelOutputT, ModelParamsT]&quot;</span><span class="p">,</span>
</span><span id="__span-0-171">    <span class="n">model</span><span class="p">:</span> <span class="n">BaseFlaxModel</span><span class="p">[</span><span class="n">ModelInputT</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">,</span> <span class="n">ModelParamsT</span><span class="p">],</span>
</span><span id="__span-0-172">    <span class="n">state</span><span class="p">:</span> <span class="n">TrainState</span><span class="p">,</span>
</span><span id="__span-0-173">    <span class="n">metrics</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
</span><span id="__span-0-174">    <span class="n">prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="__span-0-175"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-176">    <span class="k">pass</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="formed.integrations.flax.training.callbacks.MlflowCallback" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">MlflowCallback</span>


<a href="#formed.integrations.flax.training.callbacks.MlflowCallback" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">MlflowCallback</span><span class="p">()</span>
</span></code></pre></div>

    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;FlaxTrainingCallback&lt;/span&gt; (&lt;code&gt;formed.integrations.flax.training.callbacks.FlaxTrainingCallback&lt;/code&gt;)" href="#formed.integrations.flax.training.callbacks.FlaxTrainingCallback">FlaxTrainingCallback</a></code></p>



        <p>Callback for logging metrics to MLflow.</p>
<p>This callback automatically logs training and validation metrics to
MLflow when used within a workflow step that has MLflow tracking enabled.</p>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span id="__span-0-1"><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">formed.integrations.flax</span><span class="w"> </span><span class="kn">import</span> <span class="n">FlaxTrainer</span><span class="p">,</span> <span class="n">MlflowCallback</span>
</span><span id="__span-0-2"><span class="gp">&gt;&gt;&gt;</span>
</span><span id="__span-0-3"><span class="gp">&gt;&gt;&gt; </span><span class="n">trainer</span> <span class="o">=</span> <span class="n">FlaxTrainer</span><span class="p">(</span>
</span><span id="__span-0-4"><span class="gp">... </span>    <span class="n">train_dataloader</span><span class="o">=</span><span class="n">train_loader</span><span class="p">,</span>
</span><span id="__span-0-5"><span class="gp">... </span>    <span class="n">val_dataloader</span><span class="o">=</span><span class="n">val_loader</span><span class="p">,</span>
</span><span id="__span-0-6"><span class="gp">... </span>    <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">MlflowCallback</span><span class="p">()]</span>
</span><span id="__span-0-7"><span class="gp">... </span><span class="p">)</span>
</span></code></pre></div>


<details class="note" open>
  <summary>Note</summary>
  <p>Requires the formed mlflow integration and must be used within
a workflow step with MLflow tracking configured.</p>
</details>







                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/formed/integrations/flax/training/callbacks.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-333"><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-334">    <span class="kn">from</span><span class="w"> </span><span class="nn">formed.integrations.mlflow.workflow</span><span class="w"> </span><span class="kn">import</span> <span class="n">MlflowLogger</span>
</span><span id="__span-0-335">
</span><span id="__span-0-336">    <span class="bp">self</span><span class="o">.</span><span class="n">_mlflow_logger</span><span class="p">:</span> <span class="n">MlflowLogger</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span></code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.training.callbacks.MlflowCallback.on_training_start" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">on_training_start</span>


<a href="#formed.integrations.flax.training.callbacks.MlflowCallback.on_training_start" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">on_training_start</span><span class="p">(</span><span class="n">trainer</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/training/callbacks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-338"><span class="k">def</span><span class="w"> </span><span class="nf">on_training_start</span><span class="p">(</span>
</span><span id="__span-0-339">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-340">    <span class="n">trainer</span><span class="p">:</span> <span class="s2">&quot;FlaxTrainer[ItemT, ModelInputT, ModelOutputT, ModelParamsT]&quot;</span><span class="p">,</span>
</span><span id="__span-0-341">    <span class="n">model</span><span class="p">:</span> <span class="n">BaseFlaxModel</span><span class="p">[</span><span class="n">ModelInputT</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">,</span> <span class="n">ModelParamsT</span><span class="p">],</span>
</span><span id="__span-0-342">    <span class="n">state</span><span class="p">:</span> <span class="n">TrainState</span><span class="p">,</span>
</span><span id="__span-0-343"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-344">    <span class="kn">from</span><span class="w"> </span><span class="nn">formed.integrations.mlflow.workflow</span><span class="w"> </span><span class="kn">import</span> <span class="n">use_mlflow_logger</span>
</span><span id="__span-0-345">    <span class="kn">from</span><span class="w"> </span><span class="nn">formed.workflow</span><span class="w"> </span><span class="kn">import</span> <span class="n">use_step_logger</span>
</span><span id="__span-0-346">
</span><span id="__span-0-347">    <span class="n">logger</span> <span class="o">=</span> <span class="n">use_step_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="__span-0-348">
</span><span id="__span-0-349">    <span class="bp">self</span><span class="o">.</span><span class="n">_mlflow_logger</span> <span class="o">=</span> <span class="n">use_mlflow_logger</span><span class="p">()</span>
</span><span id="__span-0-350">    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mlflow_logger</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-351">        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;MlflowLogger not found. Skipping logging.&quot;</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.training.callbacks.MlflowCallback.on_log" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">on_log</span>


<a href="#formed.integrations.flax.training.callbacks.MlflowCallback.on_log" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">on_log</span><span class="p">(</span><span class="n">trainer</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">metrics</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/training/callbacks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-353"><span class="k">def</span><span class="w"> </span><span class="nf">on_log</span><span class="p">(</span>
</span><span id="__span-0-354">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-355">    <span class="n">trainer</span><span class="p">:</span> <span class="s2">&quot;FlaxTrainer[ItemT, ModelInputT, ModelOutputT, ModelParamsT]&quot;</span><span class="p">,</span>
</span><span id="__span-0-356">    <span class="n">model</span><span class="p">:</span> <span class="n">BaseFlaxModel</span><span class="p">[</span><span class="n">ModelInputT</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">,</span> <span class="n">ModelParamsT</span><span class="p">],</span>
</span><span id="__span-0-357">    <span class="n">state</span><span class="p">:</span> <span class="n">TrainState</span><span class="p">,</span>
</span><span id="__span-0-358">    <span class="n">metrics</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
</span><span id="__span-0-359">    <span class="n">prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="__span-0-360"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-361">    <span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span><span class="n">prefix</span> <span class="o">+</span> <span class="n">key</span><span class="p">:</span> <span class="n">value</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">metrics</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="__span-0-362">    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mlflow_logger</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-363">        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">metrics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="__span-0-364">            <span class="bp">self</span><span class="o">.</span><span class="n">_mlflow_logger</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">step</span><span class="p">))</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.training.callbacks.MlflowCallback.on_epoch_end" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">on_epoch_end</span>


<a href="#formed.integrations.flax.training.callbacks.MlflowCallback.on_epoch_end" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">on_epoch_end</span><span class="p">(</span><span class="n">trainer</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">epoch</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/training/callbacks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-366"><span class="k">def</span><span class="w"> </span><span class="nf">on_epoch_end</span><span class="p">(</span>
</span><span id="__span-0-367">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-368">    <span class="n">trainer</span><span class="p">:</span> <span class="s2">&quot;FlaxTrainer[ItemT, ModelInputT, ModelOutputT, ModelParamsT]&quot;</span><span class="p">,</span>
</span><span id="__span-0-369">    <span class="n">model</span><span class="p">:</span> <span class="n">BaseFlaxModel</span><span class="p">[</span><span class="n">ModelInputT</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">,</span> <span class="n">ModelParamsT</span><span class="p">],</span>
</span><span id="__span-0-370">    <span class="n">state</span><span class="p">:</span> <span class="n">TrainState</span><span class="p">,</span>
</span><span id="__span-0-371">    <span class="n">epoch</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="__span-0-372"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-373">    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mlflow_logger</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-374">        <span class="bp">self</span><span class="o">.</span><span class="n">_mlflow_logger</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;epoch&quot;</span><span class="p">,</span> <span class="n">epoch</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">step</span><span class="p">))</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.training.callbacks.MlflowCallback.on_training_end" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">on_training_end</span>


<a href="#formed.integrations.flax.training.callbacks.MlflowCallback.on_training_end" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">on_training_end</span><span class="p">(</span><span class="n">trainer</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/training/callbacks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-95"><span class="k">def</span><span class="w"> </span><span class="nf">on_training_end</span><span class="p">(</span>
</span><span id="__span-0-96">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-97">    <span class="n">trainer</span><span class="p">:</span> <span class="s2">&quot;FlaxTrainer[ItemT, ModelInputT, ModelOutputT, ModelParamsT]&quot;</span><span class="p">,</span>
</span><span id="__span-0-98">    <span class="n">model</span><span class="p">:</span> <span class="n">BaseFlaxModel</span><span class="p">[</span><span class="n">ModelInputT</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">,</span> <span class="n">ModelParamsT</span><span class="p">],</span>
</span><span id="__span-0-99">    <span class="n">state</span><span class="p">:</span> <span class="n">TrainState</span><span class="p">,</span>
</span><span id="__span-0-100"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TrainState</span><span class="p">:</span>
</span><span id="__span-0-101">    <span class="k">return</span> <span class="n">state</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.training.callbacks.MlflowCallback.on_epoch_start" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">on_epoch_start</span>


<a href="#formed.integrations.flax.training.callbacks.MlflowCallback.on_epoch_start" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">on_epoch_start</span><span class="p">(</span><span class="n">trainer</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">epoch</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/training/callbacks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-103"><span class="k">def</span><span class="w"> </span><span class="nf">on_epoch_start</span><span class="p">(</span>
</span><span id="__span-0-104">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-105">    <span class="n">trainer</span><span class="p">:</span> <span class="s2">&quot;FlaxTrainer[ItemT, ModelInputT, ModelOutputT, ModelParamsT]&quot;</span><span class="p">,</span>
</span><span id="__span-0-106">    <span class="n">model</span><span class="p">:</span> <span class="n">BaseFlaxModel</span><span class="p">[</span><span class="n">ModelInputT</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">,</span> <span class="n">ModelParamsT</span><span class="p">],</span>
</span><span id="__span-0-107">    <span class="n">state</span><span class="p">:</span> <span class="n">TrainState</span><span class="p">,</span>
</span><span id="__span-0-108">    <span class="n">epoch</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="__span-0-109"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-110">    <span class="k">pass</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.training.callbacks.MlflowCallback.on_batch_start" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">on_batch_start</span>


<a href="#formed.integrations.flax.training.callbacks.MlflowCallback.on_batch_start" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">on_batch_start</span><span class="p">(</span><span class="n">trainer</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">epoch</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/training/callbacks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-121"><span class="k">def</span><span class="w"> </span><span class="nf">on_batch_start</span><span class="p">(</span>
</span><span id="__span-0-122">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-123">    <span class="n">trainer</span><span class="p">:</span> <span class="s2">&quot;FlaxTrainer[ItemT, ModelInputT, ModelOutputT, ModelParamsT]&quot;</span><span class="p">,</span>
</span><span id="__span-0-124">    <span class="n">model</span><span class="p">:</span> <span class="n">BaseFlaxModel</span><span class="p">[</span><span class="n">ModelInputT</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">,</span> <span class="n">ModelParamsT</span><span class="p">],</span>
</span><span id="__span-0-125">    <span class="n">state</span><span class="p">:</span> <span class="n">TrainState</span><span class="p">,</span>
</span><span id="__span-0-126">    <span class="n">epoch</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="__span-0-127"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-128">    <span class="k">pass</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.training.callbacks.MlflowCallback.on_batch_end" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">on_batch_end</span>


<a href="#formed.integrations.flax.training.callbacks.MlflowCallback.on_batch_end" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">on_batch_end</span><span class="p">(</span><span class="n">trainer</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">epoch</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/training/callbacks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-130"><span class="k">def</span><span class="w"> </span><span class="nf">on_batch_end</span><span class="p">(</span>
</span><span id="__span-0-131">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-132">    <span class="n">trainer</span><span class="p">:</span> <span class="s2">&quot;FlaxTrainer[ItemT, ModelInputT, ModelOutputT, ModelParamsT]&quot;</span><span class="p">,</span>
</span><span id="__span-0-133">    <span class="n">model</span><span class="p">:</span> <span class="n">BaseFlaxModel</span><span class="p">[</span><span class="n">ModelInputT</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">,</span> <span class="n">ModelParamsT</span><span class="p">],</span>
</span><span id="__span-0-134">    <span class="n">state</span><span class="p">:</span> <span class="n">TrainState</span><span class="p">,</span>
</span><span id="__span-0-135">    <span class="n">epoch</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="__span-0-136">    <span class="n">output</span><span class="p">:</span> <span class="n">ModelOutputT</span><span class="p">,</span>
</span><span id="__span-0-137"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-138">    <span class="k">pass</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.training.callbacks.MlflowCallback.on_eval_start" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">on_eval_start</span>


<a href="#formed.integrations.flax.training.callbacks.MlflowCallback.on_eval_start" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">on_eval_start</span><span class="p">(</span><span class="n">trainer</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/training/callbacks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-140"><span class="k">def</span><span class="w"> </span><span class="nf">on_eval_start</span><span class="p">(</span>
</span><span id="__span-0-141">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-142">    <span class="n">trainer</span><span class="p">:</span> <span class="s2">&quot;FlaxTrainer[ItemT, ModelInputT, ModelOutputT, ModelParamsT]&quot;</span><span class="p">,</span>
</span><span id="__span-0-143">    <span class="n">model</span><span class="p">:</span> <span class="n">BaseFlaxModel</span><span class="p">[</span><span class="n">ModelInputT</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">,</span> <span class="n">ModelParamsT</span><span class="p">],</span>
</span><span id="__span-0-144">    <span class="n">state</span><span class="p">:</span> <span class="n">TrainState</span><span class="p">,</span>
</span><span id="__span-0-145"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IEvaluator</span><span class="p">[</span><span class="n">ModelInputT</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">]:</span>
</span><span id="__span-0-146">    <span class="k">class</span><span class="w"> </span><span class="nc">DummyMetric</span><span class="p">(</span><span class="n">IEvaluator</span><span class="p">):</span>
</span><span id="__span-0-147">        <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-148">            <span class="k">pass</span>
</span><span id="__span-0-149">
</span><span id="__span-0-150">        <span class="k">def</span><span class="w"> </span><span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
</span><span id="__span-0-151">            <span class="k">return</span> <span class="p">{}</span>
</span><span id="__span-0-152">
</span><span id="__span-0-153">        <span class="k">def</span><span class="w"> </span><span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-154">            <span class="k">pass</span>
</span><span id="__span-0-155">
</span><span id="__span-0-156">    <span class="k">return</span> <span class="n">DummyMetric</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.training.callbacks.MlflowCallback.on_eval_end" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">on_eval_end</span>


<a href="#formed.integrations.flax.training.callbacks.MlflowCallback.on_eval_end" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">on_eval_end</span><span class="p">(</span><span class="n">trainer</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">metrics</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/training/callbacks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-158"><span class="k">def</span><span class="w"> </span><span class="nf">on_eval_end</span><span class="p">(</span>
</span><span id="__span-0-159">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-160">    <span class="n">trainer</span><span class="p">:</span> <span class="s2">&quot;FlaxTrainer[ItemT, ModelInputT, ModelOutputT, ModelParamsT]&quot;</span><span class="p">,</span>
</span><span id="__span-0-161">    <span class="n">model</span><span class="p">:</span> <span class="n">BaseFlaxModel</span><span class="p">[</span><span class="n">ModelInputT</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">,</span> <span class="n">ModelParamsT</span><span class="p">],</span>
</span><span id="__span-0-162">    <span class="n">state</span><span class="p">:</span> <span class="n">TrainState</span><span class="p">,</span>
</span><span id="__span-0-163">    <span class="n">metrics</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
</span><span id="__span-0-164">    <span class="n">prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="__span-0-165"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-166">    <span class="k">pass</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="formed.integrations.flax.training.engine" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">formed.integrations.flax.training.engine</span>


<a href="#formed.integrations.flax.training.engine" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

        <p>Training engine abstractions for Flax models.</p>
<p>This module provides the training engine abstraction that defines how
models are trained and evaluated. Engines handle loss computation,
gradient calculation, and parameter updates.</p>


<details class="key-components" open>
  <summary>Key Components</summary>
  <ul>
<li>FlaxTrainingEngine: Abstract base class for training engines</li>
<li>DefaultFlaxTrainingEngine: Default implementation with automatic differentiation</li>
</ul>
</details>

<details class="features" open>
  <summary>Features</summary>
  <ul>
<li>Customizable loss functions</li>
<li>Automatic gradient computation using JAX</li>
<li>State creation and management</li>
<li>Separate train and eval steps</li>
<li>Compatible with FlaxTrainer and distributors</li>
</ul>
</details>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span id="__span-0-1"><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">formed.integrations.flax</span><span class="w"> </span><span class="kn">import</span> <span class="n">DefaultFlaxTrainingEngine</span>
</span><span id="__span-0-2"><span class="gp">&gt;&gt;&gt;</span>
</span><span id="__span-0-3"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Create engine with custom loss accessor</span>
</span><span id="__span-0-4"><span class="gp">&gt;&gt;&gt; </span><span class="n">engine</span> <span class="o">=</span> <span class="n">DefaultFlaxTrainingEngine</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s2">&quot;total_loss&quot;</span><span class="p">)</span>
</span><span id="__span-0-5"><span class="gp">&gt;&gt;&gt;</span>
</span><span id="__span-0-6"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Or with custom loss function</span>
</span><span id="__span-0-7"><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span><span class="w"> </span><span class="nf">custom_loss</span><span class="p">(</span><span class="n">output</span><span class="p">):</span>
</span><span id="__span-0-8"><span class="gp">... </span>    <span class="k">return</span> <span class="n">output</span><span class="o">.</span><span class="n">loss</span> <span class="o">+</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">output</span><span class="o">.</span><span class="n">regularization</span>
</span><span id="__span-0-9"><span class="gp">&gt;&gt;&gt; </span><span class="n">engine</span> <span class="o">=</span> <span class="n">DefaultFlaxTrainingEngine</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="n">custom_loss</span><span class="p">)</span>
</span></code></pre></div>










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h3 id="formed.integrations.flax.training.engine.FlaxTrainingEngine" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">FlaxTrainingEngine</span>


<a href="#formed.integrations.flax.training.engine.FlaxTrainingEngine" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="abc.ABC">ABC</span></code>, <code><span title="colt.Registrable">Registrable</span></code>, <code><span title="typing.Generic">Generic</span>[<span title="formed.integrations.flax.types.ModelInputT">ModelInputT</span>, <span title="formed.integrations.flax.types.ModelOutputT">ModelOutputT</span>, <span title="formed.integrations.flax.types.ModelParamsT">ModelParamsT</span>]</code></p>



        <p>Abstract base class for Flax training engines.</p>
<p>A training engine defines how models are trained by implementing
state creation, training steps, and evaluation steps. This allows
for custom training loops and loss computations.</p>


<table>
      <thead>
        <tr>
          <th>
            <span class="doc-section-title">
              CLASS TYPE PARAMETER
            </span>
          </th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ModelInputT</code>
            </td>
            <td class="doc-type_param-details">
              <div class="doc-md-description">
                <p>Type of model input.</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ModelOutputT</code>
            </td>
            <td class="doc-type_param-details">
              <div class="doc-md-description">
                <p>Type of model output.</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ModelParamsT</code>
            </td>
            <td class="doc-type_param-details">
              <div class="doc-md-description">
                <p>Type of additional parameters.</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
      </tbody>
    </table>











<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.training.engine.FlaxTrainingEngine.create_state" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">create_state</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

<a href="#formed.integrations.flax.training.engine.FlaxTrainingEngine.create_state" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">create_state</span><span class="p">(</span><span class="n">rngs</span><span class="p">,</span> <span class="n">trainer</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Create initial training state from model and trainer.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>rngs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Random number generators.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="flax.nnx.Rngs">Rngs</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>trainer</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Trainer instance.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;FlaxTrainer&lt;/span&gt; (&lt;code&gt;formed.integrations.flax.training.trainer.FlaxTrainer&lt;/code&gt;)" href="#formed.integrations.flax.training.trainer.FlaxTrainer">FlaxTrainer</a>[<span title="typing.Any">Any</span>, <span title="formed.integrations.flax.types.ModelInputT">ModelInputT</span>, <span title="formed.integrations.flax.types.ModelOutputT">ModelOutputT</span>, <span title="formed.integrations.flax.types.ModelParamsT">ModelParamsT</span>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Model to train.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;BaseFlaxModel&lt;/span&gt; (&lt;code&gt;formed.integrations.flax.model.BaseFlaxModel&lt;/code&gt;)" href="#formed.integrations.flax.model.BaseFlaxModel">BaseFlaxModel</a>[<span title="formed.integrations.flax.types.ModelInputT">ModelInputT</span>, <span title="formed.integrations.flax.types.ModelOutputT">ModelOutputT</span>, <span title="formed.integrations.flax.types.ModelParamsT">ModelParamsT</span>]</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;TrainState&lt;/span&gt; (&lt;code&gt;formed.integrations.flax.training.state.TrainState&lt;/code&gt;)" href="#formed.integrations.flax.training.state.TrainState">TrainState</a></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Initial training state.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/training/engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-65"><span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
</span><span id="__span-0-66"><span class="k">def</span><span class="w"> </span><span class="nf">create_state</span><span class="p">(</span>
</span><span id="__span-0-67">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-68">    <span class="n">rngs</span><span class="p">:</span> <span class="n">nnx</span><span class="o">.</span><span class="n">Rngs</span><span class="p">,</span>
</span><span id="__span-0-69">    <span class="n">trainer</span><span class="p">:</span> <span class="s2">&quot;FlaxTrainer[Any, ModelInputT, ModelOutputT, ModelParamsT]&quot;</span><span class="p">,</span>
</span><span id="__span-0-70">    <span class="n">model</span><span class="p">:</span> <span class="n">BaseFlaxModel</span><span class="p">[</span><span class="n">ModelInputT</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">,</span> <span class="n">ModelParamsT</span><span class="p">],</span>
</span><span id="__span-0-71"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TrainState</span><span class="p">:</span>
</span><span id="__span-0-72"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Create initial training state from model and trainer.</span>
</span><span id="__span-0-73">
</span><span id="__span-0-74"><span class="sd">    Args:</span>
</span><span id="__span-0-75"><span class="sd">        rngs: Random number generators.</span>
</span><span id="__span-0-76"><span class="sd">        trainer: Trainer instance.</span>
</span><span id="__span-0-77"><span class="sd">        model: Model to train.</span>
</span><span id="__span-0-78">
</span><span id="__span-0-79"><span class="sd">    Returns:</span>
</span><span id="__span-0-80"><span class="sd">        Initial training state.</span>
</span><span id="__span-0-81">
</span><span id="__span-0-82"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-83">    <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.training.engine.FlaxTrainingEngine.train_step" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">train_step</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

<a href="#formed.integrations.flax.training.engine.FlaxTrainingEngine.train_step" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">train_step</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">trainer</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Execute a single training step.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>inputs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Batch of training inputs.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="formed.integrations.flax.types.ModelInputT">ModelInputT</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Current training state.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;TrainState&lt;/span&gt; (&lt;code&gt;formed.integrations.flax.training.state.TrainState&lt;/code&gt;)" href="#formed.integrations.flax.training.state.TrainState">TrainState</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>trainer</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Trainer instance.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;FlaxTrainer&lt;/span&gt; (&lt;code&gt;formed.integrations.flax.training.trainer.FlaxTrainer&lt;/code&gt;)" href="#formed.integrations.flax.training.trainer.FlaxTrainer">FlaxTrainer</a>[<span title="typing.Any">Any</span>, <span title="formed.integrations.flax.types.ModelInputT">ModelInputT</span>, <span title="formed.integrations.flax.types.ModelOutputT">ModelOutputT</span>, <span title="formed.integrations.flax.types.ModelParamsT">ModelParamsT</span>]</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="tuple">tuple</span>[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;TrainState&lt;/span&gt; (&lt;code&gt;formed.integrations.flax.training.state.TrainState&lt;/code&gt;)" href="#formed.integrations.flax.training.state.TrainState">TrainState</a>, <span title="formed.integrations.flax.types.ModelOutputT">ModelOutputT</span>]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Tuple of (updated_state, model_output).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/training/engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-85"><span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
</span><span id="__span-0-86"><span class="k">def</span><span class="w"> </span><span class="nf">train_step</span><span class="p">(</span>
</span><span id="__span-0-87">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-88">    <span class="n">inputs</span><span class="p">:</span> <span class="n">ModelInputT</span><span class="p">,</span>
</span><span id="__span-0-89">    <span class="n">state</span><span class="p">:</span> <span class="n">TrainState</span><span class="p">,</span>
</span><span id="__span-0-90">    <span class="n">trainer</span><span class="p">:</span> <span class="s2">&quot;FlaxTrainer[Any, ModelInputT, ModelOutputT, ModelParamsT]&quot;</span><span class="p">,</span>
</span><span id="__span-0-91"><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">TrainState</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">]:</span>
</span><span id="__span-0-92"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute a single training step.</span>
</span><span id="__span-0-93">
</span><span id="__span-0-94"><span class="sd">    Args:</span>
</span><span id="__span-0-95"><span class="sd">        inputs: Batch of training inputs.</span>
</span><span id="__span-0-96"><span class="sd">        state: Current training state.</span>
</span><span id="__span-0-97"><span class="sd">        trainer: Trainer instance.</span>
</span><span id="__span-0-98">
</span><span id="__span-0-99"><span class="sd">    Returns:</span>
</span><span id="__span-0-100"><span class="sd">        Tuple of (updated_state, model_output).</span>
</span><span id="__span-0-101">
</span><span id="__span-0-102"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-103">    <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.training.engine.FlaxTrainingEngine.eval_step" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">eval_step</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

<a href="#formed.integrations.flax.training.engine.FlaxTrainingEngine.eval_step" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">eval_step</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">trainer</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Execute a single evaluation step.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>inputs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Batch of evaluation inputs.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="formed.integrations.flax.types.ModelInputT">ModelInputT</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Current training state.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;TrainState&lt;/span&gt; (&lt;code&gt;formed.integrations.flax.training.state.TrainState&lt;/code&gt;)" href="#formed.integrations.flax.training.state.TrainState">TrainState</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>trainer</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Trainer instance.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;FlaxTrainer&lt;/span&gt; (&lt;code&gt;formed.integrations.flax.training.trainer.FlaxTrainer&lt;/code&gt;)" href="#formed.integrations.flax.training.trainer.FlaxTrainer">FlaxTrainer</a>[<span title="typing.Any">Any</span>, <span title="formed.integrations.flax.types.ModelInputT">ModelInputT</span>, <span title="formed.integrations.flax.types.ModelOutputT">ModelOutputT</span>, <span title="formed.integrations.flax.types.ModelParamsT">ModelParamsT</span>]</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="formed.integrations.flax.types.ModelOutputT">ModelOutputT</span></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Model output.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/training/engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-105"><span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
</span><span id="__span-0-106"><span class="k">def</span><span class="w"> </span><span class="nf">eval_step</span><span class="p">(</span>
</span><span id="__span-0-107">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-108">    <span class="n">inputs</span><span class="p">:</span> <span class="n">ModelInputT</span><span class="p">,</span>
</span><span id="__span-0-109">    <span class="n">state</span><span class="p">:</span> <span class="n">TrainState</span><span class="p">,</span>
</span><span id="__span-0-110">    <span class="n">trainer</span><span class="p">:</span> <span class="s2">&quot;FlaxTrainer[Any, ModelInputT, ModelOutputT, ModelParamsT]&quot;</span><span class="p">,</span>
</span><span id="__span-0-111"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ModelOutputT</span><span class="p">:</span>
</span><span id="__span-0-112"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute a single evaluation step.</span>
</span><span id="__span-0-113">
</span><span id="__span-0-114"><span class="sd">    Args:</span>
</span><span id="__span-0-115"><span class="sd">        inputs: Batch of evaluation inputs.</span>
</span><span id="__span-0-116"><span class="sd">        state: Current training state.</span>
</span><span id="__span-0-117"><span class="sd">        trainer: Trainer instance.</span>
</span><span id="__span-0-118">
</span><span id="__span-0-119"><span class="sd">    Returns:</span>
</span><span id="__span-0-120"><span class="sd">        Model output.</span>
</span><span id="__span-0-121">
</span><span id="__span-0-122"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-123">    <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="formed.integrations.flax.training.engine.DefaultFlaxTrainingEngine" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">DefaultFlaxTrainingEngine</span>


<a href="#formed.integrations.flax.training.engine.DefaultFlaxTrainingEngine" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">DefaultFlaxTrainingEngine</span><span class="p">(</span>
</span><span id="__span-0-2">    <span class="n">loss</span><span class="o">=</span><span class="s2">&quot;loss&quot;</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="n"><span title="optax.adamw">adamw</span></span><span class="p">(</span><span class="mf">0.001</span><span class="p">)</span>
</span><span id="__span-0-3"><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;FlaxTrainingEngine&lt;/span&gt; (&lt;code&gt;formed.integrations.flax.training.engine.FlaxTrainingEngine&lt;/code&gt;)" href="#formed.integrations.flax.training.engine.FlaxTrainingEngine">FlaxTrainingEngine</a>[<span title="formed.integrations.flax.types.ModelInputT">ModelInputT</span>, <span title="formed.integrations.flax.types.ModelOutputT">ModelOutputT</span>, <span title="formed.integrations.flax.types.ModelParamsT">ModelParamsT</span>]</code></p>



        <p>Default training engine using automatic differentiation.</p>
<p>This engine computes gradients using JAX's automatic differentiation
and updates parameters using the provided optimizer. Loss is extracted
from model output either by attribute name or custom function.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>loss</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Loss accessor - either attribute name (e.g., "loss") or
callable that extracts loss from model output.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="str">str</span> | <span title="collections.abc.Callable">Callable</span>[[<span title="formed.integrations.flax.types.ModelOutputT">ModelOutputT</span>], <span title="jax.Array">Array</span>]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;loss&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>optimizer</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Optax optimizer or transformation.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="formed.integrations.flax.types.IOptimizer">IOptimizer</span> | <span title="optax.MultiSteps">MultiSteps</span> | <span title="optax.GradientTransformation">GradientTransformation</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><span title="optax.adamw">adamw</span>(0.001)</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span id="__span-0-1"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Use output.loss attribute</span>
</span><span id="__span-0-2"><span class="gp">&gt;&gt;&gt; </span><span class="n">engine</span> <span class="o">=</span> <span class="n">DefaultFlaxTrainingEngine</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s2">&quot;loss&quot;</span><span class="p">)</span>
</span><span id="__span-0-3"><span class="gp">&gt;&gt;&gt;</span>
</span><span id="__span-0-4"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Use custom loss function</span>
</span><span id="__span-0-5"><span class="gp">&gt;&gt;&gt; </span><span class="n">engine</span> <span class="o">=</span> <span class="n">DefaultFlaxTrainingEngine</span><span class="p">(</span>
</span><span id="__span-0-6"><span class="gp">... </span>    <span class="n">loss</span><span class="o">=</span><span class="k">lambda</span> <span class="n">output</span><span class="p">:</span> <span class="n">output</span><span class="o">.</span><span class="n">loss</span> <span class="o">+</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="n">output</span><span class="o">.</span><span class="n">regularization</span>
</span><span id="__span-0-7"><span class="gp">... </span><span class="p">)</span>
</span></code></pre></div>








                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/formed/integrations/flax/training/engine.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-150"><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="__span-0-151">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-152">    <span class="n">loss</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">ModelOutputT</span><span class="p">],</span> <span class="n">jax</span><span class="o">.</span><span class="n">Array</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;loss&quot;</span><span class="p">,</span>
</span><span id="__span-0-153">    <span class="n">optimizer</span><span class="p">:</span> <span class="n">IOptimizer</span> <span class="o">|</span> <span class="n">optax</span><span class="o">.</span><span class="n">MultiSteps</span> <span class="o">|</span> <span class="n">optax</span><span class="o">.</span><span class="n">GradientTransformation</span> <span class="o">=</span> <span class="n">optax</span><span class="o">.</span><span class="n">adamw</span><span class="p">(</span><span class="mf">1e-3</span><span class="p">),</span>
</span><span id="__span-0-154"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-155">    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">optimizer</span><span class="p">,</span> <span class="n">optax</span><span class="o">.</span><span class="n">GradientTransformation</span><span class="p">):</span>
</span><span id="__span-0-156">        <span class="n">optimizer</span> <span class="o">=</span> <span class="n">optax</span><span class="o">.</span><span class="n">GradientTransformation</span><span class="p">(</span><span class="n">optimizer</span><span class="o">.</span><span class="n">init</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">update</span><span class="p">)</span>  <span class="c1"># pyright: ignore[reportArgumentType]</span>
</span><span id="__span-0-157">
</span><span id="__span-0-158">    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="__span-0-159">    <span class="bp">self</span><span class="o">.</span><span class="n">_loss</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">xgetattr</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">loss</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">loss</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">loss</span>
</span><span id="__span-0-160">    <span class="bp">self</span><span class="o">.</span><span class="n">_optimizer</span> <span class="o">=</span> <span class="n">optimizer</span>
</span></code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.training.engine.DefaultFlaxTrainingEngine.create_state" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">create_state</span>


<a href="#formed.integrations.flax.training.engine.DefaultFlaxTrainingEngine.create_state" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">create_state</span><span class="p">(</span><span class="n">rngs</span><span class="p">,</span> <span class="n">trainer</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/training/engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-162"><span class="k">def</span><span class="w"> </span><span class="nf">create_state</span><span class="p">(</span>
</span><span id="__span-0-163">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-164">    <span class="n">rngs</span><span class="p">:</span> <span class="n">nnx</span><span class="o">.</span><span class="n">Rngs</span><span class="p">,</span>
</span><span id="__span-0-165">    <span class="n">trainer</span><span class="p">:</span> <span class="s2">&quot;FlaxTrainer[Any, ModelInputT, ModelOutputT, ModelParamsT]&quot;</span><span class="p">,</span>
</span><span id="__span-0-166">    <span class="n">model</span><span class="p">:</span> <span class="n">BaseFlaxModel</span><span class="p">[</span><span class="n">ModelInputT</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">,</span> <span class="n">ModelParamsT</span><span class="p">],</span>
</span><span id="__span-0-167"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TrainState</span><span class="p">:</span>
</span><span id="__span-0-168">    <span class="n">graphdef</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="o">*</span><span class="n">states</span> <span class="o">=</span> <span class="n">nnx</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">nnx</span><span class="o">.</span><span class="n">Param</span><span class="p">,</span> <span class="n">nnx</span><span class="o">.</span><span class="n">BatchStat</span><span class="p">,</span> <span class="n">nnx</span><span class="o">.</span><span class="n">RngState</span><span class="p">)</span>
</span><span id="__span-0-169">    <span class="k">return</span> <span class="n">cast</span><span class="p">(</span>
</span><span id="__span-0-170">        <span class="n">TrainState</span><span class="p">,</span>
</span><span id="__span-0-171">        <span class="n">TrainState</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
</span><span id="__span-0-172">            <span class="n">apply_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-173">            <span class="n">graphdef</span><span class="o">=</span><span class="n">graphdef</span><span class="p">,</span>
</span><span id="__span-0-174">            <span class="n">additional_states</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="n">states</span><span class="p">),</span>
</span><span id="__span-0-175">            <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
</span><span id="__span-0-176">            <span class="n">tx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_optimizer</span><span class="p">,</span>
</span><span id="__span-0-177">        <span class="p">),</span>
</span><span id="__span-0-178">    <span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.training.engine.DefaultFlaxTrainingEngine.train_step" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">train_step</span>


<a href="#formed.integrations.flax.training.engine.DefaultFlaxTrainingEngine.train_step" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">train_step</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">trainer</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/training/engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-180"><span class="k">def</span><span class="w"> </span><span class="nf">train_step</span><span class="p">(</span>
</span><span id="__span-0-181">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-182">    <span class="n">inputs</span><span class="p">:</span> <span class="n">ModelInputT</span><span class="p">,</span>
</span><span id="__span-0-183">    <span class="n">state</span><span class="p">:</span> <span class="n">TrainState</span><span class="p">,</span>
</span><span id="__span-0-184">    <span class="n">trainer</span><span class="p">:</span> <span class="s2">&quot;FlaxTrainer[Any, ModelInputT, ModelOutputT, ModelParamsT]&quot;</span><span class="p">,</span>
</span><span id="__span-0-185"><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">TrainState</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">]:</span>
</span><span id="__span-0-186">    <span class="k">def</span><span class="w"> </span><span class="nf">step</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">TrainState</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">ModelInputT</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">TrainState</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">]:</span>
</span><span id="__span-0-187">        <span class="n">model</span> <span class="o">=</span> <span class="n">nnx</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">graphdef</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="o">*</span><span class="n">state</span><span class="o">.</span><span class="n">additional_states</span><span class="p">)</span>
</span><span id="__span-0-188">        <span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
</span><span id="__span-0-189">
</span><span id="__span-0-190">        <span class="k">def</span><span class="w"> </span><span class="nf">loss_fn</span><span class="p">(</span>
</span><span id="__span-0-191">            <span class="n">model</span><span class="p">:</span> <span class="n">BaseFlaxModel</span><span class="p">[</span><span class="n">ModelInputT</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">,</span> <span class="n">ModelParamsT</span><span class="p">],</span>
</span><span id="__span-0-192">        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">jax</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">]:</span>
</span><span id="__span-0-193">            <span class="n">output</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
</span><span id="__span-0-194">            <span class="n">loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loss</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</span><span id="__span-0-195">            <span class="k">return</span> <span class="n">loss</span><span class="p">,</span> <span class="n">output</span>
</span><span id="__span-0-196">
</span><span id="__span-0-197">        <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">output</span><span class="p">),</span> <span class="n">grads</span> <span class="o">=</span> <span class="n">nnx</span><span class="o">.</span><span class="n">value_and_grad</span><span class="p">(</span><span class="n">loss_fn</span><span class="p">,</span> <span class="n">has_aux</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span><span class="n">model</span><span class="p">)</span>
</span><span id="__span-0-198">
</span><span id="__span-0-199">        <span class="n">graphdef</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="o">*</span><span class="n">additional_states</span> <span class="o">=</span> <span class="n">nnx</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">nnx</span><span class="o">.</span><span class="n">Param</span><span class="p">,</span> <span class="n">nnx</span><span class="o">.</span><span class="n">BatchStat</span><span class="p">,</span> <span class="n">nnx</span><span class="o">.</span><span class="n">RngState</span><span class="p">)</span>
</span><span id="__span-0-200">
</span><span id="__span-0-201">        <span class="n">grads</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">distributor</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">grads</span><span class="p">)</span>
</span><span id="__span-0-202">        <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
</span><span id="__span-0-203">            <span class="n">graphdef</span><span class="o">=</span><span class="n">graphdef</span><span class="p">,</span>
</span><span id="__span-0-204">            <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
</span><span id="__span-0-205">            <span class="n">additional_states</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="n">additional_states</span><span class="p">),</span>
</span><span id="__span-0-206">        <span class="p">)</span>
</span><span id="__span-0-207">        <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">apply_gradients</span><span class="p">(</span><span class="n">grads</span><span class="o">=</span><span class="n">grads</span><span class="p">)</span>
</span><span id="__span-0-208">        <span class="k">return</span> <span class="n">state</span><span class="p">,</span> <span class="n">output</span>
</span><span id="__span-0-209">
</span><span id="__span-0-210">    <span class="k">return</span> <span class="n">step</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">inputs</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.training.engine.DefaultFlaxTrainingEngine.eval_step" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">eval_step</span>


<a href="#formed.integrations.flax.training.engine.DefaultFlaxTrainingEngine.eval_step" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">eval_step</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">trainer</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/training/engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-212"><span class="k">def</span><span class="w"> </span><span class="nf">eval_step</span><span class="p">(</span>
</span><span id="__span-0-213">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-214">    <span class="n">inputs</span><span class="p">:</span> <span class="n">ModelInputT</span><span class="p">,</span>
</span><span id="__span-0-215">    <span class="n">state</span><span class="p">:</span> <span class="n">TrainState</span><span class="p">,</span>
</span><span id="__span-0-216">    <span class="n">trainer</span><span class="p">:</span> <span class="s2">&quot;FlaxTrainer[Any, ModelInputT, ModelOutputT, ModelParamsT]&quot;</span><span class="p">,</span>
</span><span id="__span-0-217"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ModelOutputT</span><span class="p">:</span>
</span><span id="__span-0-218">    <span class="k">del</span> <span class="n">trainer</span>
</span><span id="__span-0-219">
</span><span id="__span-0-220">    <span class="n">model</span><span class="p">:</span> <span class="n">BaseFlaxModel</span><span class="p">[</span><span class="n">ModelInputT</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">,</span> <span class="n">ModelParamsT</span><span class="p">]</span> <span class="o">=</span> <span class="n">nnx</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="__span-0-221">        <span class="n">state</span><span class="o">.</span><span class="n">graphdef</span><span class="p">,</span>
</span><span id="__span-0-222">        <span class="n">state</span><span class="o">.</span><span class="n">params</span><span class="p">,</span>
</span><span id="__span-0-223">        <span class="o">*</span><span class="n">state</span><span class="o">.</span><span class="n">additional_states</span><span class="p">,</span>
</span><span id="__span-0-224">    <span class="p">)</span>
</span><span id="__span-0-225">    <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
</span><span id="__span-0-226">    <span class="k">return</span> <span class="n">model</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="formed.integrations.flax.training.exceptions" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">formed.integrations.flax.training.exceptions</span>


<a href="#formed.integrations.flax.training.exceptions" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h3 id="formed.integrations.flax.training.exceptions.StopEarly" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">StopEarly</span>


<a href="#formed.integrations.flax.training.exceptions.StopEarly" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="Exception">Exception</span></code></p>



        <p>Raised to stop training early.</p>









    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="formed.integrations.flax.training.state" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">formed.integrations.flax.training.state</span>


<a href="#formed.integrations.flax.training.state" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

        <p>Training state management for Flax NNX models.</p>
<p>This module extends Flax's TrainState to support NNX models by storing
the graph definition and additional states (BatchStat, RngState) separately
from trainable parameters.</p>










<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="formed.integrations.flax.training.state.Node" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">Node</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

<a href="#formed.integrations.flax.training.state.Node" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">Node</span> <span class="o">=</span> <span class="n"><span title="typing.TypeVar">TypeVar</span></span><span class="p">(</span><span class="s1">&#39;Node&#39;</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>



<div class="doc doc-object doc-class">



<h3 id="formed.integrations.flax.training.state.TrainState" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">TrainState</span>


<a href="#formed.integrations.flax.training.state.TrainState" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="flax.training.train_state.TrainState">TrainState</span></code>, <code><span title="typing.Generic">Generic</span>[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-attribute&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-attribute-name&quot;&gt;Node&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;formed.integrations.flax.training.state.Node&lt;/code&gt;)" href="#formed.integrations.flax.training.state.Node">Node</a>]</code></p>



        <p>Extended training state for Flax NNX models.</p>
<p>This class extends flax.training.train_state.TrainState to work with
Flax NNX models, storing the model's graph definition and additional
states (like batch statistics and RNG states) separately from parameters.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">ATTRIBUTE</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-attribute&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-attribute-name&quot;&gt;graphdef&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-instance-attribute&quot;&gt;&lt;code&gt;instance-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;formed.integrations.flax.training.state.TrainState.graphdef&lt;/code&gt;)" href="#formed.integrations.flax.training.state.TrainState.graphdef">graphdef</a></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                <p>NNX graph definition describing the model structure.</p>
              </div>
              <p>
                  <span class="doc-attribute-annotation">
                    <b>TYPE:</b>
                      <code><span title="flax.nnx.GraphDef">GraphDef</span>[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-attribute&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-attribute-name&quot;&gt;Node&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;formed.integrations.flax.training.state.Node&lt;/code&gt;)" href="#formed.integrations.flax.training.state.Node">Node</a>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-attribute&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-attribute-name&quot;&gt;additional_states&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-class-attribute&quot;&gt;&lt;code&gt;class-attribute&lt;/code&gt;&lt;/small&gt;
      &lt;small class=&quot;doc doc-label doc-label-instance-attribute&quot;&gt;&lt;code&gt;instance-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;formed.integrations.flax.training.state.TrainState.additional_states&lt;/code&gt;)" href="#formed.integrations.flax.training.state.TrainState.additional_states">additional_states</a></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                <p>Tuple of additional states (BatchStat, RngState, etc.).</p>
              </div>
              <p>
                  <span class="doc-attribute-annotation">
                    <b>TYPE:</b>
                      <code><span title="tuple">tuple</span>[<span title="flax.nnx.State">State</span>, ...]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="formed.integrations.flax.training.state.TrainState.params">params</span></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                <p>Trainable parameters (inherited from TrainState).</p>
              </div>
              <p>
                  <span class="doc-attribute-annotation">
                    <b>TYPE:</b>
                      <code><span title="tuple">tuple</span>[<span title="flax.nnx.State">State</span>, ...]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="formed.integrations.flax.training.state.TrainState.opt_state">opt_state</span></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                <p>Optimizer state (inherited from TrainState).</p>
              </div>
              <p>
                  <span class="doc-attribute-annotation">
                    <b>TYPE:</b>
                      <code><span title="tuple">tuple</span>[<span title="flax.nnx.State">State</span>, ...]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="formed.integrations.flax.training.state.TrainState.step">step</span></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                <p>Training step counter (inherited from TrainState).</p>
              </div>
              <p>
                  <span class="doc-attribute-annotation">
                    <b>TYPE:</b>
                      <code><span title="tuple">tuple</span>[<span title="flax.nnx.State">State</span>, ...]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="formed.integrations.flax.training.state.TrainState.tx">tx</span></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                <p>Optimizer transformation (inherited from TrainState).</p>
              </div>
              <p>
                  <span class="doc-attribute-annotation">
                    <b>TYPE:</b>
                      <code><span title="tuple">tuple</span>[<span title="flax.nnx.State">State</span>, ...]</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span id="__span-0-1"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Create state from model</span>
</span><span id="__span-0-2"><span class="gp">&gt;&gt;&gt; </span><span class="n">graphdef</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="o">*</span><span class="n">states</span> <span class="o">=</span> <span class="n">nnx</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">nnx</span><span class="o">.</span><span class="n">Param</span><span class="p">,</span> <span class="n">nnx</span><span class="o">.</span><span class="n">BatchStat</span><span class="p">)</span>
</span><span id="__span-0-3"><span class="gp">&gt;&gt;&gt; </span><span class="n">state</span> <span class="o">=</span> <span class="n">TrainState</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
</span><span id="__span-0-4"><span class="gp">... </span>    <span class="n">apply_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-5"><span class="gp">... </span>    <span class="n">graphdef</span><span class="o">=</span><span class="n">graphdef</span><span class="p">,</span>
</span><span id="__span-0-6"><span class="gp">... </span>    <span class="n">additional_states</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="n">states</span><span class="p">),</span>
</span><span id="__span-0-7"><span class="gp">... </span>    <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
</span><span id="__span-0-8"><span class="gp">... </span>    <span class="n">tx</span><span class="o">=</span><span class="n">optimizer</span>
</span><span id="__span-0-9"><span class="gp">... </span><span class="p">)</span>
</span><span id="__span-0-10"><span class="gp">&gt;&gt;&gt;</span>
</span><span id="__span-0-11"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Reconstruct model</span>
</span><span id="__span-0-12"><span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">nnx</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">graphdef</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="o">*</span><span class="n">state</span><span class="o">.</span><span class="n">additional_states</span><span class="p">)</span>
</span></code></pre></div>











<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="formed.integrations.flax.training.state.TrainState.graphdef" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">graphdef</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#formed.integrations.flax.training.state.TrainState.graphdef" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">graphdef</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="formed.integrations.flax.training.state.TrainState.additional_states" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">additional_states</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#formed.integrations.flax.training.state.TrainState.additional_states" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">additional_states</span> <span class="o">=</span> <span class="p">()</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>






  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="formed.integrations.flax.training.trainer" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">formed.integrations.flax.training.trainer</span>


<a href="#formed.integrations.flax.training.trainer" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

        <p>High-level trainer for Flax models.</p>
<p>This module provides the FlaxTrainer class, which orchestrates the complete
training process for Flax models including data loading, optimization,
evaluation, callbacks, and distributed training.</p>


<details class="key-features" open>
  <summary>Key Features</summary>
  <ul>
<li>Flexible training loop with epoch and step-based logging/evaluation</li>
<li>Support for callbacks at various training stages</li>
<li>Distributed training via data parallelism</li>
<li>Rich progress bars with training metrics</li>
<li>Early stopping and checkpointing</li>
<li>MLflow integration</li>
</ul>
</details>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span id="__span-0-1"><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">formed.integrations.flax</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="__span-0-2"><span class="gp">... </span>    <span class="n">FlaxTrainer</span><span class="p">,</span>
</span><span id="__span-0-3"><span class="gp">... </span>    <span class="n">EvaluationCallback</span><span class="p">,</span>
</span><span id="__span-0-4"><span class="gp">... </span>    <span class="n">EarlyStoppingCallback</span>
</span><span id="__span-0-5"><span class="gp">... </span><span class="p">)</span>
</span><span id="__span-0-6"><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">formed.integrations.ml</span><span class="w"> </span><span class="kn">import</span> <span class="n">DataLoader</span><span class="p">,</span> <span class="n">BasicBatchSampler</span>
</span><span id="__span-0-7"><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">optax</span>
</span><span id="__span-0-8"><span class="gp">&gt;&gt;&gt;</span>
</span><span id="__span-0-9"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Setup data loaders</span>
</span><span id="__span-0-10"><span class="gp">&gt;&gt;&gt; </span><span class="n">train_dataloader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span>
</span><span id="__span-0-11"><span class="gp">... </span>    <span class="n">sampler</span><span class="o">=</span><span class="n">BasicBatchSampler</span><span class="p">(</span><span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
</span><span id="__span-0-12"><span class="gp">... </span>    <span class="n">collator</span><span class="o">=</span><span class="n">datamodule</span><span class="o">.</span><span class="n">batch</span>
</span><span id="__span-0-13"><span class="gp">... </span><span class="p">)</span>
</span><span id="__span-0-14"><span class="gp">&gt;&gt;&gt;</span>
</span><span id="__span-0-15"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Create trainer</span>
</span><span id="__span-0-16"><span class="gp">&gt;&gt;&gt; </span><span class="n">trainer</span> <span class="o">=</span> <span class="n">FlaxTrainer</span><span class="p">(</span>
</span><span id="__span-0-17"><span class="gp">... </span>    <span class="n">train_dataloader</span><span class="o">=</span><span class="n">train_dataloader</span><span class="p">,</span>
</span><span id="__span-0-18"><span class="gp">... </span>    <span class="n">val_dataloader</span><span class="o">=</span><span class="n">val_dataloader</span><span class="p">,</span>
</span><span id="__span-0-19"><span class="gp">... </span>    <span class="n">optimizer</span><span class="o">=</span><span class="n">optax</span><span class="o">.</span><span class="n">adamw</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">),</span>
</span><span id="__span-0-20"><span class="gp">... </span>    <span class="n">max_epochs</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
</span><span id="__span-0-21"><span class="gp">... </span>    <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span>
</span><span id="__span-0-22"><span class="gp">... </span>        <span class="n">EvaluationCallback</span><span class="p">(</span><span class="n">my_evaluator</span><span class="p">),</span>
</span><span id="__span-0-23"><span class="gp">... </span>        <span class="n">EarlyStoppingCallback</span><span class="p">(</span><span class="n">patience</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-0-24"><span class="gp">... </span>    <span class="p">]</span>
</span><span id="__span-0-25"><span class="gp">... </span><span class="p">)</span>
</span><span id="__span-0-26"><span class="gp">&gt;&gt;&gt;</span>
</span><span id="__span-0-27"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Train model</span>
</span><span id="__span-0-28"><span class="gp">&gt;&gt;&gt; </span><span class="n">rngs</span> <span class="o">=</span> <span class="n">nnx</span><span class="o">.</span><span class="n">Rngs</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
</span><span id="__span-0-29"><span class="gp">&gt;&gt;&gt; </span><span class="n">state</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">rngs</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">train_dataset</span><span class="p">,</span> <span class="n">val_dataset</span><span class="p">)</span>
</span></code></pre></div>










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h3 id="formed.integrations.flax.training.trainer.FlaxTrainer" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">FlaxTrainer</span>


<a href="#formed.integrations.flax.training.trainer.FlaxTrainer" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">FlaxTrainer</span><span class="p">(</span>
</span><span id="__span-0-2">    <span class="o">*</span><span class="p">,</span>
</span><span id="__span-0-3">    <span class="n">train_dataloader</span><span class="p">,</span>
</span><span id="__span-0-4">    <span class="n">val_dataloader</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-5">    <span class="n">engine</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-6">    <span class="n">callbacks</span><span class="o">=</span><span class="p">(),</span>
</span><span id="__span-0-7">    <span class="n">distributor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-8">    <span class="n">max_epochs</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
</span><span id="__span-0-9">    <span class="n">eval_strategy</span><span class="o">=</span><span class="s2">&quot;epoch&quot;</span><span class="p">,</span>
</span><span id="__span-0-10">    <span class="n">eval_interval</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="__span-0-11">    <span class="n">logging_strategy</span><span class="o">=</span><span class="s2">&quot;epoch&quot;</span><span class="p">,</span>
</span><span id="__span-0-12">    <span class="n">logging_interval</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="__span-0-13">    <span class="n">logging_first_step</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-14">    <span class="n">train_prefix</span><span class="o">=</span><span class="s2">&quot;train/&quot;</span><span class="p">,</span>
</span><span id="__span-0-15">    <span class="n">val_prefix</span><span class="o">=</span><span class="s2">&quot;val/&quot;</span><span class="p">,</span>
</span><span id="__span-0-16"><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.Generic">Generic</span>[<span title="formed.integrations.flax.types.ItemT">ItemT</span>, <span title="formed.integrations.flax.types.ModelInputT">ModelInputT</span>, <span title="formed.integrations.flax.types.ModelOutputT">ModelOutputT</span>, <span title="formed.integrations.flax.types.ModelParamsT">ModelParamsT</span>]</code></p>



        <p>High-level trainer for Flax models.</p>
<p>FlaxTrainer provides a complete training loop with support for
distributed training, callbacks, evaluation, and metric logging.
It handles the coordination of data loading, model training,
evaluation, and callback execution.</p>


<table>
      <thead>
        <tr>
          <th>
            <span class="doc-section-title">
              CLASS TYPE PARAMETER
            </span>
          </th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ItemT</code>
            </td>
            <td class="doc-type_param-details">
              <div class="doc-md-description">
                <p>Type of raw dataset items.</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ModelInputT</code>
            </td>
            <td class="doc-type_param-details">
              <div class="doc-md-description">
                <p>Type of batched model inputs.</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ModelOutputT</code>
            </td>
            <td class="doc-type_param-details">
              <div class="doc-md-description">
                <p>Type of model outputs.</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ModelParamsT</code>
            </td>
            <td class="doc-type_param-details">
              <div class="doc-md-description">
                <p>Type of additional model parameters.</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>train_dataloader</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Data loader for training dataset.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="formed.integrations.flax.types.IDataLoader">IDataLoader</span>[<span title="formed.integrations.flax.types.ItemT">ItemT</span>, <span title="formed.integrations.flax.types.ModelInputT">ModelInputT</span>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>val_dataloader</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Optional data loader for validation dataset.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="formed.integrations.flax.types.IDataLoader">IDataLoader</span>[<span title="formed.integrations.flax.types.ItemT">ItemT</span>, <span title="formed.integrations.flax.types.ModelInputT">ModelInputT</span>] | None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>engine</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Training engine (defaults to DefaultFlaxTrainingEngine).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;FlaxTrainingEngine&lt;/span&gt; (&lt;code&gt;formed.integrations.flax.training.engine.FlaxTrainingEngine&lt;/code&gt;)" href="#formed.integrations.flax.training.engine.FlaxTrainingEngine">FlaxTrainingEngine</a>[<span title="formed.integrations.flax.types.ModelInputT">ModelInputT</span>, <span title="formed.integrations.flax.types.ModelOutputT">ModelOutputT</span>, <span title="formed.integrations.flax.types.ModelParamsT">ModelParamsT</span>] | None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>callbacks</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Sequence of training callbacks.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="collections.abc.Sequence">Sequence</span>[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;FlaxTrainingCallback&lt;/span&gt; (&lt;code&gt;formed.integrations.flax.training.callbacks.FlaxTrainingCallback&lt;/code&gt;)" href="#formed.integrations.flax.training.callbacks.FlaxTrainingCallback">FlaxTrainingCallback</a>]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>()</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>distributor</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Device distributor (defaults to SingleDeviceDistributor).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;BaseDistributor&lt;/span&gt; (&lt;code&gt;formed.integrations.flax.distributors.BaseDistributor&lt;/code&gt;)" href="#formed.integrations.flax.distributors.BaseDistributor">BaseDistributor</a> | None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_epochs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Maximum number of training epochs.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="int">int</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>10</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>eval_strategy</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>When to evaluate - "epoch" or "step".</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Literal">Literal</span>[&#39;epoch&#39;, &#39;step&#39;]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;epoch&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>eval_interval</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Evaluation interval (epochs or steps).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="int">int</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>1</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>logging_strategy</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>When to log - "epoch" or "step".</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Literal">Literal</span>[&#39;epoch&#39;, &#39;step&#39;]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;epoch&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>logging_interval</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Logging interval (epochs or steps).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="int">int</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>1</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>logging_first_step</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to log after the first training step.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="bool">bool</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span id="__span-0-1"><span class="gp">&gt;&gt;&gt; </span><span class="n">trainer</span> <span class="o">=</span> <span class="n">FlaxTrainer</span><span class="p">(</span>
</span><span id="__span-0-2"><span class="gp">... </span>    <span class="n">train_dataloader</span><span class="o">=</span><span class="n">train_loader</span><span class="p">,</span>
</span><span id="__span-0-3"><span class="gp">... </span>    <span class="n">val_dataloader</span><span class="o">=</span><span class="n">val_loader</span><span class="p">,</span>
</span><span id="__span-0-4"><span class="gp">... </span>    <span class="n">max_epochs</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
</span><span id="__span-0-5"><span class="gp">... </span>    <span class="n">eval_strategy</span><span class="o">=</span><span class="s2">&quot;epoch&quot;</span><span class="p">,</span>
</span><span id="__span-0-6"><span class="gp">... </span>    <span class="n">logging_strategy</span><span class="o">=</span><span class="s2">&quot;step&quot;</span><span class="p">,</span>
</span><span id="__span-0-7"><span class="gp">... </span>    <span class="n">logging_interval</span><span class="o">=</span><span class="mi">100</span>
</span><span id="__span-0-8"><span class="gp">... </span>    <span class="n">engine</span><span class="o">=</span><span class="n">DefaultFlaxTrainingEngine</span><span class="p">(</span>
</span><span id="__span-0-9"><span class="gp">... </span>        <span class="n">optimizer</span><span class="o">=</span><span class="n">optax</span><span class="o">.</span><span class="n">adamw</span><span class="p">(</span><span class="mf">1e-3</span><span class="p">),</span>
</span><span id="__span-0-10"><span class="gp">... </span>    <span class="p">),</span>
</span><span id="__span-0-11"><span class="gp">... </span><span class="p">)</span>
</span></code></pre></div>








                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/formed/integrations/flax/training/trainer.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-118"><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="__span-0-119">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-120">    <span class="o">*</span><span class="p">,</span>
</span><span id="__span-0-121">    <span class="n">train_dataloader</span><span class="p">:</span> <span class="n">IDataLoader</span><span class="p">[</span><span class="n">ItemT</span><span class="p">,</span> <span class="n">ModelInputT</span><span class="p">],</span>
</span><span id="__span-0-122">    <span class="n">val_dataloader</span><span class="p">:</span> <span class="n">IDataLoader</span><span class="p">[</span><span class="n">ItemT</span><span class="p">,</span> <span class="n">ModelInputT</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-123">    <span class="n">engine</span><span class="p">:</span> <span class="n">FlaxTrainingEngine</span><span class="p">[</span><span class="n">ModelInputT</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">,</span> <span class="n">ModelParamsT</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-124">    <span class="n">callbacks</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">FlaxTrainingCallback</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
</span><span id="__span-0-125">    <span class="n">distributor</span><span class="p">:</span> <span class="n">BaseDistributor</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-126">    <span class="n">max_epochs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="__span-0-127">    <span class="n">eval_strategy</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;epoch&quot;</span><span class="p">,</span> <span class="s2">&quot;step&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;epoch&quot;</span><span class="p">,</span>
</span><span id="__span-0-128">    <span class="n">eval_interval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="__span-0-129">    <span class="n">logging_strategy</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;epoch&quot;</span><span class="p">,</span> <span class="s2">&quot;step&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;epoch&quot;</span><span class="p">,</span>
</span><span id="__span-0-130">    <span class="n">logging_interval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="__span-0-131">    <span class="n">logging_first_step</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-132">    <span class="n">train_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;train/&quot;</span><span class="p">,</span>
</span><span id="__span-0-133">    <span class="n">val_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;val/&quot;</span><span class="p">,</span>
</span><span id="__span-0-134"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-135">    <span class="bp">self</span><span class="o">.</span><span class="n">_train_dataloader</span> <span class="o">=</span> <span class="n">train_dataloader</span>
</span><span id="__span-0-136">    <span class="bp">self</span><span class="o">.</span><span class="n">_val_dataloader</span> <span class="o">=</span> <span class="n">val_dataloader</span>
</span><span id="__span-0-137">    <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span> <span class="o">=</span> <span class="n">engine</span> <span class="ow">or</span> <span class="n">DefaultFlaxTrainingEngine</span><span class="p">[</span><span class="n">ModelInputT</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">,</span> <span class="n">ModelParamsT</span><span class="p">]()</span>
</span><span id="__span-0-138">    <span class="bp">self</span><span class="o">.</span><span class="n">_distributor</span> <span class="o">=</span> <span class="n">distributor</span> <span class="ow">or</span> <span class="n">SingleDeviceDistributor</span><span class="p">()</span>
</span><span id="__span-0-139">    <span class="bp">self</span><span class="o">.</span><span class="n">_max_epochs</span> <span class="o">=</span> <span class="n">max_epochs</span>
</span><span id="__span-0-140">    <span class="bp">self</span><span class="o">.</span><span class="n">_eval_strategy</span> <span class="o">=</span> <span class="n">eval_strategy</span>
</span><span id="__span-0-141">    <span class="bp">self</span><span class="o">.</span><span class="n">_eval_interval</span> <span class="o">=</span> <span class="n">eval_interval</span>
</span><span id="__span-0-142">    <span class="bp">self</span><span class="o">.</span><span class="n">_logging_strategy</span> <span class="o">=</span> <span class="n">logging_strategy</span>
</span><span id="__span-0-143">    <span class="bp">self</span><span class="o">.</span><span class="n">_logging_interval</span> <span class="o">=</span> <span class="n">logging_interval</span>
</span><span id="__span-0-144">    <span class="bp">self</span><span class="o">.</span><span class="n">_logging_first_step</span> <span class="o">=</span> <span class="n">logging_first_step</span>
</span><span id="__span-0-145">    <span class="bp">self</span><span class="o">.</span><span class="n">_callbacks</span> <span class="o">=</span> <span class="n">callbacks</span>
</span><span id="__span-0-146">    <span class="bp">self</span><span class="o">.</span><span class="n">_train_prefix</span> <span class="o">=</span> <span class="n">train_prefix</span>
</span><span id="__span-0-147">    <span class="bp">self</span><span class="o">.</span><span class="n">_val_prefix</span> <span class="o">=</span> <span class="n">val_prefix</span>
</span></code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="formed.integrations.flax.training.trainer.FlaxTrainer.distributor" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">distributor</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#formed.integrations.flax.training.trainer.FlaxTrainer.distributor" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">distributor</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>




<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.training.trainer.FlaxTrainer.train" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">train</span>


<a href="#formed.integrations.flax.training.trainer.FlaxTrainer.train" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">train</span><span class="p">(</span>
</span><span id="__span-0-2">    <span class="n">model</span><span class="p">,</span>
</span><span id="__span-0-3">    <span class="n">train_dataset</span><span class="p">,</span>
</span><span id="__span-0-4">    <span class="n">val_dataset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-5">    <span class="n">state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-6">    <span class="n">rngs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-7"><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Train a model on the provided datasets.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Model to train.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;BaseFlaxModel&lt;/span&gt; (&lt;code&gt;formed.integrations.flax.model.BaseFlaxModel&lt;/code&gt;)" href="#formed.integrations.flax.model.BaseFlaxModel">BaseFlaxModel</a>[<span title="formed.integrations.flax.types.ModelInputT">ModelInputT</span>, <span title="formed.integrations.flax.types.ModelOutputT">ModelOutputT</span>, <span title="formed.integrations.flax.types.ModelParamsT">ModelParamsT</span>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_dataset</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Sequence of training items.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="collections.abc.Sequence">Sequence</span>[<span title="formed.integrations.flax.types.ItemT">ItemT</span>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>val_dataset</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Optional sequence of validation items.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="collections.abc.Sequence">Sequence</span>[<span title="formed.integrations.flax.types.ItemT">ItemT</span>] | None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Optional pre-initialized training state (for resuming).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;TrainState&lt;/span&gt; (&lt;code&gt;formed.integrations.flax.training.state.TrainState&lt;/code&gt;)" href="#formed.integrations.flax.training.state.TrainState">TrainState</a> | None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rngs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Optional random number generators for initialization.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="flax.nnx.Rngs">Rngs</span> | None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;TrainState&lt;/span&gt; (&lt;code&gt;formed.integrations.flax.training.state.TrainState&lt;/code&gt;)" href="#formed.integrations.flax.training.state.TrainState">TrainState</a></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Final training state with trained parameters.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RAISES</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
              <span class="doc-raises-annotation">
                  <code><span title="ValueError">ValueError</span></code>
              </span>
            </td>
            <td class="doc-raises-details">
              <div class="doc-md-description">
                <p>If val_dataset is provided but val_dataloader is not.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span id="__span-0-1"><span class="gp">&gt;&gt;&gt; </span><span class="n">state</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">train</span><span class="p">(</span>
</span><span id="__span-0-2"><span class="gp">... </span>    <span class="n">model</span><span class="p">,</span> <span class="n">train_items</span><span class="p">,</span> <span class="n">val_items</span>
</span><span id="__span-0-3"><span class="gp">... </span><span class="p">)</span>
</span><span id="__span-0-4"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Reconstruct trained model</span>
</span><span id="__span-0-5"><span class="gp">&gt;&gt;&gt; </span><span class="n">trained_model</span> <span class="o">=</span> <span class="n">nnx</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="__span-0-6"><span class="gp">... </span>    <span class="n">state</span><span class="o">.</span><span class="n">graphdef</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="o">*</span><span class="n">state</span><span class="o">.</span><span class="n">additional_states</span>
</span><span id="__span-0-7"><span class="gp">... </span><span class="p">)</span>
</span></code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/training/trainer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-153"><span class="k">def</span><span class="w"> </span><span class="nf">train</span><span class="p">(</span>
</span><span id="__span-0-154">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-155">    <span class="n">model</span><span class="p">:</span> <span class="n">BaseFlaxModel</span><span class="p">[</span><span class="n">ModelInputT</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">,</span> <span class="n">ModelParamsT</span><span class="p">],</span>
</span><span id="__span-0-156">    <span class="n">train_dataset</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">ItemT</span><span class="p">],</span>
</span><span id="__span-0-157">    <span class="n">val_dataset</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">ItemT</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-158">    <span class="n">state</span><span class="p">:</span> <span class="n">TrainState</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-159">    <span class="n">rngs</span><span class="p">:</span> <span class="n">nnx</span><span class="o">.</span><span class="n">Rngs</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-160"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TrainState</span><span class="p">:</span>
</span><span id="__span-0-161"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Train a model on the provided datasets.</span>
</span><span id="__span-0-162">
</span><span id="__span-0-163"><span class="sd">    Args:</span>
</span><span id="__span-0-164"><span class="sd">        model: Model to train.</span>
</span><span id="__span-0-165"><span class="sd">        train_dataset: Sequence of training items.</span>
</span><span id="__span-0-166"><span class="sd">        val_dataset: Optional sequence of validation items.</span>
</span><span id="__span-0-167"><span class="sd">        state: Optional pre-initialized training state (for resuming).</span>
</span><span id="__span-0-168"><span class="sd">        rngs: Optional random number generators for initialization.</span>
</span><span id="__span-0-169">
</span><span id="__span-0-170"><span class="sd">    Returns:</span>
</span><span id="__span-0-171"><span class="sd">        Final training state with trained parameters.</span>
</span><span id="__span-0-172">
</span><span id="__span-0-173"><span class="sd">    Raises:</span>
</span><span id="__span-0-174"><span class="sd">        ValueError: If val_dataset is provided but val_dataloader is not.</span>
</span><span id="__span-0-175">
</span><span id="__span-0-176"><span class="sd">    Examples:</span>
</span><span id="__span-0-177"><span class="sd">        &gt;&gt;&gt; state = trainer.train(</span>
</span><span id="__span-0-178"><span class="sd">        ...     model, train_items, val_items</span>
</span><span id="__span-0-179"><span class="sd">        ... )</span>
</span><span id="__span-0-180"><span class="sd">        &gt;&gt;&gt; # Reconstruct trained model</span>
</span><span id="__span-0-181"><span class="sd">        &gt;&gt;&gt; trained_model = nnx.merge(</span>
</span><span id="__span-0-182"><span class="sd">        ...     state.graphdef, state.params, *state.additional_states</span>
</span><span id="__span-0-183"><span class="sd">        ... )</span>
</span><span id="__span-0-184">
</span><span id="__span-0-185"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-186">    <span class="k">if</span> <span class="n">val_dataset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_val_dataloader</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-187">        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Validation dataloader is not provided.&quot;</span><span class="p">)</span>
</span><span id="__span-0-188">
</span><span id="__span-0-189">    <span class="n">rngs</span> <span class="o">=</span> <span class="n">rngs</span> <span class="ow">or</span> <span class="n">require_rngs</span><span class="p">()</span>
</span><span id="__span-0-190">    <span class="n">logger</span> <span class="o">=</span> <span class="n">use_step_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="__span-0-191">
</span><span id="__span-0-192">    <span class="k">if</span> <span class="n">state</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-193">        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">create_state</span><span class="p">(</span><span class="n">rngs</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
</span><span id="__span-0-194">
</span><span id="__span-0-195">    <span class="n">train_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_distributor</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">train_step</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,))</span>
</span><span id="__span-0-196">    <span class="n">eval_step</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">nnx</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnames</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;trainer&quot;</span><span class="p">))(</span><span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">eval_step</span><span class="p">)</span>  <span class="c1"># pyright: ignore[reportArgumentType]</span>
</span><span id="__span-0-197">
</span><span id="__span-0-198">    <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callbacks</span><span class="p">:</span>
</span><span id="__span-0-199">        <span class="n">callback</span><span class="o">.</span><span class="n">on_training_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
</span><span id="__span-0-200">
</span><span id="__span-0-201">    <span class="k">def</span><span class="w"> </span><span class="nf">get_total_training_steps</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="__span-0-202">        <span class="n">dataloader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_train_dataloader</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">)</span>
</span><span id="__span-0-203">        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataloader</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_epochs</span>
</span><span id="__span-0-204">
</span><span id="__span-0-205">    <span class="k">def</span><span class="w"> </span><span class="nf">get_total_eval_steps</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="__span-0-206">        <span class="k">assert</span> <span class="n">val_dataset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_val_dataloader</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="__span-0-207">        <span class="n">dataloader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_val_dataloader</span><span class="p">(</span><span class="n">val_dataset</span><span class="p">)</span>
</span><span id="__span-0-208">        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataloader</span><span class="p">)</span>
</span><span id="__span-0-209">
</span><span id="__span-0-210">    <span class="k">def</span><span class="w"> </span><span class="nf">new_epoch</span><span class="p">(</span><span class="n">epoch</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-211">        <span class="k">assert</span> <span class="n">state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="__span-0-212">        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Starting epoch </span><span class="si">{</span><span class="n">epoch</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_epochs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-0-213">        <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callbacks</span><span class="p">:</span>
</span><span id="__span-0-214">            <span class="n">callback</span><span class="o">.</span><span class="n">on_epoch_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">epoch</span><span class="p">)</span>
</span><span id="__span-0-215">
</span><span id="__span-0-216">    <span class="k">def</span><span class="w"> </span><span class="nf">finalize_epoch</span><span class="p">(</span><span class="n">epoch</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-217">        <span class="k">assert</span> <span class="n">state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="__span-0-218">        <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callbacks</span><span class="p">:</span>
</span><span id="__span-0-219">            <span class="n">callback</span><span class="o">.</span><span class="n">on_epoch_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">epoch</span><span class="p">)</span>
</span><span id="__span-0-220">
</span><span id="__span-0-221">    <span class="k">def</span><span class="w"> </span><span class="nf">new_batch</span><span class="p">(</span><span class="n">epoch</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-222">        <span class="k">assert</span> <span class="n">state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="__span-0-223">        <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callbacks</span><span class="p">:</span>
</span><span id="__span-0-224">            <span class="n">callback</span><span class="o">.</span><span class="n">on_batch_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">epoch</span><span class="p">)</span>
</span><span id="__span-0-225">
</span><span id="__span-0-226">    <span class="k">def</span><span class="w"> </span><span class="nf">finalize_batch</span><span class="p">(</span><span class="n">epoch</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">output</span><span class="p">:</span> <span class="n">ModelOutputT</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-227">        <span class="k">assert</span> <span class="n">state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="__span-0-228">        <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callbacks</span><span class="p">:</span>
</span><span id="__span-0-229">            <span class="n">callback</span><span class="o">.</span><span class="n">on_batch_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">epoch</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
</span><span id="__span-0-230">
</span><span id="__span-0-231">    <span class="k">def</span><span class="w"> </span><span class="nf">new_evaluators</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">IEvaluator</span><span class="p">[</span><span class="n">ModelInputT</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">]]:</span>
</span><span id="__span-0-232">        <span class="k">assert</span> <span class="n">state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="__span-0-233">        <span class="k">return</span> <span class="p">[</span><span class="n">callback</span><span class="o">.</span><span class="n">on_eval_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callbacks</span><span class="p">]</span>
</span><span id="__span-0-234">
</span><span id="__span-0-235">    <span class="k">def</span><span class="w"> </span><span class="nf">update_metrics</span><span class="p">(</span>
</span><span id="__span-0-236">        <span class="n">evaluators</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">IEvaluator</span><span class="p">[</span><span class="n">ModelInputT</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">]],</span>
</span><span id="__span-0-237">        <span class="n">inputs</span><span class="p">:</span> <span class="n">ModelInputT</span><span class="p">,</span>
</span><span id="__span-0-238">        <span class="n">output</span><span class="p">:</span> <span class="n">ModelOutputT</span><span class="p">,</span>
</span><span id="__span-0-239">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-240">        <span class="k">assert</span> <span class="n">state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="__span-0-241">        <span class="k">for</span> <span class="n">evaluator</span> <span class="ow">in</span> <span class="n">evaluators</span><span class="p">:</span>
</span><span id="__span-0-242">            <span class="n">evaluator</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
</span><span id="__span-0-243">
</span><span id="__span-0-244">    <span class="k">def</span><span class="w"> </span><span class="nf">compute_metrics</span><span class="p">(</span><span class="n">evaluators</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">IEvaluator</span><span class="p">[</span><span class="n">ModelInputT</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
</span><span id="__span-0-245">        <span class="k">assert</span> <span class="n">state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="__span-0-246">        <span class="n">metrics</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-0-247">        <span class="k">for</span> <span class="n">evaluator</span> <span class="ow">in</span> <span class="n">evaluators</span><span class="p">:</span>
</span><span id="__span-0-248">            <span class="n">metrics</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">evaluator</span><span class="o">.</span><span class="n">compute</span><span class="p">())</span>
</span><span id="__span-0-249">        <span class="k">return</span> <span class="n">metrics</span>
</span><span id="__span-0-250">
</span><span id="__span-0-251">    <span class="k">def</span><span class="w"> </span><span class="nf">finalize_evaluation</span><span class="p">(</span><span class="n">metrics</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">prefix</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-252">        <span class="k">assert</span> <span class="n">state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="__span-0-253">        <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callbacks</span><span class="p">:</span>
</span><span id="__span-0-254">            <span class="n">callback</span><span class="o">.</span><span class="n">on_eval_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">metrics</span><span class="p">,</span> <span class="n">prefix</span><span class="p">)</span>
</span><span id="__span-0-255">
</span><span id="__span-0-256">    <span class="k">def</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="n">metrics</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">prefix</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-257">        <span class="k">assert</span> <span class="n">state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="__span-0-258">        <span class="k">if</span> <span class="ow">not</span> <span class="n">metrics</span><span class="p">:</span>
</span><span id="__span-0-259">            <span class="k">return</span>
</span><span id="__span-0-260">        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}{</span><span class="n">k</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">v</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">metrics</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
</span><span id="__span-0-261">        <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callbacks</span><span class="p">:</span>
</span><span id="__span-0-262">            <span class="n">callback</span><span class="o">.</span><span class="n">on_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">metrics</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">)</span>
</span><span id="__span-0-263">
</span><span id="__span-0-264">    <span class="k">def</span><span class="w"> </span><span class="nf">do_evaluation</span><span class="p">(</span><span class="n">progress</span><span class="p">:</span> <span class="n">Progress</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-265">        <span class="k">if</span> <span class="ow">not</span> <span class="n">val_dataset</span><span class="p">:</span>
</span><span id="__span-0-266">            <span class="k">return</span>
</span><span id="__span-0-267">
</span><span id="__span-0-268">        <span class="k">assert</span> <span class="n">state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="__span-0-269">        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_val_dataloader</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="__span-0-270">
</span><span id="__span-0-271">        <span class="n">evaluators</span> <span class="o">=</span> <span class="n">new_evaluators</span><span class="p">()</span>
</span><span id="__span-0-272">
</span><span id="__span-0-273">        <span class="n">task</span> <span class="o">=</span> <span class="n">progress</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="s2">&quot;Evaluation&quot;</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="n">get_total_eval_steps</span><span class="p">())</span>
</span><span id="__span-0-274">        <span class="k">with</span> <span class="n">closing</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_val_dataloader</span><span class="p">(</span><span class="n">val_dataset</span><span class="p">))</span> <span class="k">as</span> <span class="n">val_dataloader</span><span class="p">:</span>
</span><span id="__span-0-275">            <span class="k">for</span> <span class="n">batch</span> <span class="ow">in</span> <span class="n">val_dataloader</span><span class="p">:</span>
</span><span id="__span-0-276">                <span class="n">output</span> <span class="o">=</span> <span class="n">eval_step</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="__span-0-277">                <span class="n">update_metrics</span><span class="p">(</span><span class="n">evaluators</span><span class="p">,</span> <span class="n">batch</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
</span><span id="__span-0-278">                <span class="n">progress</span><span class="o">.</span><span class="n">advance</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
</span><span id="__span-0-279">        <span class="n">progress</span><span class="o">.</span><span class="n">remove_task</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
</span><span id="__span-0-280">
</span><span id="__span-0-281">        <span class="n">computed_metrics</span> <span class="o">=</span> <span class="n">compute_metrics</span><span class="p">(</span><span class="n">evaluators</span><span class="p">)</span>
</span><span id="__span-0-282">        <span class="n">log</span><span class="p">(</span><span class="n">computed_metrics</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_val_prefix</span><span class="p">)</span>
</span><span id="__span-0-283">        <span class="n">finalize_evaluation</span><span class="p">(</span><span class="n">computed_metrics</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_val_prefix</span><span class="p">)</span>
</span><span id="__span-0-284">
</span><span id="__span-0-285">    <span class="k">def</span><span class="w"> </span><span class="nf">is_logging_step</span><span class="p">(</span><span class="n">step</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-0-286">        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logging_strategy</span> <span class="o">==</span> <span class="s2">&quot;step&quot;</span> <span class="ow">and</span> <span class="n">step</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logging_interval</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
</span><span id="__span-0-287">            <span class="bp">self</span><span class="o">.</span><span class="n">_logging_first_step</span> <span class="ow">and</span> <span class="n">step</span> <span class="o">==</span> <span class="mi">1</span>
</span><span id="__span-0-288">        <span class="p">)</span>
</span><span id="__span-0-289">
</span><span id="__span-0-290">    <span class="k">def</span><span class="w"> </span><span class="nf">is_logging_epoch</span><span class="p">(</span><span class="n">epoch</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-0-291">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logging_strategy</span> <span class="o">==</span> <span class="s2">&quot;epoch&quot;</span> <span class="ow">and</span> <span class="n">epoch</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logging_interval</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="__span-0-292">
</span><span id="__span-0-293">    <span class="k">def</span><span class="w"> </span><span class="nf">is_eval_step</span><span class="p">(</span><span class="n">step</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-0-294">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eval_strategy</span> <span class="o">==</span> <span class="s2">&quot;step&quot;</span> <span class="ow">and</span> <span class="n">step</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eval_interval</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="__span-0-295">
</span><span id="__span-0-296">    <span class="k">def</span><span class="w"> </span><span class="nf">is_eval_eopch</span><span class="p">(</span><span class="n">epoch</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-0-297">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eval_strategy</span> <span class="o">==</span> <span class="s2">&quot;epoch&quot;</span> <span class="ow">and</span> <span class="n">epoch</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eval_interval</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="__span-0-298">
</span><span id="__span-0-299">    <span class="n">evaluators</span> <span class="o">=</span> <span class="n">new_evaluators</span><span class="p">()</span>
</span><span id="__span-0-300">
</span><span id="__span-0-301">    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-302">        <span class="k">with</span> <span class="n">Progress</span><span class="p">(</span>
</span><span id="__span-0-303">            <span class="n">SpinnerColumn</span><span class="p">(),</span>
</span><span id="__span-0-304">            <span class="n">TextColumn</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{task.description}</span><span class="s2">&quot;</span><span class="p">),</span>
</span><span id="__span-0-305">            <span class="n">BarColumn</span><span class="p">(),</span>
</span><span id="__span-0-306">            <span class="n">MofNCompleteColumn</span><span class="p">(),</span>
</span><span id="__span-0-307">            <span class="n">TimeRemainingColumn</span><span class="p">(),</span>
</span><span id="__span-0-308">            <span class="n">console</span><span class="o">=</span><span class="n">STDERR_CONSOLE</span><span class="p">,</span>
</span><span id="__span-0-309">        <span class="p">)</span> <span class="k">as</span> <span class="n">progress</span><span class="p">:</span>
</span><span id="__span-0-310">            <span class="n">task</span> <span class="o">=</span> <span class="n">progress</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="s2">&quot;Training&quot;</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="n">get_total_training_steps</span><span class="p">())</span>
</span><span id="__span-0-311">            <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_epochs</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="__span-0-312">                <span class="k">assert</span> <span class="n">state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="__span-0-313">                <span class="n">new_epoch</span><span class="p">(</span><span class="n">epoch</span><span class="p">)</span>
</span><span id="__span-0-314">
</span><span id="__span-0-315">                <span class="k">with</span> <span class="n">closing</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_train_dataloader</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">))</span> <span class="k">as</span> <span class="n">train_dataloader</span><span class="p">:</span>
</span><span id="__span-0-316">                    <span class="k">for</span> <span class="n">batch</span> <span class="ow">in</span> <span class="n">train_dataloader</span><span class="p">:</span>
</span><span id="__span-0-317">                        <span class="n">new_batch</span><span class="p">(</span><span class="n">epoch</span><span class="p">)</span>
</span><span id="__span-0-318">
</span><span id="__span-0-319">                        <span class="n">sharded_batch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_distributor</span><span class="o">.</span><span class="n">shard</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
</span><span id="__span-0-320">                        <span class="n">replicated_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_distributor</span><span class="o">.</span><span class="n">replicate</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
</span><span id="__span-0-321">
</span><span id="__span-0-322">                        <span class="n">replicated_state</span><span class="p">,</span> <span class="n">replicated_output</span> <span class="o">=</span> <span class="n">train_step</span><span class="p">(</span><span class="n">sharded_batch</span><span class="p">,</span> <span class="n">replicated_state</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="__span-0-323">
</span><span id="__span-0-324">                        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_distributor</span><span class="o">.</span><span class="n">unreplicate</span><span class="p">(</span><span class="n">replicated_state</span><span class="p">)</span>
</span><span id="__span-0-325">                        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_distributor</span><span class="o">.</span><span class="n">unreplicate</span><span class="p">(</span><span class="n">replicated_output</span><span class="p">)</span>
</span><span id="__span-0-326">                        <span class="k">assert</span> <span class="n">state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="__span-0-327">
</span><span id="__span-0-328">                        <span class="n">update_metrics</span><span class="p">(</span><span class="n">evaluators</span><span class="p">,</span> <span class="n">batch</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
</span><span id="__span-0-329">
</span><span id="__span-0-330">                        <span class="k">if</span> <span class="n">is_logging_step</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">step</span><span class="p">)):</span>
</span><span id="__span-0-331">                            <span class="n">train_metrics</span> <span class="o">=</span> <span class="n">compute_metrics</span><span class="p">(</span><span class="n">evaluators</span><span class="p">)</span>
</span><span id="__span-0-332">                            <span class="n">log</span><span class="p">(</span><span class="n">train_metrics</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_train_prefix</span><span class="p">)</span>
</span><span id="__span-0-333">                            <span class="n">finalize_evaluation</span><span class="p">(</span><span class="n">train_metrics</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_train_prefix</span><span class="p">)</span>
</span><span id="__span-0-334">                            <span class="n">evaluators</span> <span class="o">=</span> <span class="n">new_evaluators</span><span class="p">()</span>
</span><span id="__span-0-335">
</span><span id="__span-0-336">                        <span class="n">finalize_batch</span><span class="p">(</span><span class="n">epoch</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
</span><span id="__span-0-337">
</span><span id="__span-0-338">                        <span class="n">progress</span><span class="o">.</span><span class="n">advance</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
</span><span id="__span-0-339">
</span><span id="__span-0-340">                        <span class="k">if</span> <span class="n">is_eval_step</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">step</span><span class="p">)):</span>
</span><span id="__span-0-341">                            <span class="n">do_evaluation</span><span class="p">(</span><span class="n">progress</span><span class="p">)</span>
</span><span id="__span-0-342">
</span><span id="__span-0-343">                <span class="k">if</span> <span class="n">is_logging_epoch</span><span class="p">(</span><span class="n">epoch</span><span class="p">):</span>
</span><span id="__span-0-344">                    <span class="n">train_metrics</span> <span class="o">=</span> <span class="n">compute_metrics</span><span class="p">(</span><span class="n">evaluators</span><span class="p">)</span>
</span><span id="__span-0-345">                    <span class="n">log</span><span class="p">(</span><span class="n">train_metrics</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_train_prefix</span><span class="p">)</span>
</span><span id="__span-0-346">                    <span class="n">finalize_evaluation</span><span class="p">(</span><span class="n">train_metrics</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_train_prefix</span><span class="p">)</span>
</span><span id="__span-0-347">                    <span class="n">evaluators</span> <span class="o">=</span> <span class="n">new_evaluators</span><span class="p">()</span>
</span><span id="__span-0-348">
</span><span id="__span-0-349">                <span class="k">if</span> <span class="n">is_eval_eopch</span><span class="p">(</span><span class="n">epoch</span><span class="p">):</span>
</span><span id="__span-0-350">                    <span class="n">do_evaluation</span><span class="p">(</span><span class="n">progress</span><span class="p">)</span>
</span><span id="__span-0-351">
</span><span id="__span-0-352">                <span class="n">finalize_epoch</span><span class="p">(</span><span class="n">epoch</span><span class="p">)</span>
</span><span id="__span-0-353">    <span class="k">except</span> <span class="n">StopEarly</span><span class="p">:</span>
</span><span id="__span-0-354">        <span class="k">assert</span> <span class="n">state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="__span-0-355">        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Training stopped early at </span><span class="si">{</span><span class="n">state</span><span class="o">.</span><span class="n">step</span><span class="si">}</span><span class="s2"> steps.&quot;</span><span class="p">)</span>
</span><span id="__span-0-356">
</span><span id="__span-0-357">    <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callbacks</span><span class="p">:</span>
</span><span id="__span-0-358">        <span class="n">state</span> <span class="o">=</span> <span class="n">callback</span><span class="o">.</span><span class="n">on_training_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
</span><span id="__span-0-359">
</span><span id="__span-0-360">    <span class="k">return</span> <span class="n">state</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="formed.integrations.flax.random" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">formed.integrations.flax.random</span>


<a href="#formed.integrations.flax.random" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">










<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="formed.integrations.flax.random.use_rngs" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">use_rngs</span>


<a href="#formed.integrations.flax.random.use_rngs" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">use_rngs</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Context manager to set and restore nnx RNGs.</p>
<p>This context manager allows temporarily setting the nnx RNGs
used in Flax/nnx operations. It saves the current RNGs on entry
and restores them on exit.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">YIELDS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-yields-annotation">
                    <code><span title="flax.nnx.Rngs">Rngs</span></code>
                </span>
            </td>
            <td class="doc-yields-details">
              <div class="doc-md-description">
                <p>The current nnx RNGs within the context.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/random.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-10"><span class="nd">@contextmanager</span>
</span><span id="__span-0-11"><span class="k">def</span><span class="w"> </span><span class="nf">use_rngs</span><span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">nnx</span><span class="o">.</span><span class="n">Rngs</span><span class="p">]:</span>
</span><span id="__span-0-12"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Context manager to set and restore nnx RNGs.</span>
</span><span id="__span-0-13">
</span><span id="__span-0-14"><span class="sd">    This context manager allows temporarily setting the nnx RNGs</span>
</span><span id="__span-0-15"><span class="sd">    used in Flax/nnx operations. It saves the current RNGs on entry</span>
</span><span id="__span-0-16"><span class="sd">    and restores them on exit.</span>
</span><span id="__span-0-17">
</span><span id="__span-0-18"><span class="sd">    Yields:</span>
</span><span id="__span-0-19"><span class="sd">        The current nnx RNGs within the context.</span>
</span><span id="__span-0-20">
</span><span id="__span-0-21"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-22">    <span class="n">token</span> <span class="o">=</span> <span class="n">_NNX_RNGS</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">nnx</span><span class="o">.</span><span class="n">Rngs</span><span class="p">(</span><span class="n">default</span><span class="p">))</span>
</span><span id="__span-0-23">    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-24">        <span class="k">yield</span> <span class="n">_NNX_RNGS</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span id="__span-0-25">    <span class="k">finally</span><span class="p">:</span>
</span><span id="__span-0-26">        <span class="n">_NNX_RNGS</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="formed.integrations.flax.random.require_rngs" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">require_rngs</span>


<a href="#formed.integrations.flax.random.require_rngs" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">require_rngs</span><span class="p">()</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Get the current nnx RNGs.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="flax.nnx.Rngs">Rngs</span></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The current nnx RNGs.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/random.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-29"><span class="k">def</span><span class="w"> </span><span class="nf">require_rngs</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">nnx</span><span class="o">.</span><span class="n">Rngs</span><span class="p">:</span>
</span><span id="__span-0-30"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the current nnx RNGs.</span>
</span><span id="__span-0-31">
</span><span id="__span-0-32"><span class="sd">    Returns:</span>
</span><span id="__span-0-33"><span class="sd">        The current nnx RNGs.</span>
</span><span id="__span-0-34">
</span><span id="__span-0-35"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-36">    <span class="k">return</span> <span class="n">_NNX_RNGS</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="formed.integrations.flax.utils" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">formed.integrations.flax.utils</span>


<a href="#formed.integrations.flax.utils" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">










<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="formed.integrations.flax.utils.PoolingMethod" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">PoolingMethod</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

<a href="#formed.integrations.flax.utils.PoolingMethod" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">PoolingMethod</span> <span class="o">=</span> <span class="n"><span title="typing.Literal">Literal</span></span><span class="p">[</span>
</span><span id="__span-0-2">    <span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">,</span> <span class="s2">&quot;min&quot;</span><span class="p">,</span> <span class="s2">&quot;sum&quot;</span><span class="p">,</span> <span class="s2">&quot;hier&quot;</span><span class="p">,</span> <span class="s2">&quot;first&quot;</span><span class="p">,</span> <span class="s2">&quot;last&quot;</span>
</span><span id="__span-0-3"><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>




<div class="doc doc-object doc-function">


<h3 id="formed.integrations.flax.utils.ensure_jax_array" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">ensure_jax_array</span>


<a href="#formed.integrations.flax.utils.ensure_jax_array" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">ensure_jax_array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-12"><span class="k">def</span><span class="w"> </span><span class="nf">ensure_jax_array</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">ArrayCompatible</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">jax</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
</span><span id="__span-0-13">    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">jax</span><span class="o">.</span><span class="n">Array</span><span class="p">):</span>
</span><span id="__span-0-14">        <span class="k">return</span> <span class="n">x</span>
</span><span id="__span-0-15">    <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="formed.integrations.flax.utils.masked_pool" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">masked_pool</span>


<a href="#formed.integrations.flax.utils.masked_pool" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">masked_pool</span><span class="p">(</span>
</span><span id="__span-0-2">    <span class="n">embeddings</span><span class="p">,</span>
</span><span id="__span-0-3">    <span class="n">mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-4">    <span class="n">pooling</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span>
</span><span id="__span-0-5">    <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-6">    <span class="n">window_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-7"><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Pool embeddings with a mask.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>embeddings</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Embeddings to pool of shape (batch_size, sequence_length, embedding_size).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="jax.Array">Array</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mask</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Mask of shape (batch_size, sequence_length).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="jax.Array">Array</span> | None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pooling</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-attribute&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-attribute-name&quot;&gt;PoolingMethod&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;formed.integrations.flax.utils.PoolingMethod&lt;/code&gt;)" href="#formed.integrations.flax.utils.PoolingMethod">PoolingMethod</a> | <span title="collections.abc.Sequence">Sequence</span>[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-attribute&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-attribute-name&quot;&gt;PoolingMethod&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;formed.integrations.flax.utils.PoolingMethod&lt;/code&gt;)" href="#formed.integrations.flax.utils.PoolingMethod">PoolingMethod</a>]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;mean&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>normalize</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to normalize the embeddings before pooling. Defaults to <code>False</code>.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="bool">bool</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>window_size</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Window size for hierarchical pooling. Defaults to <code>None</code>.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="int">int</span> | None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-29"><span class="k">def</span><span class="w"> </span><span class="nf">masked_pool</span><span class="p">(</span>
</span><span id="__span-0-30">    <span class="n">embeddings</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span>
</span><span id="__span-0-31">    <span class="n">mask</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">Array</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-32">    <span class="n">pooling</span><span class="p">:</span> <span class="n">PoolingMethod</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">PoolingMethod</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span>
</span><span id="__span-0-33">    <span class="n">normalize</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-34">    <span class="n">window_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-35"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">jax</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
</span><span id="__span-0-36"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-37"><span class="sd">    Pool embeddings with a mask.</span>
</span><span id="__span-0-38">
</span><span id="__span-0-39"><span class="sd">    Args:</span>
</span><span id="__span-0-40"><span class="sd">        embeddings: Embeddings to pool of shape (batch_size, sequence_length, embedding_size).</span>
</span><span id="__span-0-41"><span class="sd">        mask: Mask of shape (batch_size, sequence_length).</span>
</span><span id="__span-0-42"><span class="sd">        pooling:</span>
</span><span id="__span-0-43"><span class="sd">        normalize: Whether to normalize the embeddings before pooling. Defaults to `False`.</span>
</span><span id="__span-0-44"><span class="sd">        window_size: Window size for hierarchical pooling. Defaults to `None`.</span>
</span><span id="__span-0-45"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-46">
</span><span id="__span-0-47">    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pooling</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-48">        <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
</span><span id="__span-0-49">            <span class="p">[</span>
</span><span id="__span-0-50">                <span class="n">masked_pool</span><span class="p">(</span>
</span><span id="__span-0-51">                    <span class="n">embeddings</span><span class="p">,</span>
</span><span id="__span-0-52">                    <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span>
</span><span id="__span-0-53">                    <span class="n">pooling</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
</span><span id="__span-0-54">                    <span class="n">normalize</span><span class="o">=</span><span class="n">normalize</span><span class="p">,</span>
</span><span id="__span-0-55">                    <span class="n">window_size</span><span class="o">=</span><span class="n">window_size</span><span class="p">,</span>
</span><span id="__span-0-56">                <span class="p">)</span>
</span><span id="__span-0-57">                <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">pooling</span>
</span><span id="__span-0-58">            <span class="p">],</span>
</span><span id="__span-0-59">            <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
</span><span id="__span-0-60">        <span class="p">)</span>
</span><span id="__span-0-61">
</span><span id="__span-0-62">    <span class="n">batch_size</span><span class="p">,</span> <span class="n">sequence_length</span><span class="p">,</span> <span class="n">embedding_size</span> <span class="o">=</span> <span class="n">embeddings</span><span class="o">.</span><span class="n">shape</span>
</span><span id="__span-0-63">
</span><span id="__span-0-64">    <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
</span><span id="__span-0-65">        <span class="n">embeddings</span> <span class="o">=</span> <span class="n">embeddings</span> <span class="o">/</span> <span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">embeddings</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-13</span><span class="p">)</span>
</span><span id="__span-0-66">
</span><span id="__span-0-67">    <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-68">        <span class="n">mask</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">sequence_length</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
</span><span id="__span-0-69">
</span><span id="__span-0-70">    <span class="k">if</span> <span class="n">pooling</span> <span class="o">==</span> <span class="s2">&quot;mean&quot;</span><span class="p">:</span>
</span><span id="__span-0-71">        <span class="k">return</span> <span class="n">embeddings</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">mask</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-13</span><span class="p">)</span>
</span><span id="__span-0-72">
</span><span id="__span-0-73">    <span class="k">if</span> <span class="n">pooling</span> <span class="o">==</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span>
</span><span id="__span-0-74">        <span class="n">embeddings</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">embeddings</span><span class="p">,</span> <span class="o">-</span><span class="n">jax</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
</span><span id="__span-0-75">        <span class="k">return</span> <span class="n">embeddings</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-76">
</span><span id="__span-0-77">    <span class="k">if</span> <span class="n">pooling</span> <span class="o">==</span> <span class="s2">&quot;min&quot;</span><span class="p">:</span>
</span><span id="__span-0-78">        <span class="n">embeddings</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">embeddings</span><span class="p">,</span> <span class="n">jax</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
</span><span id="__span-0-79">        <span class="k">return</span> <span class="n">embeddings</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-80">
</span><span id="__span-0-81">    <span class="k">if</span> <span class="n">pooling</span> <span class="o">==</span> <span class="s2">&quot;sum&quot;</span><span class="p">:</span>
</span><span id="__span-0-82">        <span class="n">embeddings</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">embeddings</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-83">        <span class="k">return</span> <span class="n">embeddings</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-84">
</span><span id="__span-0-85">    <span class="k">if</span> <span class="n">pooling</span> <span class="o">==</span> <span class="s2">&quot;first&quot;</span><span class="p">:</span>
</span><span id="__span-0-86">        <span class="k">return</span> <span class="n">embeddings</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="__span-0-87">
</span><span id="__span-0-88">    <span class="k">if</span> <span class="n">pooling</span> <span class="o">==</span> <span class="s2">&quot;last&quot;</span><span class="p">:</span>
</span><span id="__span-0-89">        <span class="n">batch_indices</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">batch_size</span><span class="p">)</span>
</span><span id="__span-0-90">        <span class="n">last_positions</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-91">        <span class="k">return</span> <span class="n">embeddings</span><span class="p">[</span><span class="n">batch_indices</span><span class="p">,</span> <span class="n">last_positions</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="__span-0-92">
</span><span id="__span-0-93">    <span class="k">if</span> <span class="n">pooling</span> <span class="o">==</span> <span class="s2">&quot;hier&quot;</span><span class="p">:</span>
</span><span id="__span-0-94">
</span><span id="__span-0-95">        <span class="k">def</span><span class="w"> </span><span class="nf">_hierarchical_pooling</span><span class="p">(</span><span class="n">vectors</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">mask</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">Array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">jax</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
</span><span id="__span-0-96">            <span class="k">assert</span> <span class="n">window_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="__span-0-97">            <span class="n">vectors</span> <span class="o">=</span> <span class="n">vectors</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
</span><span id="__span-0-98">            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vectors</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">window_size</span><span class="p">:</span>
</span><span id="__span-0-99">                <span class="k">return</span> <span class="n">vectors</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-100">            <span class="n">output</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="o">-</span><span class="n">jax</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">inf</span> <span class="o">*</span> <span class="n">jax</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">embedding_size</span><span class="p">)</span>
</span><span id="__span-0-101">            <span class="k">for</span> <span class="n">offset</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vectors</span><span class="p">)</span> <span class="o">-</span> <span class="n">window_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="__span-0-102">                <span class="n">window</span> <span class="o">=</span> <span class="n">vectors</span><span class="p">[</span><span class="n">offset</span> <span class="p">:</span> <span class="n">offset</span> <span class="o">+</span> <span class="n">window_size</span><span class="p">]</span>
</span><span id="__span-0-103">                <span class="n">output</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">window</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span><span id="__span-0-104">            <span class="k">return</span> <span class="n">output</span>
</span><span id="__span-0-105">
</span><span id="__span-0-106">        <span class="n">output</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">starmap</span><span class="p">(</span><span class="n">_hierarchical_pooling</span><span class="p">,</span> <span class="nb">zip</span><span class="p">(</span><span class="n">embeddings</span><span class="p">,</span> <span class="n">mask</span><span class="p">))))</span>
</span><span id="__span-0-107">        <span class="k">return</span> <span class="n">output</span>
</span><span id="__span-0-108">
</span><span id="__span-0-109">    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="__span-0-110">        <span class="sa">f</span><span class="s2">&quot;pooling must be one of &#39;mean&#39;, &#39;max&#39;, &#39;min&#39;, &#39;sum&#39;, &#39;hier&#39;, &#39;first&#39;, or &#39;last&#39;, but got </span><span class="si">{</span><span class="n">pooling</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-0-111">    <span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="formed.integrations.flax.utils.sequence_distribute" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">sequence_distribute</span>


<a href="#formed.integrations.flax.utils.sequence_distribute" class="headerlink" title="Permanent link">&para;</a></h3>
          <div class="doc-overloads">
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">sequence_distribute</span><span class="p">(</span>
</span><span id="__span-0-2">    <span class="n">inputs</span><span class="p">:</span> <span class="n"><span title="jax.Array">Array</span></span><span class="p">,</span>
</span><span id="__span-0-3"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="tuple">tuple</span></span><span class="p">[</span><span class="n"><span title="jax.Array">Array</span></span><span class="p">,</span> <span class="n"><span title="tuple">tuple</span></span><span class="p">[</span><span class="n"><span title="int">int</span></span><span class="p">,</span> <span class="n"><span title="int">int</span></span><span class="p">]]</span>
</span></code></pre></div><div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">sequence_distribute</span><span class="p">(</span>
</span><span id="__span-0-2">    <span class="n">inputs</span><span class="p">:</span> <span class="n"><span title="formed.integrations.flax.utils._MappingT">_MappingT</span></span><span class="p">,</span> <span class="n">ignore</span><span class="p">:</span> <span class="n"><span title="collections.abc.Sequence">Sequence</span></span><span class="p">[</span><span class="n"><span title="str">str</span></span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span>
</span><span id="__span-0-3"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="tuple">tuple</span></span><span class="p">[</span><span class="n"><span title="formed.integrations.flax.utils._MappingT">_MappingT</span></span><span class="p">,</span> <span class="n"><span title="tuple">tuple</span></span><span class="p">[</span><span class="n"><span title="int">int</span></span><span class="p">,</span> <span class="n"><span title="int">int</span></span><span class="p">]]</span>
</span></code></pre></div>          </div>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">sequence_distribute</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">ignore</span><span class="o">=</span><span class="p">())</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-127"><span class="k">def</span><span class="w"> </span><span class="nf">sequence_distribute</span><span class="p">(</span>
</span><span id="__span-0-128">    <span class="n">inputs</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">Array</span> <span class="o">|</span> <span class="n">_MappingT</span><span class="p">,</span>
</span><span id="__span-0-129">    <span class="n">ignore</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
</span><span id="__span-0-130"><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">jax</span><span class="o">.</span><span class="n">Array</span> <span class="o">|</span> <span class="n">_MappingT</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
</span><span id="__span-0-131">    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">jax</span><span class="o">.</span><span class="n">Array</span><span class="p">):</span>
</span><span id="__span-0-132">        <span class="k">if</span> <span class="n">inputs</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="__span-0-133">            <span class="k">return</span> <span class="n">inputs</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-134">        <span class="n">batch_size</span><span class="p">,</span> <span class="n">max_length</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
</span><span id="__span-0-135">        <span class="k">return</span> <span class="n">inputs</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">batch_size</span> <span class="o">*</span> <span class="n">max_length</span><span class="p">,</span> <span class="o">*</span><span class="n">inputs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">:])),</span> <span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">max_length</span><span class="p">)</span>
</span><span id="__span-0-136">    <span class="n">distributed</span> <span class="o">=</span> <span class="p">[(</span><span class="n">key</span><span class="p">,</span> <span class="n">sequence_distribute</span><span class="p">(</span><span class="n">value</span><span class="p">))</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">inputs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ignore</span><span class="p">]</span>
</span><span id="__span-0-137">    <span class="n">arrays</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">distributed</span><span class="p">}</span>
</span><span id="__span-0-138">    <span class="n">shape</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">s</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="ow">in</span> <span class="n">distributed</span> <span class="k">if</span> <span class="n">s</span> <span class="o">!=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-0-139">    <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">_MappingT</span><span class="p">,</span> <span class="n">arrays</span><span class="p">),</span> <span class="n">shape</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="formed.integrations.flax.utils.sequence_undistribute" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">sequence_undistribute</span>


<a href="#formed.integrations.flax.utils.sequence_undistribute" class="headerlink" title="Permanent link">&para;</a></h3>
          <div class="doc-overloads">
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">sequence_undistribute</span><span class="p">(</span>
</span><span id="__span-0-2">    <span class="n">inputs</span><span class="p">:</span> <span class="n"><span title="jax.Array">Array</span></span><span class="p">,</span>
</span><span id="__span-0-3">    <span class="n">shape</span><span class="p">:</span> <span class="n"><span title="tuple">tuple</span></span><span class="p">[</span><span class="n"><span title="int">int</span></span><span class="p">,</span> <span class="n"><span title="int">int</span></span><span class="p">],</span>
</span><span id="__span-0-4">    <span class="n">ignore</span><span class="p">:</span> <span class="n"><span title="collections.abc.Sequence">Sequence</span></span><span class="p">[</span><span class="n"><span title="str">str</span></span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
</span><span id="__span-0-5"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="jax.Array">Array</span></span>
</span></code></pre></div><div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">sequence_undistribute</span><span class="p">(</span>
</span><span id="__span-0-2">    <span class="n">inputs</span><span class="p">:</span> <span class="n"><span title="formed.integrations.flax.utils._MappingT">_MappingT</span></span><span class="p">,</span>
</span><span id="__span-0-3">    <span class="n">shape</span><span class="p">:</span> <span class="n"><span title="tuple">tuple</span></span><span class="p">[</span><span class="n"><span title="int">int</span></span><span class="p">,</span> <span class="n"><span title="int">int</span></span><span class="p">],</span>
</span><span id="__span-0-4">    <span class="n">ignore</span><span class="p">:</span> <span class="n"><span title="collections.abc.Sequence">Sequence</span></span><span class="p">[</span><span class="n"><span title="str">str</span></span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
</span><span id="__span-0-5"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="formed.integrations.flax.utils._MappingT">_MappingT</span></span>
</span></code></pre></div>          </div>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">sequence_undistribute</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">ignore</span><span class="o">=</span><span class="p">())</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-158"><span class="k">def</span><span class="w"> </span><span class="nf">sequence_undistribute</span><span class="p">(</span>
</span><span id="__span-0-159">    <span class="n">inputs</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">Array</span> <span class="o">|</span> <span class="n">_MappingT</span><span class="p">,</span>
</span><span id="__span-0-160">    <span class="n">shape</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
</span><span id="__span-0-161">    <span class="n">ignore</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
</span><span id="__span-0-162"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">jax</span><span class="o">.</span><span class="n">Array</span> <span class="o">|</span> <span class="n">_MappingT</span><span class="p">:</span>
</span><span id="__span-0-163">    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">jax</span><span class="o">.</span><span class="n">Array</span><span class="p">):</span>
</span><span id="__span-0-164">        <span class="k">return</span> <span class="n">inputs</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">*</span><span class="n">inputs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>
</span><span id="__span-0-165">    <span class="k">return</span> <span class="n">cast</span><span class="p">(</span>
</span><span id="__span-0-166">        <span class="n">_MappingT</span><span class="p">,</span>
</span><span id="__span-0-167">        <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">sequence_undistribute</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">shape</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">inputs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ignore</span><span class="p">},</span>
</span><span id="__span-0-168">    <span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="formed.integrations.flax.utils.determine_ndim" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">determine_ndim</span>


<a href="#formed.integrations.flax.utils.determine_ndim" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">determine_ndim</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-171"><span class="k">def</span><span class="w"> </span><span class="nf">determine_ndim</span><span class="p">(</span>
</span><span id="__span-0-172">    <span class="n">first</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="__span-0-173">    <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">int</span><span class="p">],</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-174"><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="__span-0-175">    <span class="n">output_dim</span> <span class="o">=</span> <span class="n">first</span>
</span><span id="__span-0-176">    <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
</span><span id="__span-0-177">        <span class="k">if</span> <span class="n">arg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-178">            <span class="k">continue</span>
</span><span id="__span-0-179">        <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
</span><span id="__span-0-180">            <span class="n">output_dim</span> <span class="o">=</span> <span class="n">arg</span><span class="p">(</span><span class="n">output_dim</span><span class="p">)</span>
</span><span id="__span-0-181">        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-182">            <span class="n">output_dim</span> <span class="o">=</span> <span class="n">arg</span>
</span><span id="__span-0-183">    <span class="k">return</span> <span class="n">output_dim</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="formed.integrations.flax.workflow" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">formed.integrations.flax.workflow</span>


<a href="#formed.integrations.flax.workflow" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

        <p>Workflow integration for Flax model training.</p>
<p>This module provides workflow steps for training Flax models, allowing
them to be integrated into the formed workflow system with automatic
caching and dependency tracking.</p>


<details class="available-steps" open>
  <summary>Available Steps</summary>
  <ul>
<li><code>flax::train</code>: Train a Flax model using the provided trainer.</li>
<li><code>flax::evaluate</code>: Evaluate a Flax model on a dataset.</li>
</ul>
</details>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span id="__span-0-1"><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">formed.integrations.flax</span><span class="w"> </span><span class="kn">import</span> <span class="n">train_flax_model</span>
</span><span id="__span-0-2"><span class="gp">&gt;&gt;&gt;</span>
</span><span id="__span-0-3"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># In workflow configuration (jsonnet):</span>
</span><span id="__span-0-4"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># {</span>
</span><span id="__span-0-5"><span class="gp">&gt;&gt;&gt; </span><span class="c1">#   steps: {</span>
</span><span id="__span-0-6"><span class="gp">&gt;&gt;&gt; </span><span class="c1">#     train: {</span>
</span><span id="__span-0-7"><span class="gp">&gt;&gt;&gt; </span><span class="c1">#       type: &quot;flax::train&quot;,</span>
</span><span id="__span-0-8"><span class="gp">&gt;&gt;&gt; </span><span class="c1">#       model: { type: &quot;my_model&quot;, ... },</span>
</span><span id="__span-0-9"><span class="gp">&gt;&gt;&gt; </span><span class="c1">#       trainer: { type: &quot;flax_trainer&quot;, ... },</span>
</span><span id="__span-0-10"><span class="gp">&gt;&gt;&gt; </span><span class="c1">#       train_dataset: { type: &quot;ref&quot;, ref: &quot;preprocess&quot; },</span>
</span><span id="__span-0-11"><span class="gp">&gt;&gt;&gt; </span><span class="c1">#       random_seed: 42</span>
</span><span id="__span-0-12"><span class="gp">&gt;&gt;&gt; </span><span class="c1">#     }</span>
</span><span id="__span-0-13"><span class="gp">&gt;&gt;&gt; </span><span class="c1">#   }</span>
</span><span id="__span-0-14"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># }</span>
</span></code></pre></div>










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h3 id="formed.integrations.flax.workflow.FlaxModelFormat" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">FlaxModelFormat</span>


<a href="#formed.integrations.flax.workflow.FlaxModelFormat" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;Format&lt;/span&gt; (&lt;code&gt;formed.workflow.Format&lt;/code&gt;)" href="../../workflow/#formed.workflow.format.Format">Format</a>[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;BaseFlaxModel&lt;/span&gt; (&lt;code&gt;formed.integrations.flax.model.BaseFlaxModel&lt;/code&gt;)" href="#formed.integrations.flax.model.BaseFlaxModel">BaseFlaxModel</a>]</code></p>













<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="formed.integrations.flax.workflow.FlaxModelFormat.identifier" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">identifier</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#formed.integrations.flax.workflow.FlaxModelFormat.identifier" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">identifier</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Get the unique identifier for this format.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="str">str</span></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Format identifier string.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>




<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.workflow.FlaxModelFormat.write" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">write</span>


<a href="#formed.integrations.flax.workflow.FlaxModelFormat.write" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">write</span><span class="p">(</span><span class="n">artifact</span><span class="p">,</span> <span class="n">directory</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/workflow.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-66"><span class="k">def</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">artifact</span><span class="p">:</span> <span class="n">BaseFlaxModel</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-67">    <span class="k">if</span> <span class="p">(</span><span class="n">config</span> <span class="o">:=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">artifact</span><span class="p">,</span> <span class="s2">&quot;__model_config__&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-68">        <span class="n">config</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">artifact</span><span class="o">.</span><span class="n">__model_config__</span><span class="p">)</span>
</span><span id="__span-0-69">        <span class="n">config</span><span class="p">[</span><span class="n">COLT_TYPEKEY</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">artifact</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__module__</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">artifact</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-0-70">        <span class="k">del</span> <span class="n">artifact</span><span class="o">.</span><span class="n">__model_config__</span>
</span><span id="__span-0-71">        <span class="bp">self</span><span class="o">.</span><span class="n">_get_config_path</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">WorkflowJSONEncoder</span><span class="p">))</span>
</span><span id="__span-0-72">        <span class="bp">self</span><span class="o">.</span><span class="n">_get_checkpointer</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">artifact</span><span class="p">)</span>
</span><span id="__span-0-73">    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-74">        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_pickle_path</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="__span-0-75">            <span class="n">cloudpickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">artifact</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.workflow.FlaxModelFormat.read" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">read</span>


<a href="#formed.integrations.flax.workflow.FlaxModelFormat.read" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">read</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/workflow.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-77"><span class="k">def</span><span class="w"> </span><span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BaseFlaxModel</span><span class="p">:</span>
</span><span id="__span-0-78">    <span class="k">if</span> <span class="p">(</span><span class="n">pickle_path</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_pickle_path</span><span class="p">(</span><span class="n">directory</span><span class="p">))</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="__span-0-79">        <span class="k">with</span> <span class="n">pickle_path</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="__span-0-80">            <span class="k">return</span> <span class="n">cloudpickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="__span-0-81">
</span><span id="__span-0-82">    <span class="k">with</span> <span class="n">use_rngs</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span>
</span><span id="__span-0-83">        <span class="n">model</span> <span class="o">=</span> <span class="n">COLT_BUILDER</span><span class="p">(</span>
</span><span id="__span-0-84">            <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span>
</span><span id="__span-0-85">                <span class="bp">self</span><span class="o">.</span><span class="n">_get_config_path</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span><span class="o">.</span><span class="n">read_text</span><span class="p">(),</span>
</span><span id="__span-0-86">                <span class="bp">cls</span><span class="o">=</span><span class="n">WorkflowJSONDecoder</span><span class="p">,</span>
</span><span id="__span-0-87">            <span class="p">)</span>
</span><span id="__span-0-88">        <span class="p">)</span>
</span><span id="__span-0-89">
</span><span id="__span-0-90">    <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">BaseFlaxModel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_checkpointer</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span><span class="o">.</span><span class="n">restore</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="n">model</span><span class="p">))</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="formed.integrations.flax.workflow.FlaxModelFormat.is_default_of" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">is_default_of</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#formed.integrations.flax.workflow.FlaxModelFormat.is_default_of" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">is_default_of</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Check if this format is the default for the given object type.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>obj</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Object to check.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Any">Any</span></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="bool">bool</span></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>True if this format should be used by default for this type.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/workflow/format.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-101"><span class="nd">@classmethod</span>
</span><span id="__span-0-102"><span class="k">def</span><span class="w"> </span><span class="nf">is_default_of</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-0-103"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if this format is the default for the given object type.</span>
</span><span id="__span-0-104">
</span><span id="__span-0-105"><span class="sd">    Args:</span>
</span><span id="__span-0-106"><span class="sd">        obj: Object to check.</span>
</span><span id="__span-0-107">
</span><span id="__span-0-108"><span class="sd">    Returns:</span>
</span><span id="__span-0-109"><span class="sd">        True if this format should be used by default for this type.</span>
</span><span id="__span-0-110">
</span><span id="__span-0-111"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-112">    <span class="k">return</span> <span class="kc">False</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h3 id="formed.integrations.flax.workflow.train_flax_model" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">train_flax_model</span>


<a href="#formed.integrations.flax.workflow.train_flax_model" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">train_flax_model</span><span class="p">(</span>
</span><span id="__span-0-2">    <span class="n">model</span><span class="p">,</span>
</span><span id="__span-0-3">    <span class="n">trainer</span><span class="p">,</span>
</span><span id="__span-0-4">    <span class="n">train_dataset</span><span class="p">,</span>
</span><span id="__span-0-5">    <span class="n">val_dataset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-6">    <span class="n">random_seed</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="__span-0-7"><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Train a Flax model using the provided trainer.</p>
<p>This workflow step trains a Flax NNX model on the provided datasets,
returning the trained model. The training process is cached based on
the model architecture, trainer configuration, and dataset fingerprints.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Flax model to train.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="colt.Lazy">Lazy</span>[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;BaseFlaxModel&lt;/span&gt; (&lt;code&gt;formed.integrations.flax.model.BaseFlaxModel&lt;/code&gt;)" href="#formed.integrations.flax.model.BaseFlaxModel">BaseFlaxModel</a>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>trainer</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Trainer configuration with dataloaders and callbacks.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;FlaxTrainer&lt;/span&gt; (&lt;code&gt;formed.integrations.flax.training.FlaxTrainer&lt;/code&gt;)" href="#formed.integrations.flax.training.trainer.FlaxTrainer">FlaxTrainer</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_dataset</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Training dataset items.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="collections.abc.Sequence">Sequence</span>[<span title="formed.integrations.flax.types.ItemT">ItemT</span>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>val_dataset</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Optional validation dataset items.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="collections.abc.Sequence">Sequence</span>[<span title="formed.integrations.flax.types.ItemT">ItemT</span>] | None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>random_seed</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Random seed for reproducibility.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="int">int</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;BaseFlaxModel&lt;/span&gt; (&lt;code&gt;formed.integrations.flax.model.BaseFlaxModel&lt;/code&gt;)" href="#formed.integrations.flax.model.BaseFlaxModel">BaseFlaxModel</a></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Trained Flax model with updated parameters.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span id="__span-0-1"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Use in Python code</span>
</span><span id="__span-0-2"><span class="gp">&gt;&gt;&gt; </span><span class="n">trained_model</span> <span class="o">=</span> <span class="n">train_flax_model</span><span class="p">(</span>
</span><span id="__span-0-3"><span class="gp">... </span>    <span class="n">model</span><span class="o">=</span><span class="n">my_model</span><span class="p">,</span>
</span><span id="__span-0-4"><span class="gp">... </span>    <span class="n">trainer</span><span class="o">=</span><span class="n">trainer</span><span class="p">,</span>
</span><span id="__span-0-5"><span class="gp">... </span>    <span class="n">train_dataset</span><span class="o">=</span><span class="n">train_data</span><span class="p">,</span>
</span><span id="__span-0-6"><span class="gp">... </span>    <span class="n">val_dataset</span><span class="o">=</span><span class="n">val_data</span><span class="p">,</span>
</span><span id="__span-0-7"><span class="gp">... </span>    <span class="n">random_seed</span><span class="o">=</span><span class="mi">42</span>
</span><span id="__span-0-8"><span class="gp">... </span><span class="p">)</span>
</span></code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/workflow.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-93"><span class="nd">@step</span><span class="p">(</span><span class="s2">&quot;flax::train&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">FlaxModelFormat</span><span class="p">())</span>
</span><span id="__span-0-94"><span class="k">def</span><span class="w"> </span><span class="nf">train_flax_model</span><span class="p">(</span>
</span><span id="__span-0-95">    <span class="n">model</span><span class="p">:</span> <span class="n">Lazy</span><span class="p">[</span><span class="n">BaseFlaxModel</span><span class="p">],</span>
</span><span id="__span-0-96">    <span class="n">trainer</span><span class="p">:</span> <span class="n">FlaxTrainer</span><span class="p">,</span>
</span><span id="__span-0-97">    <span class="n">train_dataset</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">ItemT</span><span class="p">],</span>
</span><span id="__span-0-98">    <span class="n">val_dataset</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">ItemT</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-99">    <span class="n">random_seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-0-100"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BaseFlaxModel</span><span class="p">:</span>
</span><span id="__span-0-101"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Train a Flax model using the provided trainer.</span>
</span><span id="__span-0-102">
</span><span id="__span-0-103"><span class="sd">    This workflow step trains a Flax NNX model on the provided datasets,</span>
</span><span id="__span-0-104"><span class="sd">    returning the trained model. The training process is cached based on</span>
</span><span id="__span-0-105"><span class="sd">    the model architecture, trainer configuration, and dataset fingerprints.</span>
</span><span id="__span-0-106">
</span><span id="__span-0-107"><span class="sd">    Args:</span>
</span><span id="__span-0-108"><span class="sd">        model: Flax model to train.</span>
</span><span id="__span-0-109"><span class="sd">        trainer: Trainer configuration with dataloaders and callbacks.</span>
</span><span id="__span-0-110"><span class="sd">        train_dataset: Training dataset items.</span>
</span><span id="__span-0-111"><span class="sd">        val_dataset: Optional validation dataset items.</span>
</span><span id="__span-0-112"><span class="sd">        random_seed: Random seed for reproducibility.</span>
</span><span id="__span-0-113">
</span><span id="__span-0-114"><span class="sd">    Returns:</span>
</span><span id="__span-0-115"><span class="sd">        Trained Flax model with updated parameters.</span>
</span><span id="__span-0-116">
</span><span id="__span-0-117"><span class="sd">    Examples:</span>
</span><span id="__span-0-118"><span class="sd">        &gt;&gt;&gt; # Use in Python code</span>
</span><span id="__span-0-119"><span class="sd">        &gt;&gt;&gt; trained_model = train_flax_model(</span>
</span><span id="__span-0-120"><span class="sd">        ...     model=my_model,</span>
</span><span id="__span-0-121"><span class="sd">        ...     trainer=trainer,</span>
</span><span id="__span-0-122"><span class="sd">        ...     train_dataset=train_data,</span>
</span><span id="__span-0-123"><span class="sd">        ...     val_dataset=val_data,</span>
</span><span id="__span-0-124"><span class="sd">        ...     random_seed=42</span>
</span><span id="__span-0-125"><span class="sd">        ... )</span>
</span><span id="__span-0-126">
</span><span id="__span-0-127"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-128">
</span><span id="__span-0-129">    <span class="k">with</span> <span class="n">use_rngs</span><span class="p">(</span><span class="n">random_seed</span><span class="p">):</span>
</span><span id="__span-0-130">        <span class="n">model_instance</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">construct</span><span class="p">()</span>
</span><span id="__span-0-131">        <span class="n">state</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">model_instance</span><span class="p">,</span> <span class="n">train_dataset</span><span class="p">,</span> <span class="n">val_dataset</span><span class="p">)</span>
</span><span id="__span-0-132">
</span><span id="__span-0-133">    <span class="n">model_instance</span> <span class="o">=</span> <span class="n">nnx</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">graphdef</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="o">*</span><span class="n">state</span><span class="o">.</span><span class="n">additional_states</span><span class="p">)</span>
</span><span id="__span-0-134">    <span class="n">model_instance</span><span class="o">.</span><span class="n">__model_config__</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">config</span>
</span><span id="__span-0-135">    <span class="k">return</span> <span class="n">model_instance</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="formed.integrations.flax.workflow.evaluate_flax_model" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">evaluate_flax_model</span>


<a href="#formed.integrations.flax.workflow.evaluate_flax_model" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">evaluate_flax_model</span><span class="p">(</span>
</span><span id="__span-0-2">    <span class="n">model</span><span class="p">,</span>
</span><span id="__span-0-3">    <span class="n">evaluator</span><span class="p">,</span>
</span><span id="__span-0-4">    <span class="n">dataset</span><span class="p">,</span>
</span><span id="__span-0-5">    <span class="n">dataloader</span><span class="p">,</span>
</span><span id="__span-0-6">    <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-7">    <span class="n">random_seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-8"><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Evaluate a Flax model on a dataset using the provided evaluator.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Flax model to evaluate.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;BaseFlaxModel&lt;/span&gt; (&lt;code&gt;formed.integrations.flax.model.BaseFlaxModel&lt;/code&gt;)" href="#formed.integrations.flax.model.BaseFlaxModel">BaseFlaxModel</a>[<span title="formed.integrations.flax.types.ModelInputT">ModelInputT</span>, <span title="formed.integrations.flax.types.ModelOutputT">ModelOutputT</span>, <span title="formed.integrations.flax.types.ModelParamsT">ModelParamsT</span>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>evaluator</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Evaluator to compute metrics.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="formed.integrations.flax.types.IEvaluator">IEvaluator</span>[<span title="formed.integrations.flax.types.ModelInputT">ModelInputT</span>, <span title="formed.integrations.flax.types.ModelOutputT">ModelOutputT</span>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dataset</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Dataset items for evaluation.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="list">list</span>[<span title="formed.integrations.flax.types.ItemT">ItemT</span>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dataloader</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>DataLoader to convert items to model inputs.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="formed.integrations.flax.types.IDataLoader">IDataLoader</span>[<span title="formed.integrations.flax.types.ItemT">ItemT</span>, <span title="formed.integrations.flax.types.ModelInputT">ModelInputT</span>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Optional model parameters to use for evaluation.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="formed.integrations.flax.types.ModelParamsT">ModelParamsT</span> | None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="float">float</span>]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Dictionary of computed evaluation metrics.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/formed/integrations/flax/workflow.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-138"><span class="nd">@step</span><span class="p">(</span><span class="s2">&quot;flax::evaluate&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">)</span>
</span><span id="__span-0-139"><span class="k">def</span><span class="w"> </span><span class="nf">evaluate_flax_model</span><span class="p">(</span>
</span><span id="__span-0-140">    <span class="n">model</span><span class="p">:</span> <span class="n">BaseFlaxModel</span><span class="p">[</span><span class="n">ModelInputT</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">,</span> <span class="n">ModelParamsT</span><span class="p">],</span>
</span><span id="__span-0-141">    <span class="n">evaluator</span><span class="p">:</span> <span class="n">IEvaluator</span><span class="p">[</span><span class="n">ModelInputT</span><span class="p">,</span> <span class="n">ModelOutputT</span><span class="p">],</span>
</span><span id="__span-0-142">    <span class="n">dataset</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ItemT</span><span class="p">],</span>
</span><span id="__span-0-143">    <span class="n">dataloader</span><span class="p">:</span> <span class="n">IDataLoader</span><span class="p">[</span><span class="n">ItemT</span><span class="p">,</span> <span class="n">ModelInputT</span><span class="p">],</span>
</span><span id="__span-0-144">    <span class="n">params</span><span class="p">:</span> <span class="n">ModelParamsT</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-145">    <span class="n">random_seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-146"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">WorkflowStepResultFlag</span><span class="o">.</span><span class="n">METRICS</span><span class="p">]:</span>
</span><span id="__span-0-147"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Evaluate a Flax model on a dataset using the provided evaluator.</span>
</span><span id="__span-0-148">
</span><span id="__span-0-149"><span class="sd">    Args:</span>
</span><span id="__span-0-150"><span class="sd">        model: Flax model to evaluate.</span>
</span><span id="__span-0-151"><span class="sd">        evaluator: Evaluator to compute metrics.</span>
</span><span id="__span-0-152"><span class="sd">        dataset: Dataset items for evaluation.</span>
</span><span id="__span-0-153"><span class="sd">        dataloader: DataLoader to convert items to model inputs.</span>
</span><span id="__span-0-154"><span class="sd">        params: Optional model parameters to use for evaluation.</span>
</span><span id="__span-0-155">
</span><span id="__span-0-156"><span class="sd">    Returns:</span>
</span><span id="__span-0-157"><span class="sd">        Dictionary of computed evaluation metrics.</span>
</span><span id="__span-0-158"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-159">
</span><span id="__span-0-160">    <span class="n">logger</span> <span class="o">=</span> <span class="n">use_step_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="__span-0-161">
</span><span id="__span-0-162">    <span class="k">with</span> <span class="n">use_rngs</span><span class="p">(</span><span class="n">random_seed</span><span class="p">):</span>
</span><span id="__span-0-163">        <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
</span><span id="__span-0-164">        <span class="n">evaluator</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</span><span id="__span-0-165">
</span><span id="__span-0-166">        <span class="k">with</span> <span class="p">(</span>
</span><span id="__span-0-167">            <span class="n">closing</span><span class="p">(</span><span class="n">dataloader</span><span class="p">(</span><span class="n">dataset</span><span class="p">))</span> <span class="k">as</span> <span class="n">loader</span><span class="p">,</span>
</span><span id="__span-0-168">            <span class="n">progress</span><span class="p">(</span><span class="n">loader</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Evaluating model&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">iterator</span><span class="p">,</span>
</span><span id="__span-0-169">        <span class="p">):</span>
</span><span id="__span-0-170">            <span class="k">for</span> <span class="n">inputs</span> <span class="ow">in</span> <span class="n">iterator</span><span class="p">:</span>
</span><span id="__span-0-171">                <span class="n">output</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
</span><span id="__span-0-172">                <span class="n">evaluator</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
</span><span id="__span-0-173">
</span><span id="__span-0-174">        <span class="n">metrics</span> <span class="o">=</span> <span class="n">evaluator</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</span><span id="__span-0-175">        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Evaluation metrics: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">v</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">metrics</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
</span><span id="__span-0-176">
</span><span id="__span-0-177">    <span class="k">return</span> <span class="n">metrics</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["content.code.copy", "content.tabs.link", "content.tooltips", "navigation.tabs", "navigation.tabs.sticky", "search.highlight", "toc.follow"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>